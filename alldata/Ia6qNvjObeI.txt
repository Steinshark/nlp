in today's video we're going to be going over my complete visual effects workflow using blender nuke and da vinci resolve i've had a lot of requests to make this video and i wanted to make sure that i made it right i've got no idea how long this video is going to be i'm going to keep it comprehensive so i'll talk about every stage of the process so earlier today i went out and i shot a piece of footage that i'm going to turn into a visual effects shot and now literally in this video i'm going to start from scratch and start working on it so step number one before i actually do anything with the footage is i create a folder structure for all of my projects and i have a way of doing that that's quite cool so i've got something on google docs here this is the formatting for my folder structure basically the way it works is i have some edit folders at the top this is for where the footage goes where the exports go um the davinci resolve project and then for the thumbnail and then after that this is all the visual effects stuff so we have shot zero and then i've got shot one shot two blah blah and for each of these it will create a nuke folder and then it will also create a blender folder so depending on how many shots there are for example in this shot that i'm about to do it's just one shot so i'm going to go down until i've got all of shot one and all the edit folders and everything i'm going to press ctrl c and then i'm going to open a notepad document paste it in here and this is how it needs to be formatted so that windows knows how to create the folder structure correctly so then i'm going to do ctrl shift s to do um save as i'm going to create a new shot folder so i'm going to call this vfx workflow and then inside of here i'm going to call this shot creator doesn't matter what you call it and then you have to do dot bat on the end which saves it as a dot batch file and then if i close this and i go to that folder and i open the vfx workflow double click this and then it's going to run the commands and now it's going to create all the shop folders for me so that's a semi-automated way of making all the folders for all the projects each time and i now do this for all of my videos and it's really handy so now that that's done we can put the footage into the shop folder so i'm going to grab it off the hard drive and i'm going to paste it into here which is going to save it in the edit folder and then the next stage is to open davinci resolve and start doing the edit this isn't my usual davinci layout i normally have the playback on this monitor over here actually but for this i'm going to have it all on the same screen so first thing is first go to import media and i bring in the footage once that's in the timeline i'm going to chuck it out as an exr sequence to nuke so the way i do that is i go into the deliver tab i'm going to create a name for my shot and then choose where it goes and in this case i'm going to go in the shot one folder that i made nuke live action and then save it here and press save then for the format here i'm going to change this to an exr sequence which is commonly used in visual effects i'm going to go rgb zip compression half the resolution i'm going to downscale from 4k which is in the timeline to 1080p just because it's a little bit less heavy to work on and i think that is everything so i'm going to press add to render queue and then start render then once that is exported the next step is i'm going to jump into nuke and bring in the sequence that i've just exported i'll also point out that because i exported this as a 16 bit exr i have all the exposure range still in the sky so i turn the brightness right down you can see that all the range is still there if i'd exported this as a jpeg sequence i wouldn't have the ability to darken this down and preserve any of the detail in the sky so once i have my exr sequence in nuke i just do a couple of things before i go to blender the first thing is i remove the lens distortion from the shot lens distortion is really important with the vfx and it's something that i've never seen anyone make a good video about on youtube basically if you've ever seen some gopro footage and all the edges of the screen are really curved it's because it's a really wide angle lens so in visual effects software what you can do is called undistorting which basically accounts for the lens distortion and bends the footage back the other way there's a few ways you can do this you can analyze the footage and the computer will do its best to work it out automatically the really professional way to do it is to shoot something called a lens grid which is a massive piece of card like this and because these are all perfectly straight lines on the grid when you shoot it on a camera you can see how much the lines are bending and then that allows you to calculate the lens distortion i don't actually have a lens grid so what i do is a process where you draw some straight lines onto the footage and tell the computer this should be straight but i know i shot this on a 24 millimeter lens and i've got presets for all of my lenses that i've made before because i do this quite often so if i just search for my 24 millimeter preset this is a setup that i made before that is removing the lens distortion for that particular focal length you can see it's fairly subtle this isn't a super super wide lens so it's not going to be too much distortion anyway and what it's doing is stretching the footage out a little bit more so you can see the edge of the footage goes from here to here in visual effects this is what's known as overscan and it's the extra pixels that get stretched off the edge of the frame and go outside of the footage area basically so now we've done that i can export this as an image sequence to blender and i can use it as the background to my camera and set all my scene up so i hit render now and then render input sequence then once that's finished i also export a second jpeg sequence at a much lower resolution so if i add a reformat node and just scale this down i usually scale it down to about 0.4 and this changes the resolution from 1920 by 1080 which is hd to 768x432 so pretty much 480p and the reason for this is even on a pretty good computer hd background images and blender don't play back very well if you set them up as a background image through your camera so i export a lower resolution one i can use as my background image so that it plays back nicer so i'm going to create a second write node that's doing a very similar thing and i'm going to hit render on this as well okay that's finished now we can jump into blender i'm going to open the movie clip editor and motion track the footage first and the first step of that is to bring in the undistorted plate not the background plate and then i can select them all press open clip and then i've got my footage from here i hit set scene frames and then prefetch which will load it into my ram and then i start motion tracking [Music] okay so i've got a solver of 0.27 which is pretty good so i'm going to go into the 3d viewport and start setting up my tracking scene so i'm going to do setup tracking scene look it through the camera view and then i'm going to set these as the floor i'm going to set this as my origin and then i'll do the rest manually you might notice when i'm playing through that the uh playback is really stuttery that's because at the moment the tracking scene is using the ud plate so if i go into the camera settings and open background image and then i set it to use the bg sequence which i exported at 480p instead it should play back a lot more smoothly so then i'm going to rotate the whole scene until the x and y axis line up a bit better so let's go for something like that then i'm just going to move the plane scale up to be the same sort of size as the ground something like that looks pretty good the track's looking pretty solid which is always nice to see so at this point i would bring in some cg and in this case i'm just going to do a tie fighter because i've been watching the mandalorian and i'm in a very star warsy mood then to get the lighting to look good i always use an hdri instead of lights in blender because it looks a lot more realistic for vfx so i'm going to bring in an environment texture and then just to fine-tune it if i turn off the display of the background image in the camera now i can work out where the sun is and put it in the correct direction so currently the sun is definitely in the wrong place the sunset was kind of over here in the actual footage that i shot so i'm just going to rotate that until it's kind of in the correct position that looks pretty good maybe about there so now at this point it's time to do the over scan which i was talking about in nuke before the original resolution of this was 1920 by 1080 and then with the lens distortion it gets over scanned to 1954 by 10.99 there's an overscan add-on for blender you can download i'll leave a link to in the description as well it's really simple to install just install it like any other add-on in blender and then once it's installed it will appear over here in the dimensions tab turn on use overscan and then in here you put the resolution of the overscan plate so 1954 by 10.99 usually i do times 0.102 on both of these as well just to add a little bit more just in case because sometimes you need a bit more than you think in nuke and that's actually changed our camera size in blender so i turn this on and off you can see that it's changing ever so slightly so this will allow us to render our cg at the same resolution as the undistorted overscan plate for rendering and blender instead of using the normal output tab i do it through the compositor because that way it's much easier to set up for more advanced renders so i have a file output node and i'll set this render layer to be called tie fighter and then it should appear here so this is the render layer i'm currently using and then i'm using a file output node to output all of these passes and the reason for this is because i renamed some of them like image gets renamed to rgba so that it's more compatible with nuke if you don't rename it to rgba then the default channel in nuke will be black when you bring in the cg you won't see anything so it's kind of annoying this is a way to get around that so that when you bring it in it looks correct i also render a missed pass which is what i use for depth and then depending on what else i'm rendering i'll do some other ones as well so for this i'm going to do the diffuse and the glossy direct indirect in color i probably won't use a mission because there's no lights on this model all of these passes get enabled in the render layers tab and you can turn them all on and off by ticking these boxes like so and i also turn on denoising data for the main rgb channel i use optics denoising now i use it for pretty much everything now because you can render at lower samples and it still looks good so i run the image into there and then also use the denoising normal and albedo and then the denoised image goes into the rgba input on the file output node so i'm going to set where this is going to go and in this case it's going to go into the blender folder in renders so shot one blender renders and i'm gonna make a folder i'm just gonna call this tie fighter and under the properties i set this to be an open exr multi layer so we're rendering it to exr just like we did from nuke for the color depth i'm gonna set it to half because there's no passes that need any high precision color detail codec zip lossless then i'm going to create a second render layer that's going to be for the shadow so i'm going to add a new view layer and i'm going to call this shadow and then i'm going to select shadow down here and i'm going to make another file output node or just duplicate the old one take the image output from the shadows render layer and plug it into rgba and then i'm going to go to where this is being saved make a new folder called shadows and then those two are ready to go and when i hit render it's going to render both of those at the same time and put them in the corresponding folders which is really handy so now to set up the holdouts and things in the first tie fighter layer i'm going to set the floor and move it into a collection called floor then i'm going to select the tie fighter press m and move this into a new collection called tie fighter then in the tie fighter render layer i'm going to set the floor to be a holdout and in the shadows layer i'm going to set the tie fighter to be set indirect only which means it'll cast shadows but it won't appear in the render then once that's rendered what you can do is jump into nuke and start compositing i had to take a break because i'm losing my voice that's how much i've talked in this video let's read in the exr sequences that we rendered from blender i only rendered one frame for now but i'll re-render the whole thing at some point so i can actually play it in this video we have our shadow which is just an alpha channel we have our tie fighter the first order of business is applying a lens distortion onto the cg as you can see these are rendered at the overscan resolution which i was talking about earlier so what we want to do is scale these down to the same size as the background image which is 1080p 1920x1080 so what i'm going to do is add a reformat node onto the cg i'm going to change the resize type to none and as you can see now this is 1920 by 1080. what it's done is scaled it up from the center slightly to make it fit and it's cropped the edges so we've now lost that overscan even though it is still technically there what you can do to fix that is turn on this box called preserve bounding box if i make this bigger you can see it properly if you turn this on it will preserve the bounding box and any of the pixels that get scaled up outside of this will be retained if you leave it off it actually crops them out which is what you don't want then once that's done you take the lens distortion node you use to undistort the footage copy and paste this underneath the reformat node and then we want to do the inverse of what this is currently doing so the moment it's trying to undistort the cg what we want to do is redistort it so it applies the lens distortion so you turn off the undistort box in the lens distortion node and now as you can see it's applying the lens distortion it's not massively obvious in this because lens distortion mostly occurs at the edges of the frame but if i toggle it on and off you can see that it is doing a bit towards the edges of the tie fighter so then what you can do is start to merge this over the background footage it's important to do this over the original don't do it over the undistorted that's very counter-intuitive so this is what that looks like then we also want to put our lens distortion on the shadow and now if i look at the shadow alpha it looks like this and then to use the shadow pass i add a grade node onto the footage and then i use the alpha of the cg shadow to grade this down which does this and then on top of that goes the tie fighter the shadow is pretty subtle but you can see what it's doing there to start pulling the cg around a little bit more and playing with the different passes there's a couple of methods you can do the first one is a full shader rebuild which looks a little bit like this this is one that i set up that uses the render passes from blender and splits them out into the appropriate sections and then you can grade them all individually so this is our cg render it splits them out into your diffuse and your glossy and the direct indirect in color for each of those and then once you've made the adjustments you like they all get plus back together and essentially recombined back into the final image which looks like this so that's one way of doing it but there's another slightly easier way that i kind of prefer these days that looks a little bit less crazy and that's just shuffling out the parts you want to change so let's say i want to change the glossy direct i can shuffle out the glossy direct like this and then i'm going to use a from operation to take this away from the original beauty image like so so basically this is taking all the glossy direct parts out of the original beauty image then you can add a grade onto here and make any adjustments you want to make like let's say i want it to be a bit less shiny so it takes the gain down a little bit and then you plus this back on top later on and because we're taking it away here and then putting it back on top here we're combining it into the full image again but with the adjusted colors and then just to make sure i haven't wrecked any of the edges or the alpha i unpre-mould it at this point and then i add a copy node and copy in the original alpha from the cg like so and then add a pre-mult node under this and then it should be back to normal at this point i usually go in and start doing things like adjusting the black point to match the footage and doing some basic color correction [Music] this compositing obviously looks pretty terrible right now i did a bit more comp on it i put some light wrap and stuff on it but still it's pretty rough doesn't look particularly good then at this point i add a crop node and then i write it back out to davinci resolve and bring it back into the edit hit render press ok so in davinci i'm going to go import media if i drop this on top of the original footage and then i can sort of turn it on and off and you can see they look exactly the same up here minus the tie fighter and then really the final step is just doing any color correction or color grading that i want to do so for example i would probably bring the sky down a bit because it's a bit mental so if i do a luma key i can play around with some of this and just like that with a bit of magic we've got some sky detail back which looks nice [Music] so that's my color grade nothing too crazy i've just kind of brought the sky down a bit and put a vignette on it really and then the grade is the final step and then basically i go to the deliver page and export it to youtube so that's the entirety of my vfx workflow going from bringing in the footage to exporting it to youtube at the other end like i said that's using davinci resolve nuke and blender those are the three pieces of software that i use all of those are free as well blender is obviously free i use the free version of davinci resolve because it's still super powerful and i use the non-commercial version of nuke so if anyone's interested in adopting this workflow it won't cost you anything i think this might be quite a long video once it's edited but hopefully that's a good overview over the whole process and you've probably learned one or two things along the way thank you very much for watching leave a like and subscribe if you enjoyed and i'll see you next [Music] time you