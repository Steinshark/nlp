steve welcome back um what is it we're going to talk about today then well i thought we'd have a chat about ebooks i mean i dusted off my kindle uh the other day and i've been using that to read various things i thought it'd be uh it's about time we had a good chat about how ebooks work and the formats that are used for them brady and i did a video where we looked at the text formatting involved in making something look nice on an ebook reader i think you pre-play into this oh absolutely but what we haven't talked about is how do you actually represent an ebook how do you create the file format that's going to need can you just use something like pdf or html which has been used before or do you need to create some sort of new file so i thought we'd do today spend a few minutes just having a look at how ebooks work so extremely recently we made a video with professor elton kirk who talked about using some um software to convert a published format into an ebook format we now have an electronic and ebook version of it is this the same kind of thing we're talking about today yes i mean that software is going to produce an epub file for certain ebook readers and um a dot moby file if it's going to something like a kindle so that's the sort of end result what i want to talk about is actually how does that file in particular how does epub actually represent the book i mean you might think this is straightforward i mean we've been printing documents pretty much since computers came along dave's covered things like postscript and pdf and two off before that which had been around since the 60s 70s and 80s in development and why would ebooks be any different i think the easiest thing to understand is if you think about how a book's produced so when a book's produced the writer comes up with whatever they want to write and they will then go and write it either by hand on a typewriter hopefully into a word processor and they will send the publisher that file to then go and create the file so they'll send the publisher let's say a word document and the publisher will see the manuscript from the author in whatever format they've used and they will send that traditionally to an editor to sort of check that it actually is spelled correctly that it does what it says on the tin and make any changes then when the editor and the author are happy with it they will send it to a typesetter who will take the document lay it out neatly to fit on the pages that's going to make up the book and then they can send that to the printers to print the books and it can be shipped to the shops or wherever to be distributed for us to read and that's generally straightforward because all the books are the same size the text is the same size in them you might have a few variations and you might have a large print copy produced you may have paperback and hardback but you're probably going to have two or three different variants of it that will be produced so you can easily typeset it produce a nicely looking layout and then send it off what will often happen these days is that what we receive from the typesetter to the publisher to be sent to the printer is a pdf and you might think well that's great we can display pdfs on our kindle on our ipads why do we need to do anything else well the problem is as we said that pdf has been created for a certain page size a certain book size and we can view that on our device but our device's size is likely to be different to that page size i once spent a few minutes drawing out all the different devices screen sizes i used to view documents electronically and it was a vast different amount of sizes so if we just use pdf great as it is and it displays the document brilliantly then we would either have to scale it down so the text would become very very small or we'd have to sort of scan across it scrolling between it anyone who used pdf in the late 90s early 2000s remember having to read documents online where you end up having to pan across the page to read it all and in the end you just printed it out and read it off piece of a4 paper because it was too much trouble fortunately we've got higher resolutions and bigger monitors so that problem's gone away to an extent but in the e-book realm we have that same problem the kindle has a screen size is about that big the ipad is bigger than that so one of the things they wanted with the formats that represent ebooks is that they want a format that can be displayed on any size screen still just have contained the book but we can load it on this size screen and it displays to this side or we can load it onto an ipad or an iphone an android phone uh whatever device you want to view it on even display on your tv if that's what you wanted to do and it would appear at the right size so we can just take pdf um you might think well what about html html rescale we can resize our web browser to be whatever size we want but html doesn't have a concept of pages and with ebooks they're trying to sort of still things that we're turning the pages of reading the document in a similar fashion we don't want a long scroll of the complete document so what they did was that they created new formats to describe a book specifically for display on an ebook reader specifically as electronic books and these contain the document but they contain it not like pdf or postscript or in its fixed final form but in a form that can be resized to fit whatever display you're using and in addition if you wanted to to include some interactivity to have audio in there or video clips and so on to create the format so it's designed to be able to be reflowed and resize to fit whatever device you want and this is great because it means if you perhaps got a worsening eyesight you can increase the size of the text to make it easier to read and so on so you can personalize how it looks for your own reading preferences so steve who's the they in this situation it depends i mean on the kindle that they would be amazon who bought moby pocket i think it was many years ago who developed the format that represents them for everyone else they use a format called epub which is developed by a consortium of people who do that he contains people from adobe and other companies that are interested in this a bit like with html and the w3c group but like with pdf and the iso standard there's various people so they is a pretty good capsule to refer to the people who are involved in creating these ebook standards i think is there's a lot of people from various companies is there a sort of special source here that some people like you know guarding their way of doing it or is it fairly open and fairly you know tried and trusted techniques for this yes i mean epub's very open you can go and download the uh specifications you can read through them they're just like the in fact they're on the w3 website as well just like the html stands and so on so that's developed fairly open amazon's is amazon's format i think it is described but it's not it's developed for what amazon need i think is probably the best way of putting it so i think a good place to start is to actually just take an electronic book in this case i've got one called beautiful code which is a collection of essays by various people including brian kernahan who's appeared on computer file describing bits of code that they found really really interesting to look at it's published by o'reilly it's been around for ages but i happen to have both the physical copy in the office which i can't get to at the moment but also the electronic book format on my laptop and i thought it'd be quite good just to actually have a look at the file and we'll open up the file and just see how it's created and we'll see things that we're almost certainly familiar with in there the first thing to say is that this even though it says dot epub is actually just a zip file it's just a standard zip file like any other zip file and we can extract that so if i um just use the command line i've created a folder and i unzip that epub file we'll see that it extracts a whole load of files that represent that book and if we look at the things that we've got here we'll see there's some dot png files which is in images we'll see some dot html files that represent the text so i said before you couldn't just use html and you wouldn't want to use it on its own but epub does use html to represent the pages it's just standard xhtml to represent the pages but there's other files alongside that that create the format so just like a word document or an excel document these days and lots of other formats an epub file an electronic book is just a zip file that contains all the things needed to make up that book so what have we got we've got some various files for the open container format which are necessary and these are the same if it's an epub file or a word document but the real interesting stuff is inside this folder here there's a file in here we can see all the html files and so on that represent the different chapters so if i open up this chapter we can see there's a pretty plain looking html file this is the one i was saying by brian kernehan it's about writing a regular expression matcha days been talking about regular expressions a lot there's lots of stuff there so that's just standard file what makes this an ebook and rather than just a standard file is if we scroll down we'll find that there's another file which i shall open in a second there's lots of chapters in this book and they've all been split up into sections and we've got some fonts here as well but there's this file here content.opf and this is the file that defines how the ebook is going to work it's like the sort of backbone of the ebook let me just open this into a text editor this is the the packaging format is perhaps the best way to describe it used for epub this as we can see is a version 2 epub file there is also epub 3 is the more modern standard but a lot of the books still seem to be using epub 2 probably for compatibility reason and if you don't need the extra features offered by epub 3 it probably works pretty well just using epub 2. so yeah epub 3 readers will be able to open an epub 2 file and so on so what do we get in this document well the first section inside the package is the metadata and if we open that up what we'll see is it just describes the book so it includes things like the isbn there and this is using a previously existing format it's rdf it's using what's called dublin core to store the metadata it's an xml representation of this it's just a standard way of representing this data so there's nothing nothing new has been created here a lot of the epub stuff is taking existing technologies and packaging them together to create this ebook format the cleverness is in the software and the way it's then displayed to the user the format is relatively straightforward and you can grab the specs online so we say what the title of the book is in this case it's beautiful code the copyright information who's contributed to it and so on and etc so that section's straight forward and that can then be displayed perhaps on the title page of the book and so on the next section is what's called the manifest and what this does is it describes every single let's call it an asset that's used inside the epub now if you think about it if we were doing this as a on the web we would just put the files on the server and the server could then serve them but epub has been designed to be a self-contained file that can be put for the most cases onto a device and that device can then read the book without ever having to talk to the internet again it may not even have a network connection there's some exceptions in epub 3 for audio and video to be stored externally on the web but in general the epub expects all the files needed to be displaying it to exist within the package that it's being used that and what happens here is we're defining all those files and so we've got a reference to the actual file within the package within the current directory in this case so top.ncx is the first one we can see the same for the different files that make up the document the html files and it defines what they are it gives them an id so they can be referred to elsewhere within this file and it also specifies what their mime type is so that the software knows how to understand it what does mime sum for just yes it's the multi-purpose internet mail extensions but one of the things it defines is a way of identifying each type of file in a way that's unique and this is just so it knows what format to expect them when it's opening them we can then use the right bit to go and get them out of the zip and open that file the other bit we have and this is the most interesting and this is the bit that sort of ties in if you think about a physical book it's a section called the spine and what this does is it takes all the files all the files that contain the the content of the document not the images and things which would then be referenced by those files and it ties them into a specific order that you would appear as you read through the the book so you'd start off perhaps with chapter one and then it would say this is chapter one and that's followed by chapter two and so on and all the files that make up that order so if we look at the spine we will see that the first thing we've got is a reference to the cover so we say we've got a reference to the item which is called cover and if we look in the manifest we will find that there is one of these called cover which refers to cover.html and then if we look at that file we see that that represents the cover of the book and then we have a whole series of other id references and in this case they are not humanly readable you could generate them automatically as is the case here or you could put chapter one chapter two whatever you wanted to do but each of these will appear in the manifest to refer to the file and when you open the ebook on your ebook reader it will open the first one and as you scroll through the pages it will lay them out page after page after page and when you get to the end of whatever file that is it will go on to the next file and lay them out page after page after the page so you can swipe through the different chapters or whatever makes up this book the thing about this is this is defined how you read through the books and the default thing it doesn't define how you would navigate through the book so what we also get right at the top of the spine and this is something where epub 2 which is the file we've got here differs from e.3 which is what came later you'll see that on the actual spying element in the xml we have a reference to the table of contents which is the file ncx toc if we look in the manifest we'll see that's the first one that that's a file it's called talk.ncx and it has a mime type of application x dtb ncx xml what's going on here well this is actually using an earlier standard which was um called daisy which was developed for producing audio books so it's a it's a file the format for creating audio books but it also contained a way of describing the table of contacts in there in a sort of xml format and if we have a look at that file you'll see this is another xml file that defines the table of contents so let's say the book's title is beautiful code and then we have a navigation map that says we have a navigation point which is this one which is the first thing has a title beautiful code then content another navigation point and so on and this defines a table of contents which the software could then render for it this is one of the things that changed in epub 3 is that they actually instead of using the daisy format that said no what we'll do is we'll store the navigation document using xhtml using some of the new tags in html5 in this case the nav tag so you just define it as an xhtml document using a very precise subset of xhtml that should be said in this case that can then be loaded in by the epub reader to do the same sort of thing and you tag it in the manifest as being the navigation file with the properties tag on there but the actual layout of the document is just standard xhtml as we saw so if i find chapter one again we can bring that up and it's just standard text you can use a lot of the features of html or xhtml when you're laying these things out but certain aspects of css aren't necessarily supported by all ebook readers and so on so you might probably want to look at the specs to make sure you choose the right ones that you use but you can get some pretty good layout as we can see here epub 3 extended this allowing things for animations you can use svg in there instead of html if you want to get a more fixed layout in certain sections and you can sort of sequence things so that some audio can play when you click get to part of the text or video styles starts at the same time and so on way before i had any kind of ebook reader i remember reading a story about 1984 big brother ironically being or maybe it wasn't ironic being removed from people's ebook readers i think it was kindle at a time but i'm not sure uh it's a vague memory of of thinking wow well that's the ultimate big brother you know you're trying to read a book and then somebody takes it away from you why and how does that happen yeah i mean i remember the exact story was 1984 on the kindle i think although perhaps fahrenheit 451 would be a more appropriate book for it to have happened whether we like it or not and i think it's right people who write books write it to support their families they expect to be renumerated from it and so the ebook formats do have support built into them to support digital rights management so that you can buy a copy of a book but it's limited to you so i can buy a book and read it but if i send the file to you you would not be able to open it and the way that works is very straightforward within the file the actual contents the assets the html files the image files and so on they're encrypted uh using standard encryption technology and inside the ebook package the person who's selling it to you so this is apple with their system on ibooks or adobe with their bookstore can use their digital rights management to make sure you've got the key so that you can decrypt it but i can't then send it to someone else so that they can decrypt it and so on so today alter the file for each book then is it is each book different or is it that they're literally giving you the keys with the book um good question i haven't delved into it in any detail but i mean there's two ways you could do it you could encrypt the files using a key and then encrypt those keys within the file so that only you can decrypt the key to decrypt it um or you can encrypt it specifically for the user if you think about the way these are being distributed they're being sent from a server to you so it'd be very easy for the server to just go through and encrypt each of these files and create the the encrypted file on the fly as it does that so i imagine that's what's happened certainly that's what happens with things like apple's itunes store when they were selling music that was encrypted back in the early 2000s they encrypted it on the fly specifically for you or me or whoever's listening if these eve publishing formats have got all these kind of flexible options and possibilities will they overtake and replace things like pdf so that's a good question um will it replace the web will you replace pdf um interesting question i mean it's been 10 years now that these have been on the the field i mean i think i've bought my first ebook reader in 2009 2010 if not earlier ebook sales have shot up stagnated perhaps dropped a bit maybe coronavirus will mean people prefer to buy ebooks electronically rather than venture into a bookstore to buy a physical book covered in viruses interesting we're now talking about the uh computer version being safe from viruses and the physical one being but i digress uh yeah but um it hasn't yet there's also they do different things so the advantage of pdf you know what the author wrote and saw when they wrote it is what i'm seeing now you've got that canonical representation that we've both seen you don't get that with epub and there are some cases where that is absolutely important you can see in the legal profession you can never replace pdf there with epub because it just would not be acceptable and even perhaps with sort of the scientific and academic community things people do want to change things away from pdf but there is something to know that the document you're reading is what the author wrote and you know that if that equation looks like that that's what the author intended it to look like even if it's wrong rather than that that's how the software has interpreted it to so i i'm i still think this this space for both formats and i think they both have their advantages and interestingly you are able to drop a pdf into an epub document to use it as an alternate representation and you can reflow pdf to certain extent but that's a story for another time right early on you mentioned you could even put it on your tv i remember being so into a book at one point i was reading it on my phone and i had a chromecast an android phone and i went to eat my lunch and i i cast the book onto the tv which we have on the wall in the kitchen so i could eat my lunch still reading the book