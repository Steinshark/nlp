Hi, I'm Alex from TailScale and in today's video I'm going to show you how to set up searching. SearXNG searching, at least I think that's how you say it. This is a fully open source, self-hosted search engine that lets you combine multiple search engines into one place. There's no tracking, there are no ads, and it's fully privacy respecting. So in today's video I'm going to show you how to set that up using Docker Compose and also add it to your tail net so that you don't have to expose it to the public internet and you can still retain all the benefits of that self-hosted search engine from wherever you are. Those of you that have been around this channel for a little while will know that I'm pretty big into self-hosting. I also love me some Docker and Proxmox too. So we're going to combine all of those things today into our solution. Now we need to start by creating a runtime, somewhere to run this search instance. It doesn't need much in the way of resources and I'm going to use my Dell 1L PC Proxmox cluster. This thing is just three of those 1L Dell PCs in a little rack downstairs. It really doesn't need much compute power. This would quite happily run on a Raspberry Pi for example. Now I'm going to create a container on top of Proxmox. It's entirely up to you whether it's a virtual machine or a container. I should probably just show you actually how to download a template first. So if you're brand new to Proxmox and again the Proxmox part of this is optional but this is my platform of choice for virtualization. So I go to the local option here on this node and then CT templates. I click download. No I don't. I click templates. And then I just search for Debian. This is my container runtime of choice. 12.7-1 is the latest at the time of recording. I really have this one. So now I want to do create CT up here in the top right. I'm going to give it a number of, I don't know, 2001. Maybe I should call it a space odyssey. Space oddity. There we go. Isn't that a David Bowie song? Anyway. Let's do the password in here. I'm not going to worry about an SSH key file because I'm going to run tail scale in this thing. I'm going to store the storage here on the local node. Disk. It doesn't need much. So I'll just give it 20 gig. It doesn't really need much at all. CPUs. Again, we're not doing much with this. So I'll just give it four CPU cores and RAM. I don't know. Four gig. Just, again, a fairly arbitrary small amount of storage here. All right. So in terms of the networking, I'm going to give it a IP address on my network of 10.42.37.100.24. So the slash 24 part is, do you remember the subnet masks that you've seen many times? 255.255.255.0. Slash 24 is a humane way of writing that for a change. So that's all we're going to do here. And then we're going to put the gateway for my local network into this box here. So this is just where my router or my firewall is or whatever is doing the gateway routing for this specific network. So yours might look something like 192.168.1.99.24. And your gateway may very well look like 192.168.1.1. All right. But it's going to be very dependent on your network setup as to what the IP address you give this container is. Now, none of this is specific to searching. This is all just sort of basic network stuff, creating a virtual machine or what have you. If you already have a Docker host, there are chapters down below and you can just skip this entire section. Because we're going to jump to a point later on where we're just using Docker Compose to spin this thing up. So if that's you, use the chapters and skip ahead. All right. So we are going to leave the host and the DNS. I'm actually going to change this because I wanted to override resolve.conf inside the container such that it always has DNS. In fact, I think I'm going to do this with the DNS of the gateway itself rather than pointing out to Cloudflare publicly. All right. So that's done. Now, because this is Proxmox and LXC, we're going to need, I want to install TailScale in this thing. So we're going to need to make a slight change to the configuration here. So if we type TailScale LXC into, ironically, into Google and scroll down and just get this little instruction section here and just copy these two lines onto your clipboard. We're then going to need to go back to our Proxmox host. Note the container number 2001. Okay. Go to Shell. Bring up an editor. I'm going to use Vim. So Etsy slash PVE LXC 2001.conf. And then I'll do a Shift G to go to the bottom of the file. And then I'll do an O to add a new line underneath what I've already got. And then press Escape. And then colon, right, quit. This is going to give that container permission to create devices on the DevNet Tun device so that TailScale can actually run inside the LXC container. Then I'm going to do PCT Start 2001. Not 2011. Then I'm going to do PCT Start 2001. And this is going to start this container up. So now if we jump into the shell here, we can see I've got a brand new LXC container. I'm just going to update my packages out of habit. There usually isn't a huge amount on these images. But just for the sake of completeness, I like to do these updates before I proceed. Now next, we're going to need to install TailScale. So whilst that's running in the background, I'm going to do TailScale download. Again, the irony that we're using Google for this. And click on the Linux option here. And then just get the one-click install command that's there. Now I'm going to curl and install that. And of course, because it's Debian, curl is too much bloat to install out of the box. So I'm going to do an apt install curl. And then I'm going to curl and install TailScale this way. I'm also going to install Docker as well. So I'm going to go to get.docker.com. Copy this first half of this step number one to my clipboard. TailScale is now installed. So I'm going to do curl and then just pipe it to shell. If you're not comfortable with doing that, you can follow the instructions on the Docker site and do it all step by step. But this just does it all in one go for me. Once the LXC container is rebooted, go ahead and get logged in again. And then do a TailScale up. I'm going to do a dash dash SSH just because habit. I like to be able to SSH into everything on my TailNet. I'm going to copy this authentication URL. This presupposes I've already got a TailNet created. If you haven't, you can go ahead here and sign up for one at TailScale.com. I'm going to authenticate with my Google identity provider, which is the one that I use for all of these demos. I'm then going to connect the device space oddity to the tail and scales at Gmail TailNet. So you'll see in here there's a few different nodes. I actually don't need this one anymore because this was all stuff I was doing last week for live streams. So you can see we've got a couple of nodes in here. In fact, I'm going to remove this one too. We've got Baldrick, which is this laptop here on my desk, and Space Oddity, which is the search engine, or at least it will be, that's running in my little ProxMox cluster. So that's all well and good now. And I think if we do a TailScale status, we should see that we've got the Linux node logged in as well as this laptop too. Now the next step is to create the Docker Compose file that's going to drive all of the searching stuff that we're doing here. The searching, searchxng instance that we're doing. I wrote a blog post over at blog.kcz.me, and I'll put a link to this in the description down below. Inside of this blog post is a little description, a little gist of the Docker Compose file. So this is going to take you to GitHub and a little gist I put together. So all we want to do is go to the raw version and then copy and paste this onto our clipboard. Now we're going to go back to the searching LXC container and just type VI, again Vim, compose.yaml. I'm going to press I to go into insert mode, paste that in like you would any other file with a command V or control V. And then the only thing that we need to set is your searching base URL. Now where do we get this? With TailScale at least, every single node gets a fully qualified domain name for free out of the box. And that's what we're going to use today. So head over to your TailScale admin console, go to DNS, and just take note of this TailNet name here. If you haven't rolled a custom name yet, feel free to go ahead and do so. It's totally optional. But you're going to want to click on rename TailNet and then go through and roll the dice so that you get a fun novelty name like Velociraptor-Noodlefish. You're also going to want to make sure that you've got Magic DNS and HTTPS certificates enabled as well. Now, we don't really want to be typing space oddity every single time that we go for our searches, do we? So I'm going to make this slightly easier for us and go into the TailScale admin console page and rename this node from space oddity, as fun as that is, to search. So essentially what we're going to end up with now is a fully qualified domain name of search.velociraptor-noodlefish.ts.net. And we're going to be able to use that fully qualified domain name to generate a TLS certificate from Let's Encrypt. That will mean that our browsers trust the search front end that we're about to create. And then you can also search directly from your phone, even if you're not at home or wherever this particular machine is living. So I'm just going to copy the fully qualified domain name onto my clipboard and then go back to Proxmox and continue modifying my Docker Compose file. Now, I'm going to modify from where my cursor is until the end of the line. And I can do that with a C dollar sign and then just do a command V. And it's going to paste in search.velociraptor-noodlefish.ts.net. I'm going to press escape to exit insert mode and then do a write quit with command WQ. Next, I want to do a Docker Compose up. And this is going to now create the searching instance as well as the redis instance that it uses to cache a bunch of data. Once that started, we exposed port 8080 in the Docker Compose file. We can go over to our browser. And this notice is running on port 8080 on plain HTTP. But it works. So now we can do a quick test here and just search for whatever we like. You can see that it's using DuckDuckGo, Quant, Google, Brave, Wikidata and Wikipedia all under the hood. So now we want to add this to our tail net. OK. And the easiest way to do that. Remember, we've already added the LXC container itself to our tail net, which is indeed how we're even accessing this site right now. We want to use tailscale serve to generate us a TLS certificate for this domain. So we verified that searching is running properly and I've quit that using control C. I'm now going to do Docker Compose up minus D to bring this up in the background. By the way, if you want to monitor those logs, you can do a Docker Compose logs minus F and it will print out exactly what's going on in real time. Again, control C to escape those. But to expose port 8080 or this container to our tail net, we're going to need to use a tailscale serve command. Tailscale serve, you can kind of think of it a little bit like a built in reverse proxy for your tail net. One command and it will turn any requests that go to that specific port into a fully TLS backed with Let's Encrypt domain on TS.net. There is some documentation over here, which I highly recommend you take a read of if you want to learn more. But the short version is all you want to do is tailscale serve dash dash BG 8080. And this is going to make available within your tail net only, not on the public internet, only if you are authenticated to a device on your tail net. Now it's really important because we don't want to expose this custom private search engine that's just for me to the public internet. We want to keep it private and secure, right? That's kind of the whole point. So you can see here that we've exposed localhost 127.001 on port 8080 to this URL here, so https search.blah. Now the first time you connect to this URL, it's going to take 5 to 20 seconds depending on how busy the Let's Encrypt API is today. Why it takes so long is because it's generating a certificate in real time in the background for you. So it's doing the DNS challenge and all that kind of stuff to verify that you actually own this specific domain name. And after that little wait is complete, which in my case took about 15 seconds, you can see I've got my fully self-hosted search engine available to me anywhere that I want to be connected to this tail net. So again, I can just search for tail scale and it's going to bring me up a nicely formatted set of search results. No ads, no tracking, respecting all of my privacy. Oh, it's just so wonderful. We've now set the entire thing up, but there's one little cherry on the cake that I want to just add in this final chapter for you. And that is how do we make Google Chrome use this search engine as our default moving forward? It's actually really easy. So again, full details of this are in the blog post, which will be linked in the description down below. And it's a mere 13 step process, but I promise you it's not that bad. So what we want to do is go to the three dot menu up here in the top right hand corner, click on settings. And then search engine over here on the left. Manage search engines and site search. You can ignore all of this. You can just probably leave the keyboard shortcut of space or tab exactly as it was. Then scroll down a little bit to where it says site search. Now, Google, I'm going to be a little cynical for a moment here. Don't make it very obvious how to change the default search in Chrome, do they? You'd think looking at this that it's not possible. But if you scroll down to this site search section just here, click on add. And I'm just going to call mine searching. The shortcut can again be at searching. It doesn't really matter what the shortcut is, I don't think. And I'm just going to grab this URL right here. Now, in the syntax that's required for this specific field here, we're going to need to do a little bit of substitute and replace. You can see that in the blog post, I talk about needing to do a percent sign. So what we want to do is after the URL, we're going to do search and then a question mark and then the query just here. So let me explain that one more time. So we've got the full domain name, fully qualified domain name for our searching instance. So search velociraptor noodlefish.ts.net. And then once you get to the slash, if you type search and then a question mark and Q for query equals and then a percent sign and S, what that's going to do is the percent sign S part does a string substitution. And it does that string substitution and replaces the contents of percent S with the query that you just typed in your search box. Click on add. And then the magic part is if you click on that three dot menu just there and click on make default. Every time we now do a search for, again, I'm going to just search for tail scale. Notice it says searching search. And it's going to search through velociraptor noodlefish. And I'm going to search for, oh, I don't know, Taylor Swift. I'm not exactly a big Taylor Swift fan. Who I am a big fan of, Porcupine Tree. There we go. Let's get things back on track. Fantastic. Stephen Wilson, by the way. Chef's kiss. Wonderful musician, if you've never heard of him. So I think that will probably cover us for today. What do we do? I'm just going to recap real quick. We created an LXC container on top of Proxmox. We installed Docker inside the LXC container and tail scale too. We then span up a searching instance such that we can have completely local search searches and respect our privacy once more as it pertains to tracking and ads and just the vomit that comes out of modern search engines. And then we put it on our tail net using tail scale serve. So we can now access this from our phone at the coffee shop or wherever we happen to be, even if we're not on our local Wi-Fi, for example. Now, if you want to know more about tail scale, you can look for the links in the description down below. We do regular live streams on this channel talking about all sorts of wonderful things to do with tail scale. And until next time, thank you so much for watching. I've been Alex from tail scale. I've been Alex from tail scale. I've been Alex from tail scale. I've been Alex from tail scale. I've been Alex from tail scale.