- Okay, looks like we're up and running. Hi everybody, welcome. Hi DEFCON, hi DEFCON 29. Thanks for everybody tuning Hopefully next year we get Here we are. So hi guys, my name's Richard. We'll get to that in a second. This is my talk on barcodes E-I-E-I CAR. I have to apologize for I have two monitors and my So who am I? My name is Richard Henderson. I'm a ham radio nerd. I write for a living a lot, I currently work as a CSO. I've trained at DEFCON I've gone 25, 26, 27, DEFCON China Beta One. I've run the Ham Radio for a few years. Did not run it this year, didn't know what was going to happen. So, it'll be back next year, I hope. And richsentme is how you can find me on Twitter and LinkedIn. So feel free to connect. So, let's talk here for a second. What would happen if you built take inputs from barcodes that didn't do any sort of input validation. What sort of hi-jinks could you get up to? Could you crash a system a simple string of text? You sure can. We'll come back to this during the talk and we'll The bottom line is yes, there are a lot of systems out there that through nothing more than we'll make it fall over crash, So let's talk about the EICAR string. The EICAR string is kind of the key here. Although we'll get to other strings that might cause mischief later. But in this case, we're talking So what is the EICAR string? That's the EICAR string. It's a substantially long that with enough randomness in it that you wouldn't find it just by chance. So you know that if you you are looking at the EICAR string. So who created it? What's it used for? How does it work? In a nutshell, the EICAR European Institute for EICAR. And it's a method to test the ability of antivirus So it's used by pretty much tech company that incorporates some sort of antivirus So think like firewalls, things like that. And they use it to make sure Well, why would they do that? Well, when you're working with malware, you want to avoid using real whenever possible. Unless you have to work with And the reason for that is to test your firewall to see if it could detect a piece of malware as it moved past the And you decided you'd use piece of ransomware that you found online. When that ransomware escaped infecting other machines, So EICAR came about as a way Create a text string, which you can embed in another small file. You can compress it, hide it, and see if you're antivirus Think of it as a virus that the general antivirus community but doesn't have any malicious Okay. QR codes. Everybody's seen QR codes Who created those? What are they used for and how do they work? So the &quot;QR&quot; in QR code And it was created by the DENSO, in the mid 1990s. If you own a Japanese car, your car is likely full of computers, things like that. So why did they create it? Well, there's a bunch of you can simply just store in a QR code that you can in... Do I have one around here somewhere? Here we go. Than in a simple UPC card. I'm not going to show you that's got some sets of data on it. And it's so like, you you'd see on a box of So, what's inside a QR code? So QR codes are really, really brilliant when you look at them and you start to dissect how they work. So if you see 4.1. Position. What that means... I'm which I guess in a virtual talk, The position squares basically how to orient the barcode. You could see there's always and there's never a position of a barcode. And that allows the they're taking a picture of a QR code, like this one right here, it doesn't matter what way it's scanned. The computer always knows that this spot right here should be, so this is mirrored, but Alignment is really neat. So alignment squares are See, even though, if you like this on an angle, it knows the alignment square So it can create like those we did an art school and high school, in art class in high school. To know that it can everything square or square facing the computer. So what would happen if you You put the EICAR string on a QR code. Well, you get something like this. So again, I'm going to come in a couple of minutes and we're looking at and where this screenshot was taken. But let's stop for a minute. And we're going to talk about where did this whole thing start? Where did the idea of turning EICAR into a QR code come from? So, special shout out Rob Rosenberger, who planted the seed in my head of systems out there that And a lot of them won't know EICAR string. So in this case, if you he put the EICAR string as a I think on the front of his car as well, with the idea of maybe triggering antivirus response on license plate scanners, toll But what was interesting is running on his Android phone So we're gonna talk a little in a couple minutes, get the code picked up by cameras you might encounter whenever you're driving around. So like toll booth cameras, automatic license plate reading cameras, like the ones you see by law enforcement cars, parking enforcement cars, private parking lots is a good one. So initially it was just a without access to the actual If its scanned it, you if it actually triggered something. But it definitely does work. I'm gonna share a couple couple of minutes to show So beyond a sticker on your car, what else could you do with this? So enter the embroidered EICAR QR patch. So what do you think might EICAR text string with Stick it on your stick it on your shirt, whatever. In many cases you'd have to be really, really close to the camera to have it pick up the QR code, but cameras are getting I mean, 4K cameras are not I have one at the front of my house now, cost a couple hundred bucks. Go to Costco, Costco sells well not dozens, but a half dozen cameras So cameras are getting and they're going to be even if you're not particularly So. Let's go to the next slide. So devices that you think interpret a QR code absolutely can. So this is a checkout terminal for a very large, multinational that I will not name. Why would a checkout scanner that should only need to that you find on like a box of cereal need to read a QR code at all? Well, this is clearly added functionality provided to the retailer by the checkout, machine And it's probably built development phase. You know, things like they might want to add loyalty coupons, purchase tracking, things like that. And also, for example, they'll send you a QR code coupon on your and it can read it. They build this into the product all of this to all the customers and not all the customers but they want it there That's how things work with But what happened in this specific case? So the code was scanned. It correctly scanned the string. Can you see my mouse? But if you look at the top you can see that it clearly the QR code. And it just instantly returned this error. So what happened after this was scanned? So the checkout became Didn't matter what button you what you tried to do. It was totally unresponsive. Even a manual intervention by help you check out, really they're just there to But they came over. They They even said, 'We never seen anything like that before.' And then the register after quite a long wait. So I'll talk about more about, what's probably happening but the reality is you could and scan this and crash every single one. And no one would have any idea how to fix it until it fixed itself. Okay. So. I'm gonna play a video. This video is sent to cause I would never do That would be really dumb. This is a passport scanner some country, somewhere. But many countries now to pull up your smartphone, fill out your customs form ahead of time. And that app creates... I don't think I have one UI. Yeah. It's not working. I'm sorry. So, they'll give you a QR code. Basically, instead of getting those old school paper customs forms where you fill out where you what date you were gone, how do you have any drugs, you just check off a bunch of And it gives you a QR code, which the QR code contains the answers to all your questions. So what would happen if you scanned one of those machines with the EICAR string? Let's see. And it's So I'll walk through it - [Person From Video] Yeah. - Stupid slides. I'm gonna have to back up Okay. So I can't pause it and show you, but basically what happened a big fat red error message on the screen and then froze completely with just a total black screen. So like I said, I highly suggest you do not, cause believe it or not, customs officers don't really with machines at a port of entry. So what happened here? Don't know for sure. But it did not like the input. Was not expecting the input and it froze the machine. Did not cause, as far as a general system outage which would have been real bad. You literally could walk and scan your QR code there and it worked. So what can we infer from that? These terminals aren't super smart. They limit the amount of a central database or central source, which makes sense because its reading the questions you and filling out the form But other systems are sending a centralized location for processing. So let's watch a few minutes of video and then we'll explain what happened here. - [Person Recording] Thanks Richard. Now we're stuck here because goddamn barcode. He crashed the fucking machine. It's fucked. He scanned that fucking EICAR thing. Now we're fucked. Thanks Richard. Now we're Minutes later. - [Attendant Over - [Mike] Thank you. - [Person Recording] Good job. - [Mike] Are you recording a video? - [Person Recording] Yes, I am. Good job. - If they gave me the ticket back, I could go to the other one. - [Woman Recording] Yeah. Mr. - [Attendant Over Speaker] Is - [Mike] No, there's nobody here. I can use another machine, but my ticket's in the machine, so. - [Attendant Over Speaker] - [Mike] Okay, thank you. - [Person Recording] Fuck me. - So, so, he got one of those tickets from the parking garage when you go in and then he stuck the EICAR QR and then inserted the and the ticket wouldn't but there's still two more videos. So let's keep watching. - [Person Recording] 10 minutes later. Still fucked. - Hello hi there. - [Attendant Over Speaker] Yes sir, I am not able to reach Can I get your first and last name? - I'll just go to, there's literally 20 feet behind me. I'm just going to back Like he's sitting there- - [Attendant Over Speaker] - He's sitting there staring at me. I don't know why he doesn't - [Attendant Over Speaker] and help you, sir. Long as he's sitting there. - Yeah that would be nice, but he's kind of an idiot apparently, so. Anyway, I'll just back up and go see him. - [Attendant Over Speaker] or I can just open the I'll go talk to the guy. Cause I mean- - [Person Recording] Let's - If you can open the gate you I haven't paid yet, so. - [Attendant Over Speaker] If I can get your name and number, first and last name and a phone number. - I'll just go to the Don't worry about it. - [Attendant Over Speaker] Okay. - [Person Recording] Okay the entire fucking payment system in this entire fucking parking garage. So no one can get out. Apparently they can get Fucked. So the attendant's going up Go in front of this fucker. Fucking hosed, bud. Hosed. Fucked up big time, buddy. - [Mike] Yeah. - Okay. So what happened here? What can we infer based on People are still able So clearly the ticket machines on the way in don't require the database that's hosted somewhere else, probably in a data center And it makes sense if you think about it because you don't want to slow if there's any sort of the inbound machines likely just record a timestamp of entry, generate a unique bar code and then send it back to a database, and set intervals every couple seconds, couple minutes, who knows. This would be great for greatest internet connectivity. So like, you know, parking terminal, think three isn't going to have the greatest network connectivity, right? Or in some cases they're and don't really want to waste bandwidth. They want to save that for the exit phase, which is what messed everything up. So some people were able to exit as you saw in the last clip, but those were monthly parkers of pass card to exit. So there's probably an that deals with that. And if you look at the lot have a separate reader for monthly parkers to scan their badge. So there's probably just a unique IDs, tied to those ProxCards or whatever ID card they use to get out. And it looks for a match But for people who had to pay to exit, there was no way to get out. The machines ate their tickets So after that last video clip my friends here talked And basically he said his He couldn't do anything. He had to come out to He'd never seen anything like it. So clearly what's happened is to some database somewhere Do I have notes on that? I don't. Oh yeah. So string got transmitted to another computer somewhere else. And whatever AV was running an antivirus alert and dropped to clean the virus. And the whole system went down. They were in there 15, 20 minutes trying to get out the garage. And so were lots of other people. So. Oh, did it again. I'm sorry. So why does this attack work? Well, pretty simply, much like we've seen in industrial control where companies have just to these devices with very little or zero thought of the security implications of doing so, you know, they sell these to companies as money saving measures. You know, you don't have to some remote pumping station because you can do it all remotely now cause they're all They don't really spend people might be able to But the bigger part is that all running Windows or So what does that mean? So like, let's go back to a couple of famous Windows Embedded malware attacks. So Target and Home Depot are Attackers were able to design malware specifically built to skim Windows Embedded cash registers and then exfiltrate all I mean, everybody knows, What's the one of the you put on a Windows machine? You install antivirus, right? So if your antivirus is just antivirus commodity product. And if you haven't done any customization or any tuning of it, which is often the case. It should see the EICAR string and do exactly what it's that it's working properly. And that's quarantine the So in most cases, an antivirus what does it do? A lot of AV makes the system makes it unavailable, throws it into a reboot cycle And this is what's happening So. Why are devices and systems when they should only be Well, there's lots of different And I'll talk about that but you don't always set There's dozens of different So they usually build in that able to cover all their bases, right. So my gut tells me that that's even a thing on and it's probably not easy to turn it off, not without going back to you know, we need to inputs scans. Why would you even ask that? You wouldn't even think So, like I said earlier, you know, added functionality by developer. These companies want to be So they just build it in and don't need it, but it's So let's talk about attack surfaces. What other things might with the EICAR string? So coupons, here's a carwash coupon, A lot of newer or very the really cool ones with the neon lights and the 16 colors of foam They have the ability to accept coupons that you present to the payment machine. And those coupons are often QR codes. And why are they QR codes? Because each QR code can be unique to the person presenting it. It's not like just a coupon code, right? It allows them to track. It allows the marketing people advertising campaigns, right? So they know if this person they'll probably do it again. So you might want to offer them another, but if someone else didn't use it, then it may not be worth So what happens if you scan What else? Price checking scanners. Maybe, maybe not. Really all depends what the and what the underlying system is. So Target, for example. Newer Targets, the newest price code scanners at Target are all Android based tablets. Not like this one on the screen. This is an older one, but while the Target Android ones can read the EICAR string and you could see it if it'll actually interpret the string and show it on the screen. Nothing happens. But other price code scanners? Maybe. So this is a discontinued older of stores. And you can see here that it's running Windows CE 5.0, and it says right on the top, 'fast and intuitive barcode reading of all linear and 2D barcodes.' So linear barcode is just one dimensional barcode, like a UPC code. And 2D means just that like a QR code. And like I said, it's running Windows. So many of the new ones. You go back, you go to like people that provide to small stores and stuff. Most of them all but like we saw in Rob's tweet way back. There's plenty of Android based that detect the EICAR string So what else? Luggage tags. Probably not. All the luggage tags that and the ones I can find online, all use the 1D barcode format with a short identifier strings. Typically it's just two and then a six digit string of numbers to uniquely identify that piece of baggage. That doesn't mean there aren't that can interpret a 2D barcode. So, if you stuck the EICAR who knows what would happen and you probably never unless you can find a friend So if you're watching this airport infrastructure, and I would love to find out if it worked. Feel free to let me know. So the next one is my favorite. Hard to see with the But, automated license plate readers on police cars and parking enforcement, private parking lots, ALPR. Most of the police cars, private parking enforcement, They all have Toughbooks in there cars. You walk by these cars Most Toughbooks are And if you look at the software, I know it's really hard to see, but you can see that The software that's provided Obviously not going to name names, but you can figure it out for yourself. The company claims on its website, that it works with all license plates. No matter where they're from, which means there's gotta and leeway for how it's Because there's thousands of different kinds of license plates, different fonts, different spaces, and different states and So what if you stuck on EICAR sticker next to the license plate It might. I have another slide, but I'm pretty sure I remember printed a SQL string and it crashed the Does that ring a bell, anybody? It's ringing a bell for me. But amazingly, I have yet enforcement officer, a police officer, who will actually let me actually try to see if I can crash their system. No matter how I phrase it no matter how I frame it none of them are interested. But what else? QR codes are being much more prevalent or much more used in things concerts, things like that. So could you present the EICAR and crash a central system? It's very possible. Hospitals. Hospitals are likely very Lots of backend systems are Windows based. I know this for a fact. And I have someone close to and deals with this kind And their backend systems So here's like a patient Here's for those of you with children, when your a kid is born, they put a bracelet around the kid just to track the baby Make sure you leave with the right child. Lots of QR codes on those ones. So these are QR codes just to make sure the right person gets the right blood and follows the chain of it moves through the hospital. So yeah, they should probably Extending this attack. So how do you want to make test your own systems, because this is the only time you should be doing this, right guys? There are, like I said earlier, there are a lot of 2D So you should try and figure out which one your target is using. So here's EICAR as a Data Matrix QR code. Here's the Aztec format. You see this a lot on like things like that. That's the EICAR strain right there. It doesn't look any MaxiCode, you used to see on a lot of, it was either UPS or I think it was UPS. I don't see that on their boxes anymore. I really haven't been and try not to use them. MicroPDF417. That's another barcode format that you'll see in a lot of places. There's the EICAR string there. The Han Xin barcode you probably don't see much here, but you might see it overseas a lot. You might see it on things like that that are These are some of the ones encode the complete EICAR string into. There are lots of other but most of them will not the character space is very limited. In some cases it's just numeric, in some cases it's just alphanumeric, some cases it doesn't use the extended Unicode character set. So there was no asterixis, So what I suggest you do is a barcode generator. There's some really good ones of dozens of different And you can put in whatever There are some that are used specifically for bank transfers, where you put in account details and a receiving bank, sending bank. You could hide the EICAR string in one of those pretty easily. But beyond the EICAR string, could you take some malicious JavaScript and have a system parse it? Or could you do something as a malicious URL? Yeah, QR code. You sure can. So this is from Where this is, if you interpret the standard cross-site scripting alert script that you would write to test for the existence of a cross-site scripting attack. So you could use this to try vulnerable to a cross-site There are cases of malicious in places like Russia, to fool people into signing So like $6 a message type scams, that's happened in the past. But what other systems beyond just like barcode scanners? What would happen if you decided into an RFID tag? Automatic teller machines Could you use the payWave/smart card? You know, the little chip, you're seeing in a lot of places around the world just to could you code the string onto ATM or the data machine? So I'm not going to try and find out, but maybe someone else will, who owns an ATM for experimentation will. Railroads. A lot of railroads have cargo containers to have been doing it for decades. I first learned about this as I was living in Toronto at the time. And there was a main rail I was living at. And we would often go like, And there was a little hut. And there was a big Yagi And you could see when train rolled by, it was pointed in such a way, or it was just pointing at the and doing some reading at the the containers to be able to tell customers where their cargo is. So if someone wants to know, you know, I've got something that's gotta and it's just leaving New Jersey, I want to see where that thing's moving through the rail network. And the way I was able to confirm it was, I was a much younger guy. I was much more willing There was a rail crew working I went up and asked them And they literally were happy to explain, 'Oh yeah, this was an RFID system. Look, here's the manual you use.' So don't be afraid to ask people think that you're a hacker spirit. You just want to learn So, but beyond that, so now a whole bunch of both combat theft and to make So I don't know if you've been in a Uniqlo anytime in the recent couple of years, But you literally just walk your bundle of clothes And they, they know within like a second, what it is you got, what sizes they are, and they tally it all up. They don't have to scan each one anymore. It makes things really fast, but you can get, so here's some of the Uniqlo tags, they use three different types So come back to that in a second, but you can buy on even Let me see if I have a picture of it. I do. Okay. Come back to that a second, I mean, look at the RFID Thief that Bishop I'm pretty sure Proxmark3 can do it, but you can buy just about anything on AliExpress or Amazon these days. That's a roll of RFID I think you buy on Amazon for two bucks. So it would be very simple to some RFID tags and go see if you could make things stop working. Is this shit legal? So, but the question really walking around with a giant causing random camera systems to crash. I mean, you didn't give scan your barcode and why should they be scanning But if you decided to start you walk up to the cash register, you scan it with the EICAR crash and they catch on That's probably not going You know, maybe a mischief who knows. But do you want to try I mean, how can you do this? Sticker Mule, love Sticker Mule. Great place to get small runs but there are lots of other stickers for you cheap. Laser labels work great. Remember QR codes are pretty flexible, are very fault tolerant as to, you know, how rough the scan will be, like if you put something on miles of conveyor belts, you those QR codes are going So there's quite a bit of error to help. So you can print them So embroidered patches, like I I sell them. I do not sell them for a lot of money. I'm not doing this to make money. Figure out how to find them yourself. So I'm not going to shill I can share the design with you. If you want to make a whole I'll tell you who my and introduce you to them. You can make a whole but if you're at DEFCON, this online, come see me And I'll give you a patch for free because I got hundreds of them, hundreds, and I have a new special never released giant EICAR QR string. So come on up, see me. And you can get a patch for free. If you're watching this online, reach out to me on Twitter or something and think I'll go create a special coupon code for you or something. So with that being said, as part of the in-person For the rest of you, did you find something at home yourself? Let me know either on Twitter or you can email at richard@goatse.cx. Yes, that's my real Some of the old timers will email address. And if you're not a gray beard like me, then don't go looking So thanks for listening. It was fantastic to be able And I look forward to in the future. Cheers.