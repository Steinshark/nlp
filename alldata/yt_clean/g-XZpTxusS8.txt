[Music] when you go out to a website where you might be giving credentials or credit card information maybe like a bank or an e-commerce site do you know the i p address of that site i certainly don't know the i p address of my bank so what i do is i use the domain name system or dns to resolve a fairly easy to remember domain name into a not so easy to remember i p address however what if a malicious user convinced us to go to their dns server instead of our legitimate dns server if that were to happen then they could redirect us to their web server that might look like our bank or our ecommerce site and we give our credentials or credit card information to that fake site and suddenly they have our information hi my name is kevin wallace and in this video we want to discuss this type of attack which is called dns spoofing we'll see how an attacker might launch such an attack and we'll talk about how we can defend against this attack and dns spoofing that's a topic appearing on the ceh the certified ethical hacker exam blueprint so if you're preparing for that exam to be a certified ethical hacker you'll want to know how dns spoofing works or if you're just concerned about better protecting your enterprise environment from dns spoofing this is the video for you and we're going to begin by taking a look at an overview of dns spoofing we will walk through a hypothetical example and then we'll see how an attacker might set it up we'll go in to cali linux and using apache we're going to set up a fake website that is going to say evil site when we land on it and we're going to configure a utility that an attacker might use called ettercap and we'll see how they might use that to perform a dns spoofing attack and then we're going to verify that the dns spoofing attack was successful and if you enjoy this video and find it valuable please do me a huge favor and click on like also subscribe and turn on notifications so you don't miss any of our future content and since we are dealing with a utility that could be used for bad purposes i want to make my intent very clear the content that you're about to see is from our professional ethical hacking course and i encourage you to not use this knowledge in any unauthorized way i'm performing the following demonstration on my local equipment that i personally own and this channel definitely does not endorse or encourage malicious or illegal activity using hacking tools in fact it's just the opposite i want to show you how to protect yourself against these type of attacks and this dns spoofing attack can be defeated using a couple of utilities we talked about in a prior video here on the channel called d8cp attacks and defense strategies and i'll leave a link to that video in the description so after you watch this video you may want to go through that other video where i set up the defense strategies in that video we show you how to set up a couple of features called port security and d8cp snooping and those are the features we could use to prevent a dns spoofing attack as we'll talk about in this video and i'm not sure when you're watching this video but if you happen to be watching it before september 28 2022 then i would like to invite you to a completely free deep dive training session that we're doing it's going to be on wednesday september 28th 2022 it's going to be at 2 p.m eastern daylight time and eastern daylight time is utc minus 4. to sign up for this completely free deep dive event which i believe is going to be our longest deep dive ever we're going to cover a ton of security topics just go to kw train dot com slash cyber again that's kw trained dot com slash cyber now let's get into this week's video on dns spoofing in this video let's consider an attack called a dns spoofing attack this is known by another name it's also known as a dns cache poisoning attack to begin let's review how dns functions we've got this laptop on screen and let's say it wants to go to kwtrain.com and on the internet but it doesn't know the ip address of the kw training.com web server so that laptop is going to go ask its dns server hey can you tell me the ip address corresponding to the name of kwtrain.com the dns server receives that and it responds with a message saying yeah that's at 203.0.113.54 that goes back to the laptop and the laptop is going to cache that for a period of time locally and now when it wants to go to kwtn.com it knows the corresponding ip address that can be routed out to the internet however let's say an attacker wants to put up a look-alike page they have a web server and they want to make it look like kw training.com so when somebody goes to log into kwtrain.com they'll actually be logging in to the attacker's website let's say the attacker attaches a web server with an ip address of 172.16.1 but the question is how can that attacker cause the victim's laptop to go to the attacker's web server well one option is they might connect a rogue d8cp server to the network as we previously discussed if the victim's laptop learns ip address information from that rogue dhcp server it might learn the ip address of a dns server which is actually a dns server set up by the attacker which is going to direct the victim to the attacker's web server when the victim is attempting to go to kwtrain.com and another option that i don't have listed here is if the attacker gains access to the victim's laptop they could update the local hosts file on that laptop that's going to take precedence over any dns lookup but assuming the attacker does not have access to the victim's laptop something else they can do and that's what we're going to demonstrate in this video is dns cache poisoning with dns cache poisoning the attacker might be running utilities such as eater cap or ettercap depending on how you want to pronounce that and if they first launch a main in the middle attack as we previously demonstrated with ettercap traffic flowing between the victim's laptop and the dns server is going to flow through the attacker if the attacker specifies the victim's laptop as one target and the dns server as another target so now when the victim's laptop tries to resolve the ip address for kwtrain.com it's going to go to the attacker who's going to respond with a message saying oh yeah kw training.com that's at 172.16.101.150 their fake web server that is set up as a look-alike web server to kwtrain.com attempting to capture the login credentials of the victim now let's go out to a live topology and see how an attacker might pull off a dns spoofing or as it's also known a dns cache poisoning attack and here we are sitting on our kali linux box this is going to be the attacker's machine we're pretending and we're going to set up just as a basic example a fake kwtrain.com website on this machine just to demonstrate that we could redirect to dns queries looking for kw training.com we could divert those to another site so we're not going to go through the process of setting up a local like site i'm just going to set up a basic page so we know that yep our traffic has been diverted first let's see what the ip address is on this calibox let's go open up a terminal and i'll say if config and it looks like our ip address is 192.168.1.102. now let's start the apache web server on this machine to do that i'll do a sudo service apache 2 start and i'll give my super user password and just to demonstrate that this page is up and functioning let's go over to the victim's laptop and directly point to 192.168.1.102 here on the victim's laptop let's go to 192.168. we'll press enter and that is the default web page for our apache 2 server now let's go back to our calibox and really quickly change that page to something that we create so back on our calibox i'm going to cd into slash var slash www html let's list the files in this directory i'm going to edit this index.html file in fact let's move this to a backup file and i'll create a brand new index.html file let's do a sudo move index.html to index hyphen old.html and now let's create our own index.html i'll do a sudo and i'll use the vi editor you can use whatever editor you like on kali linux i'll say index.html and i'm going to make this super basic i'll press i to insert and then i'll give a bold tag and i will say evil sight exclamation point then i'll do a slash b to close out the bowl tag and that's it i'll do an escape colon wq to write and quit let's make sure that file does exist it's readable by everyone awesome and to confirm this webpage is showing up on our victim's laptop let's go back over to the victim's laptop and let's reload 192.168.1.102 and it comes back and it says evil site and now that we have our evil site set up let's discuss how we can use ettercap to resolve dns queries coming from our victim's laptop wanting to get the ip address of kwtrain.com then editor cap is going to respond to the dns query with reply saying that its address is 192.168.1.102 the address of our cali box now before launching edit cap we've got some work to do on a couple of the edit cap configuration files so let's go back to our calibox and let's go into the etsy slash editor cap directory and we need to edit both the edit.configuration or cnf file and the enter dot dns file first let's edit this configuration file we'll do a pseudo vi header dot conf and the first thing i want to do is to give editor cat permissions to do what we want it to do and to do that i need to change this user id and this group id i'm going to change those to zeros so i'll delete those values insert a zero delete those values insert a zero and next there are a few lines that i need to uncomment meaning i need to get rid of the pound sign in front of them that makes them a comment you see the lines i want to uncomment are specific to the operating system that we're running on now i'm running on kali linux so i want to uncomment the lines for linux to jump down to that configuration section i'll do an escape forward slash linux and i've got these four lines i want to remove the pound sign from so i'll get rid of that pound sign and this one common mistake here you also need to get rid of the pound signs in front of the ip version six lines that are commented out so i got rid of those four different pound signs let's do an escape colon wq and now i need to edit that editor.dns file so i'll do a pseudo vi editor.dns and i'm going to go down to the very bottom of this you can read through this if you'd like more information on how to do the formatting but to get to the very bottom i'll do an escape then a shift g i'll do an o to add a new line and i'll say kw train dot com and i'll make this an a record so i'll do a tab capital a and i'll say if you want to go to kwtrain.com go to 192.168.1.102 which is the address of this calibox next i'll say star.kwtrain.com this is also an a record and we'll say go to 192.168.1.102 and let's do one other line i'll do www.kwtrain.com this time it's a pointer record ptr and it's going to go to 192.168.1.102. escape colon right quit and we're done and before running edit cap let's make sure that our laptop is getting to the actual web page that we want so let's go back to our victims laptop again and i'm going to go to www.kwtrain.com and there's my web page perfect and in this example as is often the case the victim's laptop is using its default gateway as its dns server and its default gateway is 192.168.1.1 and like we did in a previous video we want to do an arp poisoning attack on traffic going between the victim's laptop and that gateway let's see what the victim's laptop ip address is let's do an if config and it looks like it's 192.168.1.105. so let's go back over to our cali box and under the menu under sniffing and spoofing i'll say enter cap graphical give the root password i'll accept that let's select our targets and the targets are going to be the victim's laptop and the default gateway which is acting as the dns server so under this edit cap menu i'm going to say targets select targets and i'll say that the ip address of my victim's laptop is 192.168.1.105 and my other target is the default gateway which is acting as that client's dns server it's at 192.168.1.1 and i think we're good there let's say okay we've got our targets selected let's do our arp poisoning attack under the man in the middle menu i'll select arp poisoning and we'll say okay now let's do our dns cache poisoning to do that i'm going to go back to this edit cap menu and i'm going to go to plugins manage plugins and i'm going to double click dns spoof now let's go back to the victims laptop and try to go to kwtrain.com once again we'll go to the victim's laptop and i'm going to go specifically to http now my website is actually https and that's a great protection from an attack like this but i'm going to specify http colon slash kewtrain.com and let's see what happens i try to go to kwtrain.com and it takes me to dum dum dum the evil site that we set up and let's think about how we might protect ourselves from an attack like this well we launched an arpa poisoning attack to pull off the dns cash poisoning attack so we could go back to when we were talking about arp poisoning and we could protect ourselves using something like the dhcp snooping feature or we might use the port security feature where we only allow specific mac addresses on specific ports and back on my cali box let's turn off all of these attacks but that's a look at how an attacker might launch a dns spoofing attack also known as a dns cache poisoning attack [Music] you