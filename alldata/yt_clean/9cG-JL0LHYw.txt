- Hi everyone, my name is Roy &quot;No Key? No PIN? No Combo? No Problem! P0wning ATMs for Fun and Profit.&quot; Shout out to all my homeys And for anybody that wants content of this presentation, my contact information is Before we get too far into this, I've got to say this content and entertainment purposes only. Unauthorized access of other Don't do it. Don't do it. You're gonna go to jail. Secondly, this presentation is not associated with my employer in any way, supportive of this opportunity and of me. And I really appreciate that. So why ATMs? There's several answers to this question. The first being when I was a kid, I used to go to the grocery up to this machine once in a while that said instant cash on the front. And I thought, man, this is great. How do I get a piece of this action? I want instant cash. And you know, a long time I got into security and I never forgot about that childhood dream. I always wanted to learn how How can they can be What does their network traffic look like, and how secure is that vault? In my opinion, cash is not Cash still provides a level of anonymity to people who use it, that They leave a paper trail. ATMs are everywhere all over the world and increasing in numbers, between 2008 and 2019, A lot of people think, that and restaurants and wherever, keeps working, it's good, right? The low levels of security for these machines is incredible. If you think it's hard an InfraOps team to apply imagine trying to get bar owners to update their ATM software. It's really, really difficult. Also a lot of ATM security seems to me, based on obscurity and lack They're missing huge Try searching in the internet protocols or encryption implementations or main board pin layouts. It's really difficult to This is a document I found from 2002, discussing the Triton com protocol. It's a preliminary a lot of current info. I also believe that if honestly, expose vulnerabilities in these devices, the increased awareness can manufacturers of these devices which makes all of us The last reason I'm interested is really all of these folks. A huge shout out and thank you and electronic lock research field. They paved the way to for ATM vulnerability research. And I greatly appreciate and I highly recommend watching if you want to learn more network attacks, firmware and spike attacks and malware attacks. All of these previous And in my estimation, most the capabilities of your average criminal. Today, we're going to look on the physical side of attacks on ATM. So our agenda here is all We'll look at some damage, these things trying to get the how I became a licensed operator and how that went in, and why I did that. We're also gonna be resetting the ATM password and bypassing the electronic vault block. And then at the end, we'll All right, so what was my goal? It was a fully functioning ATM in my home, which I had complete access to. It'll process ATM transactions, And I want to research and understand the entire tax surface, the internal serial comms, the vault and the cash dispensing unit. And so what I have here It came true, and I'm going These things are expensive, right? How did I get this thing? If you look on the internet, this thing, probably $4,000 new. Couple of grand, two, 3000 used. That's too much for me if So things like Craigslist I'd been looking for when I found this one in 2018. The set, 100 bucks for I quickly started researching inside them and how to Barnaby Jack had done in 2010. One of the things I found right away, default locks on these commonly available locks and Also among other issues, I in these ATM's contain including full debit card users in clear text and dates That was sort of surprising to me. And so I got bored of these I really was interested in that ran some flavor of Windows, and lots of known vaults. This saved search had an Any auction or ATMs for sale in Minnesota. Lo and behold, I got a hit. So here's this auction about an hour and a half north of me. And they were selling and gas station. This ATM was up for bid, and If you've ever been on auctions like this, you know that there's a very I called the place and of the ATM asking, what does They had no idea. Everything is being sold as is. It's at foreclosure I did ask if there was any money The replies surprised me. There very well may be. This place got shut down drinks in the coolers So at this point I have no idea. I think they're just trying Tell me whatever I want to hear. I bid a dollar. Now, I am quite competitive and I don't like to lose. So of course I won with a bit This is the first time I learned, this email, I learned that I won. I also learned there's I assume they mean the vault. Well, what's going on here? I have no idea. What's this thing actually worth? Is it worth anything? Am I gonna be able to get into? Is it doesn't even work. Who knows? So I did a little digging and these machines are worth 10 It's a score, but maybe not and I can't get this thing working. Well, where did this thing come from? A gas station barbecue Here's the place that was It opened in 2018, February before I won this auction. Very strange. They're gonna have Dickey's Barbecue. If you've ever had it, it's fantastic. I highly recommend it. March 18, kind of a review of the place. But uh oh, just a little while later, assets 43K, liabilities 1.5 million. That's probably not for any business owner. Things are starting to make sense here. So I hop in the car, hour and this is what the place to pick up my ATM, a lot I walk in and I'm at to the lady there, and I How did this place go that you couldn't get the ATM And she says, as I understand issues and the lender foreclosed Okay. I don't know anything about all that, but you know, that's what you say. So I go back over to the ATM. Let's get this thing going. Let's just get this thing in I was not anticipating that bolted to the floor and Okay. So I can't get into the vault obviously holding this It's in cement. So I call a locksmith and I said, hey, I'm at this gas station. I won this auction. Could you please come over and to help me move it? The answer was a resounding no, no. So I asked the lady, how am I gonna get this thing out of here? What's gonna happen to this place? She said, I don't care. You gotta have that I don't care what you do to get it out. I said, what if I have No problem. They're going to bulldoze this I don't care. I'm just here to auction stuff off. Okay. All right. Well, I want this thing on research on it, and afterwards and start a business, make Who knows. So the only thing I can think and rent this guy, the Bosch Brute Turbo. Up to this point, I'd never but how hard could it be, right? I've seen it done in cartoons. (chuckles) Well, so I start jackhammering of times there and jackhammering some more and I'm getting a little And it finally starts to come It finally did fall over and from the bottom, again, For anyone wondering, it takes roughly 40 minutes or so to get a ATM fully extracted from a cement floor. All right, here it is out on the curb. Into the Jeep it goes, and that afternoon in my office. Mission accomplished. I plugged it in, booted it up and said, I'm staring at this thing What do I have to do to make I want to stick my card in this thing and have it give me money. I have no idea. I have no idea what to do. Time to research. First thing I noticed is it's running Windows CE. That's pretty interesting to me. What could possibly go wrong? I was looking for a Windows box. So the next thing I do is and run an Nmap scan. Now, you'll see on the the Nmap scan, that Trey and Brenda So, Brenda did last year of Trey Gowden. Keown, sorry, and Brenda So they had a lot of open I only had 5555 open, which is the remote management agent. I did install the remote and connect to it, but penetration testing It was very intriguing and but it was not the focus Trey and Brenda also against this port that allowed within the ATM. I would love to learn more about that and try that attack here. Okay, so here is the screen when I first boot it up. Apologies for the terrible photo. After booting, I get this thing. It says the encrypted I have no idea what that means. It needs to be replaced, I learned. Error is codes 97999 EPP Error. Alright, what's this going to cost me? So 320 bucks later, I've and things are getting And so at this point, in a machine that I've or worked on, but at least I which we'll see here shortly. First thing I needed to on the inside of this machine. And along the way, I kind a few slides about how ATMs work. So before we get too far, let's just take a couple of minutes here. So there's two main categories of ATM's, with the distinguishing factors the housing provides for the The banking features available money with in the machine itself. Drive up ATMs are typically and are mounted in an especially built enclosure like this one, or as a standalone unit, There's really no easy access to the money or the electronics and You really have to get into into the back somehow. A stealthy, undetectable, and skill or granted The second type of ATM is familiar with, and it's the These are much less expensive built into them because they're where people are present and are working, like gas stations and such. They usually are not directly associated with any sort of bank, but So the gas station owner probably It changes the threat model there's much less oversight to the ATM software housing If this thing is or a big long hallway at or somewhere, you know, a bowling not a lot of supervision. As we've seen, these things can be bolted directly to the floor, but it's a temporary use location time there or they move it around a lot, or for whatever reason, maybe They can't bolt it to the floor. People trying to get access to do a lot of damage, typically like blow torches, crowbars. This is actually the And this one, this Triton 9100 looks like, somebody used some sort of a cutting tool. I'm not sure why they chose that spot. You can't actually get to the money going through the side there. So they were probably very damage to the CDU unit in there. So during my research, and I'm thinking, is this one of these things? Can you do it any other way, that doesn't leave obvious evidence? Maybe the answer is no. I don't know. So this one's my personal favorite because I like 4th of July. And so, anytime you go with I'm not attracting any So here we stick the of where the cash comes out, And it just basically but the cash box remains intact. So that is not a good way I would be really surprised if anyone here has never used an ATM. So I'm sure you're all familiar that I've highlighted here. We're gonna go past this. All of the ATM's that you'll internal parts and external parts. One thing you can see the safe door cover. That is protected by a cylinder lock, which is typically keyed that protects the electronics. Behind that false door is the electronic lock key pad and the lock bolt handle. And you can see a wire That's a power cable for the portal on the vault's door. All right, so let's take Here, we can see the door and dust below that. We can see the bolt action teeth that interlock the safe door shut. The safe door, by the It weighs more than anything There's a look at the electric what's called the cash dispensing unit. Mounted on the cash dispensing And then there is the cash cassette, which plugs basically into a So we're going to take a look, a closer look at all of Inside here, you can see the the money up and out of All right. So the next thing we're is the reject bin. Not very exciting, but just like to look in there. This is where, you know, things that can't go through the CDU. Oh, this is the back of the CDU. You can see the serial interface board and also the power to the power supply in This here is the cash cassette. It also is locked with a And inside, we can see the It's spring loaded. You can see a few bills in there. This is where a 1000 bills Now this same machine that I is configured with one cassette, it can be configured with three cassettes. So, the module just plugs right in. It's really not a big deal. Giving this machine a because each cassette can be So as we're going to see, you know, you make the call at the do you think that the locks protecting 300,000, you do you think they're adequate or not? Moving onto the top of the usually keyed the same as the front and as mentioned can be picked. I'm showing you there that and I'm showing you there So these, these cylinder locks This one's particularly has eight pins. So I insert the pick and I start which moves the pics up which moves the pins and unlocks the lock. So it didn't take very long at all. You could also just buy this key on eBay. So if you are lucky enough like I did for cheap, and here you go. Go buy a key. Okay. Now let's have a look Not many people get to look in here. I figured I'd give you Here are all the wires and these come up and There's the power supply, I believe, to the board and Here is the receipt printer. It has its own board and power cables there. All of these cables come right at the base of the main unit, and there we see the main board. The main board here has an SD card, a lot of DIP switches that change modes and do various things. And we see any HDMI cable connector and a couple of USB ports. And then over here on the other side, we will see all of the different the different pieces and There's the ethernet cable. There's the modem and the printer port. And down here, we have the card reader. That's where all the money is the electronic, the encrypting pin pad, the EPP that I replaced. All right, wonderful. So we see the inside and I So this thing is obviously and it's obviously somehow So how does that work? Well, whether it's through a or something, we get an the payment processing the Triton Protocol. And then from there, we're the interbank network. So what is that? First of all, the processing information and encryption in the ATM computer. They take a small percentage, of the transaction fee, which you know, is determined by the owner and charged to the user for each transaction. There's hundreds of processing I just threw up a few brands here. An interbank network. The next step is also or the ATM network. And it's a computer network that are issued by a financial of the network to be used in member of that same ATM consortium. And so the way that the banking was very fragmented. So there was a lot of and a lot of little networks everywhere. In the 2000s, of like 2003, by then we had a consolidation resulting in three major interbank networks. And now about 70% of the goes over those three networks. Past talks on ATM hacking have backend for the ATM network that would pretend to be But I really wanted to see So to do this, I had to become So why did I do that? Well, I really want the I want to understand to take an ATM to full after the fact. After my research has done, I Minnesota is about to legalize weed, so maybe I'll put it at a dispensary. I don't know. So why do I have to be licensed? Well, the primary reason these exists is to prevent money of nefarious activities. This is really tied to So you can imagine what I The licensing is done through NMLS or the National Multistate I provide, you know, There's a background check. I have to fill out a bunch of paperwork. I have to show them my bank statements and let my bank know what I'm doing. I have to pay a couple hundred about four weeks or so, and because no matter what you and fill out the paperwork to do it back and forth a with the state and whatever, you will become a licensed All right, so I've got I have my license. I can connect to the ATM How am I going to do that? Well, I'm going to use a LAN tap because I want to do And not in any way that somebody There's no opportunity for It's really just sniffing, and So as I run my own I can see what's happening. Now, the way a land tap works that goes directly to the server and the client. These other two ports that you can see are outbound from the ATM. So outbound traffic, and then inbound traffic also goes to my laptop. And so if I spin up of those ethernet devices, The problem is, it's But the ATM provides you a certificate, which I If you put a self-signed cert the back where we saw before, it says, download cert from USB. So I'm not really sure but it's there. All right. So we've taken a little We've taken a look at the network. With EPP replaced, I can the ATM and insert some data. One side note here. Anytime I see a big red and then do not, you know, do something. I always pay special attention to that. I like to do things that So this one says, don't remove the cover. Bad things will happen. At some point, I'm gonna what that bad stuff is and It sounds like a really So anyway, booting this time, I get this great error That means that I need to information into the machine. All right. So to access the admin screen, I'll do enter, clear, All right. And so this gives me this But I don't know the password. This is the pin I need to I tried multiple times to with the previous owner. Still no luck. So I have no idea. The pin is stored in memory I have no idea how to get to it. I don't know if it's encrypted. It's good to note that than the safe combination. The safe vault lock does interface or this computer even exists. They're completely separate. This is just to get access to The default password here is 555555. I know that because it's but unfortunately for I tried and I tried and I The UI does give you three chances to enter the correct password, to the start screen again, enter, clear, cancel, one, two, three. After a few days of guessing after guessing I gave up So it turns out after a lot I found that in recent Hyosung has implemented a security feature where the operator function to factory default unless first boot after reloading the software. If there's any way around I couldn't find it. The search continues. All right, so how does the Well, various versions of if you search around. I found this one and downloaded it. I would love to find some If anybody knows where I can versions of the software I would really appreciate it. This set that I found was, I And so I put it on an SD card. There's various files here. If you want to know what talked about that in last year's talk. I did delve into the a master zip file, and There's lots of fun I'm not sure if the bat files the icons and the backgrounds associated with them, if if you can modify those and and stick it in the machine That's a another research topic time for and we'll So my SD card goes in this slot. I have to push down to make it boot into diagnostic mode. And this is where the computer stuff and read things off the SD card. So pick SD card, and now This takes about 10 minutes or so. That's what this install looks like. And after you do that, it will reboot, and now you'll get the same screen, and we can reset the master password. All right, so here's how we do that. We reboot again, and during we get out our old Nintendo clear, left, right, clear, clear, clear, cancel. If successfully recognized, if you want to reset the master password. And then it will be set back to 555555. There's one caveat to this. It's not gonna happen unless If the safe door's not get back to this screen. And so, at this point, but I need to open it. I need to open it and to for the computer, and I if there's any cash in there, right. I really don't want to destroy I've already explained why. So the first question how does this computer There must be a sensor somewhere in there connected to the door, I have access to the main board. I should be able to do this. So I reached for my favorite This here is a DEPSTECH unit. Five megapixels, HD resolution, wireless connectivity, it's great. Wired is rigid. You can bend it around corners, you know, and it's 50 bucks on Amazon. How could you go wrong? As we'll see later in this this other smaller scope It's made to stick in your ear. This has a diameter of 5.5 millimeters, much smaller than the previous one. It's about 50 bucks for So I got the scope inside of the cash dispensing where the wire came off This is what I see inside. It's the reject bin. I can see the lock, the I can also see some wires If I turn the borescope a I can see the wire, or I the momentary switch is This momentary switch which and the door is pushing it the computer the door is open or closed. Following this wire up away and across through some it finally does surface through this hole, up to where the main board is. It comes over to this junction where it's conveniently labeled front. And then it goes on over to the board where it's labeled CN16. So if I unplugged this, the question is, does it fail open or closed? Well, let's do an experiment to find out. I recorded this demo after and the ATM was all But the results are the same and the ATM is operational If I pull the door sensor plug, then the computer should think should become not operational. So what happens is, I pull the door is open, the ATM is But it's not, right? We just saw the doors closed, but this is exactly what So I pull out the plug, I reboot. And while initializing, clear, clear, cancel. And we get to this screen, Reset master password. Click, yes. All right. It reboots one more time. I get here, I do 555555. And here I am as an administrator All right. So at least one of you is wondering what was that QR code back there? Well, it's nothing. I'm not sure why that's there. It does not seem to be through the configuration A Google search, I guess. I have no idea. Alright, so now the password's reset. I can get to the ATM. Inside, I can configure it as I wish, but we really need to get into fully operational and, well, So, how? Well, first things first. What lock is this thing? Back to the borescope for some recon. I can see the lock. I can see some writing on it. It turns out with a little Googling, I find that all the ATMs, of ATM uses this LaGard and this is what it looks like. Now, in 2016 at DEFCON 24, side channel attacks on this type of lock. He used the side channel combination of this Sargent very similar to the lock that I have, the LaGard Basic, but However, this YouTube the same attack on LaGard So I decided to come up with another way. To figure out how these And I also found out that which I assume works the same sort of way, along the same lines as Plourde's attack. This is called a Little Black Box, and this device as well they basically can reset the safe combo. So you take the cord from the key pad and you It determines what lock and then you click reset. And what it's gonna do now against the lock itself. I believe it basically in less than 15 minutes. And once it guesses the combination, I guess somehow it resets it. I really don't know how this thing works. You can only buy this if or if you own a bank or So it costs about $3,000, and so I need a another way. So I take off the cover. We see the circuit board. If you take the circuit board out, then you can see like the and the rotation axis of the bolt. The main volt handle it in a clockwise direction. There is an anti force mechanism here. There's a spring and a notch on the lock. And the bolt, if you push down too hard, that notch basically engages If we are able to rotate then it will push that secondary into that linchpin. Now that linchpin will stop over there, unless we which then provides a nine motor attached to the linchpin. The motor runs, the linchpin is moved and we can open the lock. All right. So now we know how this thing works. Here's a closeup of the And again, if we, if we then it'll open. So basically all the money potentially is protected to this DC motor. So is there a way from the voltage to this DC motor, or without destroying the or just throwing the case? Let's have a look. This is a short video Look in the middle of the and you'll see, after I type the linchpin goes up, which and the lock to open. All right, so here's And another interesting thought there's a lot of space inside on the front, and it doesn't cursory research that there's that are pressed on the sent into the lock. And so what you see here with an Arduino Nano in which pressing on the keypad and into an Arduino Nano, and then passing that back on out to the lock. Very interesting research I believe this is a successful against this particular lock. So, yeah, moving on from I wasn't gonna be able to use that attack to get into my safe. I had to continue on. Here are the power wires. They pass directly under the circuit board on the door side of the lock. So the metal you see in this against the door, and the this keypad and the keypad is removable. And if we do remove the keypad, we can see through the hole that it is indeed the back of the lock. And it gives us this little where on the lock we are solid silver dial. I have no idea what it but it is there and it That little red X you see is that we need to get access to. All right. So I need the right tool for Something I've always wanted, an electromagnetic drill press. All right, so you're probably this is cheating, right. Well, hear me out, hear me out. I figure if I can just get from the outside, I can come up with a way to supply current to them. And there just happens to be from the factory that orientation of the keypad if you want. The hole is a quarter inch in diameter, and it's exactly where I needed to be. And it's there from the factory. I need this to be a little I went with a half inch carbide bit. So I made the hole diameter All right. Well, I put this bit in and Now this drill has a 3000 pounds per square inch. It's not going anywhere And the RPMs of this drill is about 1200. A carbide tipped drill bit, really no match for this safe door. It really only takes a couple It takes me a little bit longer, 'cause I'm not exactly But suffice to say, I damaging it in any way. And now we can see the wires of interest. And now keep in mind if our mischief is fully concealed All right, so the last How do I get power to these hole without breaking the lock? After a lot of thinking I figured out that there's this tool called a puncture probe. It's exactly what I needed. This is how it works. The idea, you retract the you get the wire in there the wire and you have connectivity and you can connect a wire So this is kind of what that looks like. I built my own probes because those plastic ones were far too big. So what I'm doing here is I've work bench and I'm applying and you can see that it is opening. Again, the problem was for the access port that I had drilled, and I certainly didn't by making the hole bigger. So I designed something smaller. At the time I used this with a hook on the end. And here you can see that, you know, this is what it looks I hooked up the nine-volt I was a little worried that so I hooked it up to a DC power supply, and I gave it 17 volts, just, you know, in case it needed a Here's the full scene for the first time back in, I believe, the end of March, early April. And yeah, so you can see the scope there, and you can see my tool, the puncture probe. You can see the wire tool that I created, the inside through the borescope. And then here we go, the door and we can see inside. So here's a demo of what just happened. As you can see, the lock is and attaching the probes and the lock opens. I'm gonna skip forward I'm a little bit, So we're just gonna go pass this one to... Again, if I put the keypad in place, there is no evidence of intrusion. And as an added bonus, if you you can cover the access hole with this half inch plastic cover. Barely noticeable, right, right? All right. So again, not as satisfied There must have been a way So I started taking these pros apart. I pulled off the plastic sheeting I went and grabbed a stainless I put a little notch in it, the tube to melt into And this is what it looks And it's a lot smaller. It's 6.2 mil versus 2.9. So a lot smaller, which means with a much smaller hole. All right, some loose ends quickly. I sent dormakaba this pre disclosure, pre-talk disclosure. I never got any response from this. Here is my email to I never got a response to this one either. So I got a delivery As far as the money, there I'm a trusted source, advice. I am not gonna tell you I will not disclose that, but the research project and the All right, some follow up research. ATM Wi-Fi, really cool, I think. The vault lock, ATM software modifications Maybe the USD and SD card Internal serial comms between right between the CDU and the computer. Can we capture and replay? How about EPP deconstruction analysis? That warning message we saw. All of those topics, I and I will continue research. If anybody else wants to join So in conclusion, no key, no Thanks for watching. Have a great day. And I hope you have a fabulous DEFCON. Bye-bye.