Amazon Virtual Private Cloud is a service that isolated virtual network that you define. Neil popular AWS courses and he's a great teacher. And this hands on video, you're going to In AWS a VPC is a logically isolated portion own resources such as Amazon easy to instances VPC to start right at the beginner level and take you you'll learn how to define your own IP a VPC and launch resources into it. You'll network access control lists, and we'll also cover This video comes from my brand new AWS So if you're planning to take an AWS certification you. But it's good for anybody who wants to learn For those who want to learn even more. There cloud training YouTube channel, including for both hands on videos, you can find the links to you'll also find the course download as well which in this course. Now I really hope that you enjoy Hi guys, in this lesson, I'm going to cover specifically talking about IP version four, a bit later on in this section. Now, what I want knowledge of IP addressing at all, if any. And it is a really complex subject. So I'm only in order to be competent working with Amazon Now, there'll be some areas of the subject And there's lots of resources on the internet for let's start with what is an IP address. Now, and you want to communicate with that web some kind of network interface and attached to And this is going to be a public IP address. In via the internet, IP addresses are the addresses So you've got your computer at home, and you got a address of our web server. Now what happens now the computers communicate using IP addresses. So comes in. Your computer will speak to a DNS what is the IP address for example.com. Once to connect to the web server using the IP address. resolving a name, a nice friendly name that which is less easy to remember. But it's the way Let's move on to the structure of an IP address. already worked with them in this course. So an IP This is known as dotted decimal notation. And address. Now each of these parts between the dots get a little bit more complex. But you do need octet means that you have eight values, or they can be a zero. Those are the only two you can see that in this case, we have once eight we have what's called the most significant bit it's going to have a value of 128. If you have significant bit, and its value is only one. If for example, in this address, the third octet is zeros. The one means that all seven bits here are and that equals this least significant Well, 192 is 128 plus 64. So we have a one And then for 168, we have a one, so that's 128. which is 32. And then we have a one in the fifth plus eight equals 168. The reason it's when we get to subnetting, with variable So firstly, let's understand that network and host network ID and a host ID, the free blue boxes this value will be the same for every computer on computer on this network. As I said before, every how this is configured does vary. Now how do we the host ID? Well, that's where the subnet mask essentially where we have a bit that is a one eight bits that are one, eight bits that those first free octets are all representing the here is going to be the host ID. That's why it's zero means that's where we have values that can those are values that are going to be exactly So a subnet mask is an easy way to see which bit So let's look at an example. We have our 19216800 Now this is 24 bits, a 24 bit subnet mask because And that means it's a slash 24 network. It's And that's the format you'll often work with in computers. And we can see that they each have In this case, the host IDs are 123456 and the the network. We also have something called classes and 255000. Essentially, you have an the first assignable address is going to an address for a computer on the network. And because you can't use 255, which is what's known a few other addresses that are reserved with networks. And each of those networks can And that's because we have all of these bits here which has a 16 bit subnet mask. First assignable and the last address would be the 254. Here we and the usable addresses per network has This has a 24 bit subnet mask. And as you can see, but we don't have as many addresses Available per there's also something called a private IP reserved for private use. That means not on we have 10, triple zero to 10 2552 552-551-7216 These addresses are reserved for use in private these on the public Internet, things now get a vary the length of our subnet masks. And we So we use something called classless inter domain Let's have a look at some examples. we have a 24 bit subnet mask, we have eight The first address is dot one. The last is dot 16 bit subnet mask. So with the same network, a non standard one in this case, because With a 16 bits subnet mask, we have 16 And it looks like this. But what about as you can see, we have a blue slash orange box. the network ID to share them and use them for and 4094 addresses. So sometimes that's a better to have on the network and the number of networks network would start at 01 and go up to 15.254. So And it's using variable length subnet masks. In optimizing the amount of networks and hosts and hopefully it will make more sense as we particular lesson. I hope you got lots of value Bye guys. In this lesson I'm going to teach you VPC incorporates several different concepts. And them in much more detail. So first, we'll start So within a region, we have our VP C's and they regions. A VPC is essentially a logically isolated to deploy your resources inside it. And that's VPC where services like Amazon s3 set, this is a you configure your VPC. Now as you know within a use those within your VPC by creating subnets and A subnet is always assigned to one availability But you can of course have multiple subnets such as easy two instances into our subnets. Now really see the VPC router, but it exists, and Now the VPC router takes care of all routing for If you send data out of a subnet, it's got to go out to the internet or some other network. data connection is sent to the right place. Now as is see the route tables and they are configuring the destinations and the targets for certain where to send those connection attempts. If we internet gateway, the internet gateway is attached the internet gateway is used for sending data And in from the internet that's Ingress traffic. the internet gateway ID, that tells it to send all the route table before it to the internet gateway. you have a limit of five by default, but you has a cider block. That's the overall block of you assign to your subnets. So it's kind of different one of these. So in this case, we've got As you learned in the last lesson, cider from the overall cider block, we can then create within that overall cider block. But they have subset of the overall available addresses and we specify our cider blocks correctly so that we We'll cover that in another lesson. So here we and then each with different subnets that come a lot of these components within this section, So you know what a VPC is and what subnets are, an egress only internet gateway is when you're outbound only, whereas an internet gateway is egress and Ingress traffic. As you know the router to the right places. Now appearing connection is and have private routing between them. We'll VPC endpoints allow you to connect using private we'll cover that in detail later on. Now, Nat in the course, these are both ways that you for your instances in private subnets. The next the customer gateway are both related to creating our company offices or our company data centers. encrypted tunnel over the internet. We then have private connections right the way and security groups and network ACLs are two in a bit more detail in this section. We've They are what we call a instance level firewall, interface attached to our EC two instances. level firewall. So it only sees traffic going that core knowledge of VPC is a virtual network having your own data center inside AWS because with defining your cider blocks, creating your own and so on. You have lots and lots of control. It's the AWS cloud. And as I mentioned before you get in your VPC. And a VPC is a place where you then When you create a VPC, you must specify your cider Now we'll see how to select the best cider block all azs within a region. that essentially means azs in a region, you can create subnets within subnet is always within one AZ it can't span azs an availability zone, you get full control over By default, you can create five per region. But A default VPC is created in each region with always a public subnet. So whichever region was and it already has a number of public subnets in lesson, we'll have a look at how we can work In this lesson, we're going to look at what we to use a few of the rules and guidelines and best And these come from AWS, the cider block size can it cannot overlap with any existing cider block increase or decrease the size of an existing the beginning, the first four and last IP address for that when you set the size of your subnets. addresses for your instances that you deploy. AWS 1918 ranges. Remember, these are the private IP these give you plenty of scope. So that shouldn't So let's say I have a VPC cider block that looks So that means it looks like this 10 000 slash 16. we want to create our subnets. So what we need to from the host portion here and assign them to the 010 slash 24. And that means we borrowed all eight So your VPC subnets, will have a longer subnet Now, in this case, it's a 24 bit subnet the next network is 10 020 slash 24. And then So each of these subnets is going to have you have to take away a few from that number. how many addresses you have remaining for your with that number of instances per network, then this is a good and very simple range to considerations. You got to ensure you have enough this up. You only get to set the cider block once plan correctly. Bigger cider blocks are typically Smaller subnets are okay for most use cases Consider deploying application tiers per subnet. have different subnets for each tier. And you availability zones as well with a subnet in each availability and resilience into your workload. later, is where you connect your VP C's so that IP addresses, so you don't go out to the public have overlapping cider blocks. So in other words, and connect them with VPC peering. So even if because you might need to do it in the future. You And this is across all v PCs and all regions and in general, just avoid overlapping cider blocks as you're designing your IP address ranges. So let's slash 16. So that's our cider block. And we create has a 24 bit subnet mask and as you can see were different availability zones, the private subnets have a different route table course the main an internet gateway. And those subnets will also are launched in them. So that's a bit of theory I also want to show you a very useful tool that subnets. I'll attach a link to this tool to is specify our cider block and see the subnets. work out which subnets to use based on the number per network. So let's stick with the example and we're going to scroll down to slash 16. Now I want would be a standard Class C network. Now let's And it gives us all the subnets fit within the cider block. So we've got the we get to the very last subnet, subnets, that we can have. And each of those VPC will actually reserve a few addresses so you 250. So that's a really nice tool to use to help within your cider block. And that will also help Hi guys, in this lesson, I'm going to show you to really easily create a VPC without having to do Let's go down to networking and VPC. On the VPC and we then get offered four And what I want to do is just go through So the first one is a VPC with a single public block and a slash 24. subnet. And it's a you can specify your cider block and it's it's already entered the subnet cider block as or otherwise, after entering the name, you could all the tasks for you. And that would include internet connectivity for your public subnet. go to VPC with public and private subnets. So now you get a network address translation device, so can access the internet. So again, with this other than the different subnets public and gateway does need an elastic IP, so you need an And this time we're going to go to VPC with access. Here you have public subnets, private Now you need to have a VPN device in your and let's just give this a name, my VBC. And leave it's going to ask for the customer gateway IP on your side of the network on your corporate when you create this VPC, it's going to make And the last one at the bottom is VPC with a the same as the one before except that you VPN connection from your corporate data center going out via the internet from that subnet in to quickly show you through them. And in the next In this lesson, we're going to create a Now let's have a look at what we're going to cider block we've seen in the section, it's going that's the overall block of addresses, then got private one a in private one, B, and public mean that they're associated with a specific will have a private route table for the public created, by default, will attach an internet will have a route via the internet gateway out must specify that we want our instances to So that's the configuration let's head over to the I'm going to go to your V PCs, and we just have a your course download in the code directory, Amazon we can simply copy values. So I've got the let's copy the cider block and put that under at this stage. In this course, we'll leave the it's going to put your instances on hardware cost you more money. So definitely leave that as the VPC. So the VPC is being created. One thing I and enable, that means we will get DNS The next task is to create our subnets we've got going to copy these values to my clipboard, we'll we need to specify our VPC. So my VPC and then we the availability zone as one a US East one a. And we'll copy this cider block. And we'll paste or we can add a new one. And we're just going to through this file and copy the settings for your page should look like this, you've got public one and then you've got subnet to public one, B, modify that. And 10 zero to private one a should private one B in US East one, b 10 04. So that And that's the four subnets created. Now for our modify auto assign IP settings, and enable So I've done that for public one, B, let's do So the next thing I want to do is I need to So they're not attached to the main route will be. So let's go to route tables. Create I have that in my clipboard from the file And then we'll create the route table. Once edit subnet associations, and you want to select we've done that if we go into subnet associations, private one A and B. If we come back up to route this is the main route table or the public route there are no explicit subnet associations, but The next thing I need to do is go and create an here let's create an internet gateway. We'll in from the file and create internet gateway. and the actions you can attach to VPC, select Now the last thing we need to do now we have an route table. So let's go to the main route table and we'll put in the 0000 slash zero, choose our So now, everything within the cider block And everything that's not within that VPC cider gateway. So let's just save those changes. So public subnets, private subnets to route tables, do for this particular lesson. In the next lesson, and just test our configuration and make So we've created our custom VPC and I've just like easy two instances, two instances in two different we're actually going to do that via the command Now not all exams require you to know the command doesn't really matter too much. For the developer, and definitely for the sysops exam. Now, whatever taking in AWS, it's still a really useful skill command line. So we'll launch some instances instances just to test connectivity with each before we get started there. Firstly, I want to Console. Under Nat gateways, let's create a NAT and I need to select a subnet. Now remember, with So here, I'm going to choose public one a, and So connectivity is public, we allocate an elastic of course, it won't work until we update So under route tables, let's choose the private and we're gonna specify 000 slash zero. And And we'll choose that Nat gateway ID. Now our And that's important because when our instance And that's going to connect to the internet to under security groups, we need a security group. it public that web, give it a description, and default, it allows all traffic to any destination. all traffic from any destination. So this is down in a subsequent lesson and practice with some now, let's just open everything up. I'm going to There's a file in your course download. And that's run instances, we need to add some values into command is specify an image ID. So the command is values that we need to specify. So first, let's are region specific. So we've got to make sure the same region. It's also where you created your hopefully it's the same for you. Let's launch Let's grab this ami ID don't take anything in Come back and paste that in the instance type T two dot micro for security group IDs. Let's I can see my public web access security group. and paste that one in. Then we need the subnet ID. Let's go to subnets. First I want the public that to my clipboard. Key name is the key pair in EC two, you can go to key pairs if you don't And we can paste that in. Lastly, there's Now this is the user data file. What it does is of variables from the metadata were actually that into a simple web page. So we can see where we just need to specify the name of that file. Now directory, where we have all this information. And clipboard, make sure you have the file colon slash this and make sure it works. Before we fill out configure, before you do this exercise, you should And your region must be the same as the region So mine's all good. Let's paste in this command And we can see that we have an instance running information if you just spacebar and go down it's launching back in 82, I can see I have this going to label this one as public one a so I know is to go back over to the VPC Management and come back to our file. And we're going to use put it in one be here. And then I'm going to one here. So we should now be able to launch into come back and paste it in. That looks good. If I instance, that's the public one be. So I'll just And then lastly, we're going to launch the I just need to get the subnet ID for private one paste that in. And now we have the command. And subnet, because we're able to connect out to the hit enter. There we go, we should have another instance here. So let's call this one private, one give a refresh and see where we're at. So a couple make things a bit easier. I'm just going to copy and paste this into a browser window. And I get So that should correspond with the subnet for that we can connect from the internet to our EC is connect between my EC two instances back in to public one, I use the EC two instance Connect. Next I want to get the private IP address of my And let's just change back to the EC two instance And let's see if that response. So that proves other public subnet public subnet one B. So we back as well. So that's great. Lastly, let's So let's see what the private IP address is. And let's see if that works. And it does so we get we have that connectivity working. One other thing to that web page. So we'll use the curl command we get a response here that says this instance subnet ID. So that's the h1 header for the we We can see that we have Port 80. Open as private subnet. And we can also infer from that, because it was able to install that web service. Now I'm going to leave all of these instances going to come back and carry on when we do some Guys, security groups and network access control that we can apply in our AWS environment. So let's VPC with two availability zones. And we've got a got a few EC two instances that have been launched So let's see how we can control traffic. network access control list or network ACL. Now see that they're sitting here at the edge of the a subnet will go through a network ACL. So you're exits the subnet. So ingress and egress traffic, actually applies at the instance level of an EC level of the EC two instance. So that means we EC two instances in different subnets. So this and it's been applied to instances So remember that this is the instance level, that instances in the same subnet, or across different that's attached to different instances. So subnet. Now, what happens here with these security They're looking for traffic that's going you send traffic from an instance, in security it's going to check that there's a rule to allow here, the Security Group B is going to check Am I and you can do that by IP address, or you can itself, we'll look at all this in detail in the stateful versus state less firewalls, because a network ACL is a stateless firewall. And it's So let's look at an example. We have a client a service on a web server, and we've got a the client is going to connect to the server, the The Source port is the port that's assigned is what's called a high numbered port is assigned for every connection. So we have And we have a source and destination IP as well. 80, because that's where the web service port course the IPS are switched around as well. the source IP will be the web server. Now what this to work? Well, what we need here is we IP 10.1 dot 1.1 to talk to the destination IP port and the destination port specified. Now of we don't know what that is ahead of time. So what having the source port specified we'd have the And then rather than a specific source IP, based connection. So those are things that But the destination port will always be 80 So we want to make sure that we don't allow Now that's the traffic coming inbound traffic going back? Well, in that case, things are the source IP of the web server, the destination and the destination port of the dynamic port at destination port, and the destination IP is any, any client on the internet if you're running a rule set for the outbound traffic. And this is and stateless firewalls. So a stateful firewall this is what a security group is, what that this roll up the top here, you need a role that whatever client on whatever port, but you're going And then the return traffic is automatically the return traffic is going to just go out the firewall is clever enough to know that that's return traffic. Now a state less viable checks this is what a network ACL does. So we have and the outbound rule. So you need to make coming in, and the outbound rule for traffic it doesn't understand that that's part of the same important to understand those differences when you at a security group. This is what a security group rules defined for inbound and outbound traffic, Now again, because it's stateful, we don't have to might need an outbound rule for traffic going out are attached to the security group are initiating several rules using different protocols. And and then the source. And the source in many cases Or it can be a security group ID as well. security such thing as a deny rule in a security group. the end of the rule set. And it's going to check default, it's just going to deny the traffic. As an IP address an IP address range, or the security let's have a look at a best practice configuration public subnet and a private subnet. And we've got to distribute traffic to our web servers. So we end. So this is the one that's actually users are an application layer that's going to process data. load balancer. And we need a connections to be through to the application layer, it might then diagram. So let's see how we set this up. Firstly, It allows traffic on port 80 for the web service has because it's going to now create a connection outbound access to Port 80. And we've specified that's the name of this security group. So to the web front end, the web front end allows then it has a destination for outbound traffic and a port of 8080. So that's what that particular security group will in turn, only allow inbound And it will only allow outbound traffic to the one which has the application layer in it. So to the different layers of our application, to other components but nothing else can. configuration. Now let's have a look at network is we have inbound and outbound rules. Again, you can have an explicit deny that's different only support allow rules. Rules are processed So we typically number our rules. And you might are 202 101. And then 303 101, you could work out but just remember that they will be processed means that once you actually reach a rule that stops there. So if we have an allow rule at 100, a deny rule, later on in the rule set for that it's going to allow it because it reaches DLL careful with how you set up your rules the order they will be processed in order, and then when of the processing, it will either allow or deny the next lesson, we're going to do some hands on Hi, guys, in this lesson, we're going to use already have some instances running from earlier instances running to in a public subnet, and one is test various configurations of security groups, back in EC two is go to security groups. And I'm the public web. Now we're going to create the to be called private dash app. I've given it the VPC. Now, what will the rule be here? Well, we've already configured, we've given internet we were able to download httpd when we I'm going to take out outbound rules, which means the internet for inbound rules, what I want to do that's the protocol for the web server. And for And I can see my public web access. So I'm doing sure that the web server in our app there is only web servers on the front end the public facing web that security group. Now we need to assign it to to actions, security, change security groups. going to choose private app, click on Add so that should be set up correctly. Now, the first the security group on our front end. So what I'm public web security group. And under inbound what I want to do here is change from all traffic. going to remove the any source, and we're going to my IP address. And that means that I will particular web service. Now I'm actually using a if you do have access to a VPN, you'll be able bit difficult unless you have multiple public IPs. let's just save this rule, come back to instances, let's just hit Enter. And that looks great. I'm going to do is I'm just going to go in a different service. And that means I've got a Now you can't see anything happening. But if you we're trying to connect and this is what happens it kind of just hangs for quite a while So that's definitely working. We're If I come back to security groups, and what I'd edit inbound rules. And instead, any ipv4, because this is a web service. So we So let's just save that rule. And back over here, back in again. So that's a good configuration. internet. And then it should be able to forward group rules we set up before. So let's test that And what I want to do here is connect to my And I'm going to check the private IP address of 04148. Now I've just noticed one of the things locked ourselves out. Now if you just click on And we can see that we actually need Port 22 from So let's go back and set this up as a secure what we need to do is go to public And this one can be SSH. And what we'll do here because I might be changing my internet of course, you could use my IP, or have a range secure configuration. But for now we will be open. So let's save those rules. Now let's try So the way I want to try and test that we can and then putting in the IP 10 04 dash 148. Let's Now remember, we didn't have an outbound rule is coming back purely because this is a stateful move on and have a look at configuring a network to network ACLs. And what we'll see is there are our custom VPC. Now let's go in and have a look we have a rule number 100, allowing all traffic rule. So remember, these get processed in order. of the allow rule. So the deny rule doesn't get thing. So let's try something, what I'm going to add a rule. And I'm going to make this one HTTP source is going to be my IP address. So I So I put slash 32 for an exact match. And I'm access from this particular IP address to http. you realize there's an error here, but let's just Back in easy too. I'm just going to copy the hit Enter, and I get access. So of course, Back in the VPC Management Console, let's edit rules get processed in order. So we've got a deny everything. So actually, this is not going order. And now we have a specific deny before and the rule set, it's going to see that traffic's and it's going to deny it. So we never get to So let's save changes. So we'll go and test this to understand with security group rules, when effect pretty much immediately, there can be a find you still have access to your instance, then So just give it a couple of minutes and try in a browser window here. Let's paste in our hanging. So that's clearly not working. Now what somewhere different and very quickly, this time, allow me in. So sometimes the network ACL rules a delay. So it really can vary. So that shows Now I'm just going to come back in and clean up in my network ACL. So let's just remove that one there are a couple of things we can clean up now let's go to our Nat gateway, these can cost money. gone. And don't forget, you will also need to make from your account back in easy to Now I do want I can terminate the other public instance. Now I just want to show you another ci command. for our DC two instances. So I've just got commas. Copy this command, and back in my command And when you do that, you'll see that the current running. So we now know that our EC two instance leave those other two instances running because Hello, and welcome to this lesson. There are to be able to connect machines that were running So for instance, we might have two v PCs, be in a different region or even a different those two v PCs to be able to communicate using Now a way that we can do that is to use those addresses internally between those v it's not going out to the internet. It's using the VPC so it never touches the internet. It does and it uses private ipv4 and also ipv6 addresses. Let's have a look at how we can use VPC peering. and then we have another VPC, VPC B, and we these two. So we got easy two instances, maybe RDS communicates inside a VPC and we want to be able ipv4 addresses. So what we can do is establish a So this will enable routing using private ipv4 blocks for our VP C's must not overlap. So this choosing the cider blocks to use your VP C's. you might someday want to connect your VP C's or cider blocks to overlap with each other, then that don't overlap. Now what if we have another their own cider blocks so looks good. We can So what we do we establish a VPC peering VPC B and VPC D and then with VBC C and BBC D. But the problem with VPC peering is it doesn't is, let's say we have resources and VPC a, B. VPC B then has a peering connection with VPC with resources in VPC d? By going via the VPC doesn't work. So what we actually have to do is a peering connection between A and D, and between Because VPC peering doesn't support transitive that becomes quite a lot of connections. Now with imagine if you spread this out across a lot more got a huge number of connections to set up and to are other solutions, which we're going to look at Now, as I mentioned before, the VP C's can be in regions as well. Now let's have a look in a bit got Region One, and we've got region two. So regions could be in the same account or different they each have their own cider blocks, which are And then we've got some subnets. Now these could it's the private addresses of the instances that And we've got some instances running in these going to set up a lab very much like this, our EC two instances if they're in public subnets. show you how to do this in the console. Now the groups. So let's say we want to use the ICMP to another, and the other instance back again. group rules as well. And we can use the cider of as the source and say that anything coming from this rule. Now another thing we have to set up for is we have a destination route, which And we specify the peering IDs, when we set up and we're going to specify that as a target. so that the route table will send any to the peering connection, and then it Hi, guys, in this lesson, we're going to create different accounts. So the configuration is going we have our management account in our AWS we're going to have a VPC in each using these security groups. And we're going to specify these at how we establish the connection, we need to and we can do that in the console. Then we need to have a route to your target. So the route table cider block of the other VPC and the pairing on the right hand side. Our security group rules and the way we will test the connectivity using the private IP address and that will show not the internet. Now there is a bit of background So unless you want to use the default VPC in your using the same ranges I just showed you. So from to change to DCT production, go to your VP C's and and I have the values for you in a file. So just file, and this is the information you need there. in this section. So just create this VPC and your private route table, and then we're good particular exercise, but let's just create it and then we might use some of these Now I need a couple of pieces of information. I'm going to copy this owner ID that's the file. Next I need the VPC ID and let's put that the management account. Let's go to peering need to give it a name. Let's just call it my We can choose another account rather than my that in. We're going to stick to the same region, So that's the one that we copied here. So let's create the peering connection. So it says here going to number my peer has been requested, the connection. So let's go back and do that. Let's and we can see the request pending acceptance. So accept request. And we can accept that one. And need to test is going to be an easy to instance. we actually launch that one, I'm going to create to be called VPC pair dash prod. And these are a security group. Give it a name. I just put that and the outbound rule is fine. For now. All The first rule I'm going to set up is ICMP ipv4. and it's going to come from 10.0 dot 0.0 slash 16. and put in the port range, or choose SSH, and it just want to give it the same addresses. So this the other account in the management account using So we can save the security group. Now let's So I'm going to launch an instance, T to micro, make sure you select your subnet public one a. Let's click on And we're going to select a security group. click on review and launch and launch. If which I don't at the stage, then I'm going to or download that key pair and then launch my management console to the management account. In security group and we're going to assign that in this account, we've got two instances create a security group. It's called VPC, pair select the correct VPC. And then let's add the going to be 10.1 dot 0.0 slash 16. So now we have to connect from the prod VPC to the management that security group. Go back to instances public And we're going to add in VPC pair dash MGMT. is because we have a role in there allowing access instance, connect. So with those two added, let's very last thing that we don't want to forget is Back in the VPC console for my management choose routes, edit, add, this one's going to over a peering connection. We've only got one of switch across to the DCT production account. We label this one. Let's do it now. But I can go to routes, edit routes, add. And this one we're going to specify peering connection, it's can save changes. So that's it hopefully it's all got these two security groups with rules so that on our private IP addresses. So that's that's the if we can connect, we can definitely ping via the set up correctly, but we want to do it via private out to an internet gateway, we're sticking within back in easy to, let's select the instance ID, and to just put that into my file here. And coming Choose the public one a instance, connect remember this IP 10 11221. So let's ping 10.1 we get a response. That's across accounts. And this bi directional traffic going between these SSH. So let's just make sure that we can create can now I'm not actually going to log in, because more details as well. But I just want to see security groups are set up correctly, as well as over private IP addresses. So that's really it might want to do is you can practice by doing through to your instance in your private subnet. you might have to use agent forwarding, and then there as well. So that's just an additional you want to practice a bit more. So now that terminate our instance, in the private subnet. carried on with the configuration. But for now. So let's terminate this instance. environment as well and terminate your EC two You'll remember that earlier in the course I in that they run within a VPC like EC two, they have a public endpoint like Amazon connect to Amazon s3, you use a public DNS Now, what if you wanted to connect an instance to Internet, it might be an instance in a private in. And there's a few use cases for VPC endpoints And there are two different types. There's a VPC the gateway endpoint is one which we can use different is used for other services. So let's using a VPC interface endpoint. So we've got AC want this instance to have a public IP. And we via a NAT gateway. So we provision an interface And then the instance can connect via that EMI addresses to connect to them. Now each interface And you can connect to an AWS private link powered what that means. So this is a way that we can using private IP addresses. Now let's look at the So in this case, I want to connect to Amazon I don't want to have a public IP address. So it is in a private subnet. And I don't want to want this traffic to go out to the internet. This is slightly different. It uses a route table to point our traffic to the s3 gateway endpoints. gateway ID. The instance again connects using a then from there, it connects to Amazon s3. Now you a policy to the endpoint. And you can also apply bucket policy that limits access to any traffic now have a bucket Which will only accept traffic endpoint. So let's just recap the differences network interface with a private IP with a gateway for the gateway. So interface endpoints, we gateway endpoints use the prefix list in the route there's quite a few with an interface endpoint API few examples. Lots of the public services can be endpoint is restricted to Amazon s3 and dynamodb. groups to control traffic, whereas with a gateway Now lastly, let's look at how we can So what I mean is we have a consumer VPC and a subnets in each VPC. And what's happening is the service is behind a network load balancer. And So what happens as a consumer is you provision access the service. So we're actually publishing in the VPC on the left, and using an interface So that's how it works. And in the next lesson, Welcome to a nother hands on In this lesson, it's going to be a gateway endpoint. see how we can control access to an Amazon s3 already have a VPC and a public subnet, and we've Now we're going to create an Amazon s3 bucket. because we actually cover s3 in a lot of detail in with it, and you want to get a primer, you could here, it's gonna be fairly straightforward a route will be added to our route table. And that the IP addresses of Amazon s3. Now what happens route, like the route going out to the internet. connections that go to the AWS s3 endpoints and we'll be able to prove that that's happening, So we will modify the policy here to do that, bucket, we'll add a policy. Now bucket policies It uses JSON language, just like we do with Iam to our buckets. So we apply them directly like an identity based policy. The first thing to I'm in my management account in North Virginia. On endpoint. Let's click this button Create endpoint. we get these options, we're going Now we need to specify which route table to table for our VPC, the custom one is not there. our custom VPC. Now we can see our route tables. route table. So that's the one associated default is full access. So we have a statement allow, and then any resource and any principal. So let's just create the endpoint, and it's being we want to do is go to route tables and just make that's this one here, the main route table for that we have the destination, and this is going to Amazon s3 going via the endpoint. So that's we're going to run commands against Amazon s3 some privileges, I'm going to create a role. So common use cases is going to be easy to so we're for permissions, just type in s3 and search. And the name of this policy. And we're going So let's just paste that in, create the role. EC two instance. So over in EC two, let's choose Iam role, and we're going to choose a role and we full access. So let's save an instance now has the which you can find under services and storage, just a container into which we add objects objects I'm gonna call mine DCT VPC test, and I can scroll down, don't need to change anything So now that we have a bucket, we can are just files. This is an object based storage I'm just going to add a couple of JPEG images and Amazon s3. Now let's come back to easy to choose and connect. Now we haven't specified any policies Amazon s3. So now we should be able to run s3 Ls and hit Enter. And we can see our s3 Ls and then s3 colon slash slash and our we should see the contents of the bucket. So Now how do we know this is going over the because we are in a public subnet? Well, let's go I'm going to choose policy. I'm going to copy this paste it in. And let's just change the policy Now if we're going by the internet, this shouldn't endpoint, then this should block access. So back and we get an Access denied. Let's try and run So it's definitely not working back in my again, because I don't really want that to deny back to full access, click on Save. The next thing the bucket policy is going to prevent any access that comes up in a lot of exam scenarios. So Come down to bucket policy, click Edit, and is the bucket policy. So it's in your code Amazon do is take this whole AR n here and just paste And there's two options here. One is without the slash star means that you can also look at the need here is the VPC ID. So back at my endpoint come back and paste that into my policy. So that's it do? Let's have a look. The policy is a deny. So on these resources specifically, if the condition words, if you're not coming from this VPC endpoint from this VPC The endpoint ID, it doesn't apply. And back in the bucket policy editor and just save these changes. So let's go Back in our instance, let's try them to run let's check that we can see inside our bucket and instance is coming from the VPC endpoint. So But the other thing we can do is check from access. So back in a terminal here, I'm going to about if I try to see inside the bucket, so the and then your bucket name and hit enter. So that I'm not able to access the bucket from my Now let's just go back to the console and have a that we no longer have permissions to this bucket, I'm actually coming through the console here, So what we need to do is Now that is it for this lesson, we have and the VPC endpoint with the endpoint, you and then delete endpoint. And that should But you can always just go and check, you it has gone. So once you've done that terminate Hi, guys, welcome to this lesson. This lesson is it sounds like. This is a way that you can connect VPC via a VPN connection. So a virtual private computer which is Windows or Mac or Linux, you're into a VPC. And that means you're then able So you might be able to connect to an EC two Now, of course, it's a virtual private network. So end. So let's look at how you set them up. So here we have a couple of subnets. Now we create a VPN with subnets. So the client VPN network And that is the method by which the VPN connection subnets. Because there is an association between subnet, and the VPN endpoint, we then have the some VPN software. The VPN software is not available options. There's lots of free options use open VPN, the client software will establish a Port 443, and that's going to be via the internet, network address translation from the cider to the cider block that's associated if you look in your route table, you can run and you would then see your route table and you'd the cider block of the VPC and a gateway, which theory behind how our client VPN works. Again, from your computer. So your computer is then over to your instances in your subnets within your lesson, we're going to set this up using a Windows Guys The other type of VPN that we can establish VPN is where you might connect for instance, a And have a private network established over the can then tunnel through your traffic, and again, So the setup looks something like this. We've got side, we've got a corporate data center, and you want to connect that into AWS. So AWS create something called a virtual private gateway, the VG W is deployed on the AWS and then a side, when you have those two components, you over the internet. The VPN connection supports So in our route tables, we can actually of the corporate data center, and then point it to So that means any traffic going to this IP So it's fairly straightforward. And the most it's connecting in data centers, or office your traffic over an encrypted connection using a backup connection for Direct Connect. And we'll the theory I wanted to cover for now. And what be practical, we're going to do a hands on lab AWS VPN cloud hub is not actually a service that really is, is a pattern and architectural pattern site VPN technology. So let's have a look at the So we've got a VPC. And we've implemented a obviously deployed on the AWS side. We then be customer data centers. But they're different using a virtual private network to AWS. Now, the is using a hub and spoke model. So in And then the spokes go out to each of these gateway into each of these offices. Each of that's a Border Gateway Protocol autonomous system advertising routes to different parts of your And that corresponds with the routes that would be so you must have a unique BGP ASN for each between each of those customer gateways and Now network traffic can originate from an office But also, it can go between the customer offices whether their offices or data centers. So the So this custom office here. So we're using the AWS which connects multiple customer offices, as well the same VPN, as we just looked at in previous I mentioned, if you go around looking in the you actually do a search online, you'll find some you a bit more insight as to how it's set up. But gateways to a single virtual private gateway. protocol accordingly to advertise the the network. So that's it for a quick overview We've already talked about virtual private network public Internet That means that we are subject latency issues on the internet, we can't control hour to hour, what's going to happen, we can get there's a long way between us and our services we could have congestion or latency. So one of the dx means that you have a private connection into it's dedicated to you, it's a connection all your Amazon VPC. So let's have a look at how we have a couple of subnets. And then we've got office. Now in the middle here is something called AWS regions. And there's lots of these around connect locations in the data center where your In the Direct Connect location, AWS have a cage And then there's the customer or partner cage. that data center, or you leverage an AWS partner. got the Direct Connect endpoint on the AWS cage. the customer or partner router, and you must use allocated for you. And then what you do is cross and AWS, we then have a customer router, actually And we can form the Direct Connect connection. So a physical connection into the customer or partner speak to your local ISP to get that connection happen to have all your equipment in a direct Then from there, we have the cross connects into to an AWS region where your VPC is, that's a or 10 gigabits per second. Now, 100 gig has If you want slower speeds, you can talk to 50 megabits per second upwards. So let's have a connectivity between AWS and your data center or you can control the network path, it's not like happening. That means you can increase the and throughput for your connection. dx can for those who transfer a lot of data from their Now let's go a level deeper. So we've got the the AWS services that are in the public space at connectivity across this private line? Well, we A Vf is a virtual interface. A private your VPC in the same region using a Virtual attached your VPC and the private viff will is a virtual interface that uses 802 point and a BGP session as well. Now what you don't connect to the public AWS services via our public This will allow you to connect to any AWS region. But you can't connect to the want to connect to multiple v PCs in the same virtual private gateways and multiple private something called a hosted Vf, which means you As I mentioned a bit earlier, you can get lower in the AWS partner network. And those speeds can gig is also featuring in some select locations, that could be where you are might not be probably Something that is really important for the exam is you cannot encrypt a dx connection. So there's encryption in transit. It just isn't a feature. traffic? Well, you can then create an IPsec site have your dx connection, and you're basically your traffic is private, it's on your private bandwidth features. And you're also encrypting So that's really important to remember, it Now that's it for the core And in the next lesson, we're going to look at Welcome to this lesson. In this lesson, I'm Now the best way to understand the benefits an architecture where we don't use it and how look at when we use direct connect gateway and example architecture where we're not using direct and we have an office. And we have multiple And what we're doing is we're connecting each of that region and then into a corporate office. And at the bottom here, as we are in US West one. So they then have connections into AWS using dx, then to a single VPC in the same region using a Virtual dx is a regional service. So obviously multiple and also requires at regional offices, or long these customer routers here have to either be location, and you've got a very long distance multiple offices in different geographical areas. to multiple regions, using direct connects, it can let's look at an architecture where we use direct two regions, we have a single corporate office that connection into our office from one location. is actually connecting to multiple regions, a And then the DX gateway is associated with a advertises around to all v PCs via the DX gateway. to these different regions is going over the AWS experience of the AWS global network. Now network so any of the VPC is connected. And of course, many regions that are connected to a dx gateway. traffic from one region to another via the DX it to connect from your corporate office using a the world. So that's the x gateway. It's a really but you don't have global offices or you want a network experience into multiple regions around AWS transit gateway is a really awesome service. and it connects v PCs and on premises locations look at what this means. Now again, what architecture without AWS transit gateway to help because when we have lots of VP C's, and on peering connections that we set up if we use let's say we have VPC A, B, C, and D again, And as you know, there's going to be six peering links that we've got to set up number of VP C's, it gets very complex. So here a corporate office connected via a customer office using a site to site VPN to each of these v then we need to establish a connection And each of those is its own encrypted IPsec VPN. that's not even including redundancy. If you customer gateway, and double the amount of sts VPN Let's now look at the same architecture. But with and a corporate office, we stick transit network transit hub that interconnects the V connections into each of these v PCs, the V And you specify one subnet from each availability availability zone for any other subnets. We then corporate office here with a customer gateway, it. This is now a service, which is allowing us to to any of these v PCs, tgw. W's can be attached appliances, and also transit gateways in other a look at how it works with the x gateway. So in our corporate office has a customer router, and we're using a dx gateway. So now the DX And that's called an association. We then have the from direct connect, and we create something of virtual interface specifically used for Direct gateway. So transit Vf is only used when you're Now this architecture then supports for the transit gateway and all of those when your company gets bigger and starts using have that transitive pairing between them, it really solve a lot of challenges. So that's it Hello, and welcome to this lesson. I'm now going VPC. So remember, I mentioned earlier in the are used extensively. One of them is ipv4, that's for quite a long time. And then there's ipv6. Now, it's not being used anywhere near as extensively. running short of ipv4 addresses. So we're going So let's start by looking at the structure of four numbers separated by dots. And those numbers which are either one or zero. So an ipv4 address addresses you get for that you get 4.3 billion And it's a big number of its dollars in your bank assigned to all sorts of different devices all people, it's just not anywhere near enough. And quite a few years ago, but it was became apparent, and it hasn't. So we are close to exhausting these if you're in a company, and your company has 1000s most likely be using ipv4 addresses. And those the internet, they go for a NAT device or some is used to represent many, many PCs. So that's a With ipv6, we don't have to worry about that. So So this is the structure of ipv6. It also has bits long. So it's a much, much bigger number. dotted decimal. So that means there's a lot more versus decimal. So that means the amount of the number that's the number of addresses you can it into some kind of perspective. And by the way, of the ipv6 address base, there's all sorts of So one that I like is that you can get 100 ipv6 huge, huge number, which means we never ever have So let's have a look at how we need to set up our we need to have an ipv4 cider block. And then we Now, we also need an ipv6 cider block now, so assign a slash 56 ipv6 address range to the VPC, address space. And those become slash 64 subnets. trillion addresses. So again, it's an example of addresses you're going to have for your computers, two numbers highlighted in red at the end of the values from 00 to FF. And this designates the each subnet. And it means that you're going to them. And each of those is a slash 64. So each of So lots of flexibility for your VPC. Now let's so we now have a local route for the ipv6 cider gateway for everything that's outside of that colon colon slash zero for ipv6, pointing at the that's not an ipv6 address in this range will go we have that specified in our route table when we routable. That means there's no network address something called an egress only internet gateway. outbound access only using ipv6. So it's kind of with ipv4 and then adding a NAT gateway into a protected from the internet, no one can access internet access outbound. So that's what an egress ferry on this topic, and in the next lesson, Hi, guys, in this lesson you're going to learn set a flow log up to see how it works and logs capture information about the IP traffic the data is stored using cloud watch, or Amazon levels. So at the VPC level, at the subnet the interface level, it's associated with the you can capture a lot of traffic, which is really as well. So let's go and create a flow log in you don't have an instance running, just launch an into your public one, a subnet, and it should have send our data to cloudwatch logs. So in the cloud create log group, and create myself a log group, retention setting. For me, let's put five days so And let's create the log group. Next, we need to permissions it needs in the identity and access So let's create a role. choose Create role, we're modify that soon, because that's not actually the we're going to go straight past policies, policy. And I'm going to call my role flow logs and create this role. Now let's find the add an inline policy, we're going to go to JSON. Amazon VPC directory. And it's VPC flow logs dot you can see, the service is going to be provided a log stream, but log events, describe log groups let's come back, override all that code, click cloud watch permissions and create the policy. not actually easy to that's going to assume this replaced, we can literally just copy this piece where it says EC to dot Amazon aws.com. So now the flow logs. Let's update that trust policy. That's Back in easy two, I've only got one instance network interface, we're going to create the flow over to flow logs, create flow log, I'll just call a one minute aggregation. So we get some data we terminate our instance anyway. And we're our log group. And let's find our role, which is And we're going to leave the default format, and couple of things. We want to send some successful new window here and put that in. And we've now a couple of times. And what about sending some that's another thing that we could do. So let's group this instance is in. And it's actually got I think that's the one that's got some rules And yes, we can see the SSH and HTTP rules are And I'm just going to temporarily delete my SSH going to try without any arguments to SSH to that keep failing because we don't have the security generating a bit of traffic. So what we can do now is starting to be sent there. Back in cloud. And let's see if we've got a stream. And I don't worry if it's not there yet, you might So let's select my log stream and see what data entries here, we can see some rejects. And including the elastic network interface, we've got port numbers, we've got protocol in there that could be useful in whatever you can click on resume, and then you should So there we go, we've got quite a few more rejects later, I've refreshed my screen. And we can see we can see the port number here, Port 80. So those So that's it. There's lots of data there And it's really useful to understand the different is included in them so you know which ones to So that's it for this lesson. And we have so we can go ahead and delete it. Once you've