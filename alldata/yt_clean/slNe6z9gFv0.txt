- That's why packets, to learn how to capture and understand. It will make you better and it will also help you in threat hunting or when help to back up and piece The idea here is that that it's buried in plain sight, right? So that's what makes this What do you think, David? Are we dealing with malware or not? - It looks like it, doesn't it? (graphics warbling) I really wanna thank Brilliant for their fantastic partnership and for sponsoring this video. It doesn't matter if you ethical hacking, networking, artificial intelligence, programming. You need to learn about numbering systems. In this example, I've I'm capturing traffic sent Notice the format of this number, fe80 sending traffic to ff02. What numbering system is this? This is IP version 6, and Hexadecimal has only one numbering system that you need to learn. Another one is binary. Do you understand this joke? There are two types of those that understand You need to understand binary. You need to understand hexadecimal. You need to understand decimal. It's important that you Again, doesn't matter if you doesn't matter if you artificial intelligence, et cetera. You need to learn this. And there's no better place to learn math and computer science than Brilliant. Brilliant gives you some by different cultures, and then moves onto modern binary, and hexadecimal. Brilliant goes beyond to teaching you numbering and helps you develop a more and intuition surrounding If you want an easy then Brilliant is the answer for you. Brilliant now offers a 30-day if you sign up using my link I really wanna thank Brilliant, again, for the partnership and For everyone who's watching, Chris is gonna show us Please put in the comments So when you've finished or part of the video, put did you actually know to do with DNS, and that DNS could be used as a way to attack your clients. As they commonly say, And here's another example by a malicious actor - Yeah, David. And this one And, really, the intent if we don't have a properly The idea here is that that it's buried in plain sight, right? So that's what makes this - I think a lot of people that DNS is just used like Packet Pioneer to IP address. But actually, you're gonna show us that it can do a lot - Yes, exactly. So that's exactly what many Here's an IP address, what's what's an IP address? But DNS can do a whole lot more. And let's take a look. Now, as you mentioned and this is actually taken from a course that I've been teaching on and we'll talk a bit more But this specific example, - Yeah. through it, just take a we can see that a lot of it is DNS, okay? So if I just go up to the top, I can see that the one that is this 101.121 device. So we're gonna call that our client, okay? So this client is allegedly, 8.8.8.8 server. (David chuckles) a lot of us use that as Google DNS. However, in this case, there's something and that's why we know that we out to that server itself. So I wanna show you something. So we send this request for We're just asking who is the name that's associated with this IP. If I come down to the if I go down to DNS, here's their answer. And blah, blah, blah. Coming down here to the lower Okay, if I take a look at the next query. This time, so here, we can see a TXT record, all right? So, l.ns.ostrykebs.pl. Okay, so what does that mean? Well, let's just take a a little bit closer. So with DNS, DNS is more than DNS has the ability to do So the query type in this Just a note about that, David, real quick, I'm just bringing in my browser here. There's a really nice This is a quick one but just what is that DNS TXT record? Well, if we take a look at Cloudflare, I thought this was a really And basically, what it Originally, it was intended as a place for human-readable notes to be in records. However, now it's possible to into TXT records, and that's So basically, it's a way of Okay? So a bit more detail in there if you want to go dig in through that. However, I'd rather demo this for you. So, let me come back to my PCAP. Now we're asking for a TXT record, and we're also asking for Something that I like to do is when you see a a site that one thing that we can do to take a closer look at it. Okay, so what I'm gonna do, and I'm just gonna do Copy, Value, so I can pull that And I'm just gonna peek into VirusTotal, this is something that I like when you see a DNS record that just looks funny, okay? So I just put this into the &quot;Okay, let's go get it.&quot; And what this does is it and it goes to some common vendors and checks to see if it's okay. Well, what do you think, David? Are we dealing with malware or not? - It looks like it, doesn't it? - It sure does. Yeah. Doesn't look too happy. Okay, so let's go back All right, so we go and from this server. So let's see what happens, Let's see what happens. So this alleged 8.8.8.8 address, which may or may not be true. We come down. Let's take a look at the for this lookup. And this is where we get this TXT record. Now, David, we don't have and scripters, and all the things. Does this look like a good, - [David] (chuckles) Yeah, - Yeah, this is code. So let's do this. I'm just gonna take a look. - [David] There's a while It's matching something. - Excellent. Exactly. So, right away, we can In fact, this is what I'm gonna do. I'm just gonna take and I'm Or you know what I could do Let me just right-click and I'm just gonna do Show Packet Bytes. Now this is where I can and that's just basically And without going too deep into the weeds on the string itself. Basically, what this is doing to the client to continually come back and ask more questions for And then when it's finished, All right. So, let's So this is just the initial request, okay? So this just came in from this server, but now, check this out. So now we're gonna go to a local box, which has absolutely been compromised. And if I come down here, now this is basically in a but let's go ahead and start of these DNS records. So now, this client, this client is now of the attacker. It's going to 100.2 DNS, hitting us on 53. And let's take a look at what's happening. So first, here we have this first request, it's going to l.1.ns. Okay, give me your TXT. This server comes back, or alleged server comes back and says, &quot;Oh, great. Thank you. Here's your first instruction, .1&quot; Now, truncated. So this TXT record, it's keeping it small, So what we're trying to not to do this massive because that might trigger and say, &quot;Whoa, whoa, whoa. Wait a second. You have a huge DNS record That can't be good.&quot; 'Cause usually DNS requests and responses are smaller packets, you Here's 254 bytes. This Check it out. Does that look - [David] Yeah, it's - Yeah. On it on its own, But if we go back to we notice that there was actually Base64 in the previous request. And you come down here, I can do a Decode as, Now when I decode it as Base64, what's our thought here, David? Do you think we're starting - [David] Yeah, it looks extreme. More and more dodgy, right? - Yeah, right? This probably isn't something I wanna see just in a TXT value coming back from DNS. Okay, so let's just remember that. Okay, there's that one. And if I close this, I'm We do another query, but So the first one was .1, this is .2. Okay, we do a TXT query. Same thing. Let's kick back. Let's Now another 254, gonna come down here, going to right-click, Show Packet Bytes. I'm gonna come up here, and this is where I can decode as Base64. Uh-oh. - This looks like the Okay, so what's happening is this script and we're one chunk at a time. 254 bytes at a time. So you can see request. This So six, all of these different ones. So all these different pieces. Well, what happens when the extracts that TXT, and That's what we wanna find out. So the next thing I'm gonna do, David, is I wanna show you something super cool that we can do on the command All right, so I just showed you, in Wireshark, we can see or encoded pieces of a script All right, so here I and one reason why I do this and I can throw a packet capture at it, and I can extract certain fields from those packets using TShark, and put them all in one place. You can do this with other tools. For me, it's just something So, Terminal Shark. So this is what I'm gonna do. I'm gonna say tshark, all which by the way, David, if you install Wireshark by default, TShark will get installed as well. So you already have this in your machine if you've installed Wireshark. All right, so the first thing I need to do is just tell it to read. So, I'm gonna read in. And as I recall, I'm just gonna look... C2 analysis, that was So, C2Analysis.pcapng. All right, and so now I'm I'm gonna do .y or -y. And what I wanna do is for all packets coming back. Basically, these 347s. And I want to... If I click on this string down here, if I go down to the lower left I can see that this is showing or this location rather, All right, so if I just so let's just do that, dns.txt, enter. What I see is I'm getting from that server, right? Because they actually have So that's gonna be a good filter for me. So let's just do this, dns.txt. Great. Now what I wanna do is I So I'm just gonna do this, and then what I do is I'd say &quot;fields.&quot; So that tells me go into and print that out to Now, which field do I want? All right, now if I execute this, do we see what we're doing here? TShark, hey, go read this and pull out this field. Now I have all of those So, David, I'm going to introduce you to another buddy of mine, So it allows us to take different strings and whatever's been encoded, decoded, and tinker around with it. So I'm gonna go ahead and So here's all the messy code, but let's go ahead and say From Base64. So, this will decode it. And now, we have the full string, So you and I can now begin &quot;Hey, if this was sent to a victim machine and it ran this script, what would it do?&quot; Well, here, I'm not the best person in the universe with scripting. Maybe together we can help So basically, what we're &quot;Hey, go look for or get a and I want you to pull and I want you to loop and do this until you get a full string.&quot; Once you get this full script back, if we come down here, that my eye looks for, Well, you're gonna reassemble it. And then this guy, IEX. So, what is that? Well, pop that in Google and just IEX, right there in a PowerShell script. This is Invoke-Expression. Okay. Well, that can't be good. So that means that I'm and as soon as you get all Okay? And we can see sendResult. So, what starts to happen here gets all of these pieces of the next aspect of this attack is it's now starts Now we actually start to That can be heavily encoded between the attacker Using DNS TXT fields is the way that that first instruction gets sent, and it's sent in pieces to try to float below the radar of an IDS or IPS. Once it's actually all now that invoke-expression call back to our server and - Yeah, like how does the Is it something to do with the DNS, so that machine is compromised somehow to go to the wrong DNS server, or how does the initial thing kickoff to actually request that TXT file? 'Cause you've shown us the DNS and then it's requesting the TXT file, but how does it actually - David, that's a great question. So I would imagine a few One, standard good old phishing, sending a user a link, to a malicious device that Spoofing a DNS server, (chuckles) acting like we're the one, the authority. - I'm the captain now. - And initially, we're going out to an allegedly known address, and we're doing this to be a good DNS record. But then that record gets implanted and the TXT is what So initially, this and asking this question. But in order to ask that question, how did that get to them, Probably from some type - But it's amazing. I mean the fact that, like what you're showing and then the answer is he has a TXT file. - Exactly. - And the DNS server can to pull down some crazy TXT. - Yeah, so it's interesting how this malware could be of a DNS query. I think this is just crazy. - As they always say, - (chuckles) Right. That is true. And this is also why modern IDS systems are gonna be taking a much closer look at inspecting DNS, right? It used to be that this would just walk right by. But now, if you have a string like this or if I come back down to we were looking at, even a Base64 encoded to decode for our detection systems. Because this was so prevalent, and it was about about 2017, '18, was where we started seeing this. Basically, the malware and it was really designed to illustrate how this could happen, how we could bury C2 traffic in DNS calls. Thankfully, now, many systems are tuned to be able to detect this However, it's still something and how we could deliver that using DNS. - Chris, that's amazing. So, thanks so much for What I really love about what down to the wire where you I think you've said it 'cause I'm probably gonna say it wrong, something along the lines - Absolutely. Packets don't lie. This is the traffic that's which is another reason why I'm not just network engineers but If you're just getting studying for your Sec+ or even Net+, or any entry-level certification. That's why packets, to to learn how to capture and understand. It will make you better and it will also help you in threat hunting or when help to back up and piece - For everyone who's watching, Chris does this stuff day in and day out. And Chris, we can't say names but I know that you're doing some work with government agencies and banks, and big institutions to try and help them with their capturing Just basically teach people how to use Wireshark like you do. So I really appreciate you sharing all of this knowledge with us. - Oh, no problem, David. I love coming on and and we always find some So, until next time. I think I'm gonna go back - So for everyone who's watching, please put in the comments to talk about, perhaps, in future videos. We've also got a whole bunch of videos which I've linked below where Chris teaches us Wireshark, teaches us a whole bunch of other things. Chris, all the very best. - Thanks, David. (logo chiming) I wish you all the very best.