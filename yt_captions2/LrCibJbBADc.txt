in this video i'm going to be talking about compositing a fantasy 3d render this particular one happens to be my entry for the bonusia boss fight competition i've already done a breakdown where i focused on a lot of the 3d side of it so this video is purely going to be looking at it from a compositing perspective in nuke a pretty large amount of what you're seeing in the final render is coming from the compositing stage anyway so this is probably the more significant part to start off i thought it might be interesting to show what it looks like just with the 3d renders slapped over the top of each other so i'm just going to grab all the different render passes so that's the foreground this is the eye and then we have the 3d render of the background let's just merge all of these together as you can probably see this is not particularly exciting and i think this really highlights how much of a difference compositing can make to a final 3d render a lot of people that i see posting stuff in the discord server for example just post the 3d render pretty much straight out the box and don't do much comp work to it and it always just kind of looks like it's missing that final stage there's so much balancing and additional elements that you can put in in the compositing stage to really bring a 3d render to life so just again to compare this is before and this is after pretty massive difference the scale difference is just due to the lens distortion but if i uh put the lens distortion setup on here now they should be pretty much exactly the same which they are so what did i actually do i guess that's just work from the back and make our way forward i started off with the 3d render of the cave this is pretty straightforward nothing super exciting it's just basically some geo for the stalagmites and stuff and the background of the cave it's flickering slightly which i did in blender so that's actually in the render i did a couple of bits to tweak this with some color correction so as you can see here this is what i just changed it doesn't make a massive difference but i was just tweaking it a little bit the first thing i did is just lift the black point a little bit in the distance i did this using the depth pass and it just gives the back of a cave a bit of a kind of misty lifted hazy feel um as if the space is slightly bigger the way i did that is i used the utility pass i shuffled out the depth i don't know if we'll actually be able to see this very well there we go i used a grade node set to all and i just graded it slightly to get a more usable mask so essentially i wanted one where all of the foreground stalagmites and things were pretty much unaffected so you can see see they're almost black or a dark gray then as it goes further back into z space it gets lighter and lighter i did that by adjusting the gain in the gamma so as you can see here i've just turned the gain and the gamma right down which was similar to what i was doing with the viewport up here actually then i did a second grade note and just brought those values down even more because the first one wasn't really strong enough so as you can see that's the difference and then this is now the alpha channel that i used to actually grade the cave render so you can see here in this grade node i've literally just changed the black point to minus 0.01 pretty minimal but it's all the small things that will add up to make it look really cool then secondly i used the position pass if you don't know what a position pass is it's essentially a load of colored gradients going through the scene and every point in 3d space should more or less have its own color value which means that you can use a node like a pmat this isn't built into nuke but you can download it for free from nucopedia or if you're on my patreon you can download the new script and then you can just grab it from there so the way a pmap works if i add a new one is you plug it into your position pass which looks like this and then you can take the color picker and control and click anywhere in the world and you can see it creates this little alpha where your point is placed then if i turn up the scale this will actually give you a expanding mask or an alpha channel for the bit that you selected in 3d space and you can move this wherever you want so i hold ctrl and move this around you can see it's completely interactive and as the scene moves this will actually stick so if i scroll through you can see that the mask is staying where i've placed it in 3d space so what i actually used it for in this case was i created a mask that started at the top in the background that wasn't including any of the foreground objects and it just slowly falls off as it comes down i managed to get that effect by changing the scale slightly differently so it's much wider in x than it is in y and z and then i'm using that going into a color correct and i'm just using the alpha channel from the pmat to basically grade the top of the cave a little bit so i'm taking some contrast out and i'm making it a little bit darker by dropping the gain and it just gives the cave a little bit more shape i think and it makes the rock formations on the ceiling stand out a bit better but get a bit lost here but if i turn that on you can see there's a bit more contrast between them and the background here i'm also copying in the depth channel i didn't actually end up using this but initially i was playing around with using a zd focus on this but in the end i found it wasn't really worth it so i just ended up using a normal 2dd focus node so i can actually turn this off because it's not doing anything and then lastly i added a very subtle exponential glow onto this it's not really even particularly visible what it's doing unless you get really close you might be able to see that i'm not sure all with youtube compression whether that'll be visible or not but it's just giving all the highlights a very very subtle pings they just bloom a little bit there aren't even any particularly bright highlights in this background render pass so it's really not doing a huge amount then after that i started to add some 2d assets so this first one is a smoke layer this particular one is from action vfx i've got a load of their stuff and i really highly recommend it i'm not sponsored by them or anything i just use it all the time so it originally looks like this i'm using a grade node just to make it a bit more warm so i've put some more warmth into the game to make it a bit more orangey the idea of that is that there is some lava underneath it so like down here out of frame so i'm making the color of the smoke more the color of the environment then i'm also using a ramp node which is just like a gradient going through my shot it's starting at the bottom and then it feathers off as it gets higher in the frame and all this is doing is making the very bottom of the smoke even warmer so again this is kind of faking the proximity to the lava and as you can see there if i turn it on and off the lower down the smoke is the more orangey it becomes then the next two nodes are adding some intensity into the center eventually the 3di is going to be on top of this so i'm just using a radial node here in the middle and i'm kind of faking that light interaction where you have the proximity of the fiery eye to the smoke so it'd obviously be getting a lot brighter so that's what that's doing so in total that is going from a very generic looking smoke element to something that's a bit more bedded into my shot and again it might demonstrate the before and after with the grades that's the difference this then gets placed on a sphere in 3d space and it gets rendered through a scanline render which is using the camera from blender and i'm utilizing this a lot through the nuke script by placing things on different bits of geometry at different depths in the scene so like i said the smoke is placed back here and then the render camera is over here for reference this is where the actual 3di is going to be later on so that smoke element is quite far in the background as you can see then the next thing i added is some lava splashes this is a slow motion water element i actually used a similar thing in my last punisher challenge as well i thought this would be perfect for adding some nice slow motion lava into the shot so the first thing i'm doing is taking this and adding a chronos node onto it which is a re-time and the reason i'm doing this is because the camera moving 3d goes from real time to slow motion and then back to real time this water splash is already in slow motion so you can see here i've got some keyframes where it starts off at 2.8 speed or 280 increase in speed and then it goes back down to one or a hundred percent so essentially i've sped it up at the beginning to fake that it's in real time earlier on and then after this point it goes back to its native speed which is slow motion then this gets put on a card as well this one's a lot closer to the camera so as you can see this is pretty much just behind the eye so the rocks are here and this is the 2d splash on a card this is what it looks like through the scanline render and then i'm pre-molding it and adding a load of grade nodes to make it nice and orange and look like lava so here i'm just using the gain and putting loads of warmth into it again by using the color temperature slider i decrease the saturation a tiny bit so i took it down to 0.92 it was just a little bit too orange before so that's just taking a little bit of that color out desaturating stuff makes it go a bit closer to white which usually makes it feel hotter and like it's kind of blowing out in the camera sensor and then finally i was just gammering it down a bit as well that's got a 2d focus node on it just so it's not perfectly in the camera's focal plane and then finally an exponential glow it's a pretty subtle one but again it's just giving it a bit of life giving those hot spots a bit of a ping and then that goes on top of everything else then next up we have the eye effects or most of them anyway so as you can see quite a bit changed there again this is lots of 2d bits so to start off with i'm using another action vfx fire element this one's just called big fire very appropriately named starts off like this then i unpremolt it to start doing some color correction and then i'm using the color correct node to basically push some more contrast into it it felt a little bit flat before so as you can see here i'm making it a bit brighter and i'm also turning up the gain on the highlights which just takes the very strongest bits and makes them even brighter to add some more contrast i think i also tweaked the ranges slightly so if you go into the ranges tab and press test these sliders basically let you dictate what's a shadow what's a highlight what's a mid-tone and by moving these around you can change that i slid these around until just the very highlights on the fire were selected for the highlights and then by turning up the gain or turning it down you can see that i'm just tweaking that part of the image it's a really handy way of pulling around 2d elements and getting a bit more out of them i'm also using a radial that starts at the bottom and goes up and i'm using that to make it a lot brighter the idea is eventually these get turned sideways and then combined like this and the eye is going to be in the middle here so this radial if you imagine this is where the bottom was before it was rotated the radial is making it a lot brighter at the source and i found when i combined them if i just jump ahead slightly later the 3d eye was much brighter than the fire assets so that increase in brightness that i've added just helps to transition between the brightness of the 3d eye and then into the 2d fire elements so anyway going back to this bit that was the fire then i added some lightning i looked at a lot of references of the eye of sauron from lord of the rings both concept art from the actual films and the hobbit and i kind of combined all of them and i noticed that in a lot of the shots it has some lightning coming in from the sides so to create this effect i used the x tesla gizmo if anyone's used nuke a fair bit you're probably already aware of this if you're not again it's a nucopedia node that you can download for free or again if you're on the patreon these will just be in the script it's exactly the same kind of thing as after effects's advanced lightning effect it's just procedural lightning generator and it has two points and wherever you place those two points it will create some lightning arcs that go between them so i created four of these and the second two over here are linked to the position of the first two all it means is i can just move the points on the first node and it will update both of them so merge all of those together so like i said i did four of them so there's two and two and then merge them all together so you get four and then there's an exponential glow on here to give it some life and then just some grades to give it some color again all pretty much the same thing in this grade node i use the multiply and the gamma and just again added lots of orange into them to give it that color and then again i used a saturation node and took it down to 0.86 just to make it a little bit less super colorful and make the core of the lightning a little bit whiter to make it feel a bit hotter that then gets merged on top of the fire which looks like this and then on top of that i also added some embers so these are another action vfx element what a surprise there's a time offset on this just to get it to the correct point in the shot and this is just a nice element of some rising embers coming up from out of the frame there's some color correction on these i think i made them a fair bit brighter as you can see i didn't have to do too much because they're already the right color and everything obviously and then i just transformed them into place so i put them basically coming up from behind the 3d eye or where it's going to be eventually and really once the eye is on top you just kind of see them coming out from behind it back up here because obviously this is all covered then here i have another chronos node which again is for re-timing and i'm doing the same kind of thing that i was before so to mimic the fact that the 3d camera has different changes in speed i'm re-timing these elements so that the fire and the movement of the embers will all be moving at the correct speed when it goes into slow motion all of this stuff is in real time so it starts on a speed of one then it goes down to 0.7 and then stylistically even though the camera doesn't get any slower than that i actually went down to 0.6 in the middle just to really hit home that sense of slow motion and then it does the inverse as it's coming out so it goes back up to 0.7 and then one eventually here then again these get put on a card as well and they're placed in 3d space these are placed at the exact depth where the eye is in 3d space as well because they're all meant to be together that goes through the scanline render and then that gets placed in 3d throughout the whole shot at this point i did a pre-comp because this whole setup was quite heavy especially once it goes through the scanline render so here i just did a pre-render which makes it a bit lighter to work on so once this was all kind of locked in i was happy with how it was looking i just pre-rendered it which makes the script nice and responsive still so i can actually play it back in real time while i'm comping the rest of the stuff below so that's what it's looking like so far as you can see it's starting to look nice we've got some cool atmospherics the lava splashes there and the fire is looking cool next up is the actual 3di going on top this looks more or less how it looks when it came out of blender i just tweaked the colors a little bit again first of all i'm pre-molding for the color correction process then i'm using a color correct and i'm just taking a bit of saturation and contrast out of it because if you look at the raw render it's actually quite punchy like the black point is a bit nuts and it's very saturated compared to the fire elements that i'm using so it took a bit of contrast and saturation out lifted the black points a tiny bit as you can see there and that should help to balance all of the elements together and make it feel a bit more cohesive in the end this bit off to the side is creating this kind of fractally edge the render on its own had some edge problems here where you could see the texture was kind of going over the edge of the geometry i only noticed that once i'd finished rendering it and instead of rendering it again i just decided to erode it slightly with a fractal blur so this just kind of eats into the edges a bit more which gets rid of that problem but it's still an animated fractal blur so it gives that edge a bit of animation which is nice the fractal blur is just a group of nodes there's loads of versions of this sort of thing on leukopedia again this is the one i particularly use i think i just nicked this from somebody at work when i was at the mill this will also be in the new script if you download it from patreon so you can have access to that then there's an exponential glow on this it's quite a strong one and i'm putting it under here so i'm using the under operation in the merge node which obviously does the opposite of over which is the default setting so this is just a very strong exponential glow i blur it a bit as well just to get rid of a bit of the definition of the eye and then i put it underneath just to give it a bit of a kind of back glow look i think the main reason for this was just to make the transition between the hot edge of the eye and the fire a bit smoother so you can see there it's kind of softening it off so that's pretty much it for the eye then some heat distortion this is another gizmo it's not built into nuke but i think it's free i really like this no it's pretty simple to use it just has control for the distortion amount and there's different options for like how much heat blur and stuff you want so there's quite a lot of controls for the different aspects of heat distortion because it's not just the footage warping you also get kind of different levels of blurring so the more the air warps the more it kind of blurs what's behind it a bit difficult to explain but essentially it's kind of managing all the nice artifacty stuff that happens with heat distortion all in one node and then on top of that goes the next part of the 3d render which is the foreground stuff and the character this is my frodo baggins attempt it was quite forgiving because the 3d was pretty much all backlit at this point as the light source is right in front of it so my very half-assed 3d model doesn't actually look too bad in this case as you can see pretty much no color correction going on here apart from a black point shift just again to get all the black points of all of the different elements in the same place so i'm just lifting it a tiny bit as you can see up here this has also got some heat distortion on top of it i wanted to do two different lots of heat distortions so there's some that are on everything up until this point and then the very foreground has a different level of heat distortion that's a bit less and importantly i also protect effect alpha on this one which means it actually ripples the edges of the render as well as just the rgb channel this then has an exponential glow on it again this is what i was saying before about how all the highlights just get a bit of a nice kind of bloomy ping on it there's nothing really really strong because none of this is actually on fire but it just mimics that nice kind of bloom effect you get on the highlights and it also makes it feel like it's diffusing a bit as it's coming through the foreground levels of atmos and smoke so that's what that looks like then we've got all the kind of foreground at mossy bits which as you can see here i have conveniently labeled atmos which in case it's not clear is short for atmosphere so the first bit is ah it's more embers so this is a much more foregroundy embers layer that are very close to camera um so you as you can see they're much bigger and like i said in the last video if you use different scales of 2d elements it makes it feel like it's a bit more of a 3d effect so i've got these smaller ones in the background and then there's some more in the foreground which are different sizes they move at a different speed so it makes it feel like it's almost like a 3d particle system that's in 3d space because you've got so much variation in the look and the speed and everything time offset just to get a bit that i particularly liked i found a nice moment here where this bit kind of comes across the screen that i really liked so i'm using this section of the element it has the same treatment with the re-timing so it goes from real time to slow motion in the middle just like the other ones with the kronos node then as i've said a lot of times now a bit less saturation making it a bit brighter and i also graded the owl for a tiny bit as well so be in the grade node if you set the channels to alpha um i dropped the gamma down just to make them a bit more transparent it just adds a bit of contrast into the alpha and i found it made the edges a bit softer which was working nicely next up this is the foreground lava splash now it's not actually on this frame let's find where it is here we go so this is another one of the same elements of the water splashing and it's exactly the same thing but it's placed in 3d space a lot closer to the camera so as you can see it's pretty much right in front of it whereas the eye and everything is more like here in 3d space exactly the same processor before put on a card bit of grading to make it orange i've got to convolve on it this time which is like a defocus but it uses a kernel and i'm just using a kernel to make the defocus a little bit more interesting i don't actually think it's really doing much in this case but whenever i have stuff that's near camera that defocuses quite a bit i always try and use a kernel rather than just a normal defocus node just adds a little bit of interest into the bokeh and then again very subtle exponential glow this is hardly doing anything on this one just a very little bit of bloom for this one i tried to steer away from going too glowy and soft i did that quite a lot on my previous one with the gandalf render and i think i went a bit heavy-handed with glows so i kind of eased off on that a little bit on this one so that is the foreground lava splash then we've got some more smoke in the foreground this is one of the last atmos layers and it's quite subtle as in i haven't like made it too strong and dense because you still want to be able to see through it but it just does a nice job of kind of taking a lot of the contrast out of everything and kind of balance the whole image a bit if you imagine you had like a layer of smoke in front of a load of light sources the light all kind of diffuses as it comes through the smoke which flattens everything out a bit and works really nicely so this is just one smoke element again from action vfx i've got a couple of luma keys on this and it was kind of like what i was doing with the color correct node where i was picking the ranges this is just a bit more of a manual way of doing it i keyed a couple of different levels of the smoke just to add a bit more detail into it i'm just picking out some of the highlights and stuff just to make them stand out a bit add a bit more contrast into the smoke without literally going right add more contrast because it's just a bit harder to fine tune it that way then i've got a ramp node off to the side that's just grading down that left hand side quite a bit um i think that was just because when you put it over everything it was quite strong on the right hand side as you can see here so i was just tweaking the transparency a bit and in this case grading it down to be darker just makes it a bit more transparent it's a bit confusing because it's flipped when it gets put on the 3d card so i'm grading down the left here but you can see when it's over everything it's actually the right hand side that's being affected bit on the right hand side isn't for grading the smoke this is actually creating the alpha for it to be merged over everything with this footage doesn't come with an alpha so to make it merge properly without setting it to screen which isn't really how you want the composite smoke i did a luma key and then just used a rotor shape as well just to do a bit of a garbage mat and separate out the bits i wanted so there was no harsh edges i then copied this in as the alpha into the footage and pre-mold it so this is my kind of overlay of the smoke that i'm going to eventually put on top of everything so this is what it looks like once it's on the scanline render again it's very foreground so it takes up most of the frame and then this last thing that i'm doing here is i'm taking all of the stuff in the background blurring it quite a lot and then grading it a bit to add some contrast and taking a bit of saturation out and then i'm multiplying this over the smoke and what that does is it makes the smoke inherit the color and the light intensity of what's behind it so if i don't do that it just kind of uniformly goes over the top of everything whereas what this does is it makes it the right color but it also only makes it really stand out when it's in front of bright light sources so you can see without it there's loads of smoke in the corners on the bottom of the frame but there's not actually any light sources behind them so it doesn't make much sense for them to be lit up like that when i turn it on it's adding a lot of attention into the center where the eye is because that's where the bright light sources are and then the smoke gets darker as it falls off to the edges because that's got less light coming through it that's a good hack for making 2d elements feel like they're lit by the 3d scene because you're actually making it sort of fakely inherit the 3d lighting so that's what that looks like on top of everything and then lastly some more sparks in the foreground so again this is just an extra level of kind of rising embers that are a different scale like i was saying before so in this shot there's two or three different kind of like drifty ember elements and they're all at different places in 3d space different scales different speeds just adds some nice variation into the shot same sort of stuff as before changing the saturation a bit and grading it and then you can see them just going on top here and then finally this stuff down here is just doing the kind of like on top of everything lensy artifact stuff so although i put some very subtle glows on all the elements individually i also do like a global glow global glow that's a tongue twister and this one will be a bit stronger and the reason i do it on top of everything is when you do it on all the elements together like i was saying with the highlights here where the extra glow behind it helps the transition doing the glow on top of everything kind of smooths everything out a bit softens it all embeds it all together so here i'm using a node called ap glow again loads of different versions of this sort of thing online i could have also used exponential glow i just kind of prefer ap glow for slightly softer more bloomy glows also the way it works by default is when you plug it into something it does an operation where it minuses the glow from the rest of the footage so what you're seeing here once you plug it in is just the glow effect and nothing else you're not seeing what's underneath it like you would if i plugged in an exponential glow like this for example with this it applies the effects just on top of everything and you see it with the render underneath ap glow works a bit differently where it isolates the glow and then you can kind of tweak it before you put it back on top i dialed this in so it's fairly soft there's no really bright highlights or intense parts of it it's more like kind of what you're seeing where the light is coming through the smoke where it's quite diffuse so it's not super strong again it's just kind of softening everything out a bit and flattening the picture out slightly bedding everything together so once i had that dialed in where i liked it i screened it over everything so that's what that's doing it's mostly just bloom but it's also adding some intensity to the really really hot bits that are pretty much pure whites like here and here on the edges of the fire then i did a secondary one which is a bit more of a poor man's glow but i just took everything up to this point and started blurring it by different increments and turning the mix down which gives you this kind of effect so for here example this one is on eight and the mix is on one then i'm pretty much doubling it more or less every time not exactly but this goes up to 23 turn the mix down to about 0.4 the next one 59 and the mix is 1.2 and so on and so on and the last one is on 400 and it's mixed only in by about 10 percent i put a crop node after this because if you don't crop it the blur bounding box becomes enormous so it's just good to keep your scripts nice and optimized and as you can see this is like super super bloom and i just screamed this back on top of everything as well very subtly you can only really see it in the middle it's just giving it a little bit more of a lift and then finally i just added some lens distortion 3d renders don't have any lens distortion obviously normally if you're comping some cg into a live action shot you would only put the lens distortion on the cg render but in this case because the whole scene is cg i'm doing the lens distortion right at the end because everything is from the 3d render and blender so the actual output resolution is 1920x810 but as you can see here my 3d renders are actually slightly bigger than that they are 2208 by 931 and i've called this format ud which is short for undistort so basically this is rendered with 10 or 15 over scan i think it was and then here i had a reformat node which is resetting the picture to 1920x810 but it gives me the bounding box at the edges for the lens distortion for the overscan the way to do that if you don't know is you just plug in a reformat node into your footage have the format set to your shot size which is 1920x810 and then you set the resize type to none which you can see there is now scaling up the footage and then lastly turn on preserved bounding box and that will now preserve the bounding box for you to apply the lens distortion so this is now the lens distortion going on i've gone quite strong i can't remember what the focal length was in 3d in fact it should tell me in the camera 73.913040 millimeter lens i didn't really take that into account i just did what i thought looked artistically quite nice so i applied the lens distortion then add a crop node again just to keep the uh shot a bit better optimized i'm then adding a chromatic node this is a chromatic aberration node again this will be available in the nuke script if you download it from patreon this is one of my favorite chromatic aberration nodes it's very subtle and it does less of that kind of horrible blue red fringing that you see that's really over the top with a lot of chromatic aberration effects this does a bit of a very subtle blur and then you get the color color shifting but it does it in a bit more of an organic way i find than like a normal chromatic aeration node so that's just going on the whole picture it's pretty subtle you probably wouldn't even notice there unless i told you but if i turn it on and off you can see the difference it's making and then finally it's got a grade node with black clamp turned on so there's no negative values a crop node just to make sure it's exactly the right size and then i render it out as an asus cg exr sequence which then i took into resolve and just did a bit of a color grade on it and that's it that's how i composited that whole shot as you can see there's a lot of stuff that goes into it and it's a lot more than just combining the 3d elements and putting a glow on it you can really give 3d shots so much love by placing 2d elements and stuff into them and integrating all of that together a lot of the best compositors i've ever worked with will really really go to town on like using live action elements integrated into cg and i remember always being completely in awe of seeing people doing it and just getting such an amazing result it can look so much nicer than just always relying on the cg looking amazing even at the biggest studios in the world there's not always time to do like a custom effects pass for every single detail in a shot and there's so many amazing things online these days like with action vfx and stuff that you really can just take 2d elements and drop them in get them the right color put them on some geo in your shot and it looks great and the shot is so much better for it so there we go i hope that was a useful insight into compositing a fairly large 3d scene thank you very much for watching and i will see you in the next video peace [music] faded now until