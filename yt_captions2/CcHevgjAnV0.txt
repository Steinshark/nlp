when you make as many videos as we do, you need a lot of fast, reliable storage. and our main editing server, whonnock, has checked all of those boxes for years. it's a great little server. it's built out of high quality components and it even looks cool. but as our team has grown, we've reached the point where even a minute, one single minute of downtime costs over $50. and that's just in payroll. now, practically speaking, the way to mitigate that is by adding redundancy. now, our drives are already redundant. we've got 20 drives in there with data striping, but the problem is they all sit in one single server. and i'm sure you can see where this is going. it's been over a year in the making, but it's finally here, whonnock's final form, and i'm calling it... whonnock 10, because it's the last whonnock ever. high availability whonnock! whonnock 10! i told you this like 10 times. nobody even knows what high availability means. it means it's linus proof. just go ahead, unplug one. do it, go for it. okay, i should probably tell you the stakes before you do that. each of these two grand twin boxes has four entire servers inside of them that were provided by supermicro. we sponsored this whole thing. and they're set up with weka, a redundant nvme first file system. in this config, it should sustain two entire servers dropping out without anyone even noticing. except that we moved the entire team onto it last night without telling anyone. and it's the middle of the workday with a ton of high priority videos in progress. do you really wanna test it right now? i haven't tried that. all right, here we go. okay. what could go wrong? i mean a lot. naturally, a huge part of a project like this is the software, the stuff that's gonna handle distributing all of our hundred-ish terabytes of video projects, word documents, and linux isos to the multiple machines that we just showed you. but we can't install any software until we have some hardware. so why don't we start there? meet the supermicro grand twin a+ server as-2115gt-hntr. despite it's sort of ordinary looking appearance and unexciting sounding name, it is anything but ordinary and it is very exciting because inside this 2u is four independent computers. but for what we're doing, four nodes? please, we want eight. inside each of these is a completely independent motherboard, 384 gigs of memory, an amd epyc genoa processor with 64 cores, dual m.2 slots for redundant boot drives, six pcie gen 5, two and a half inch nvme slots up front, and we've got i/o in the rear. now, this bit here could be a little confusing at first glance, but that is because not only do we have usb, but we have two full gen5 by 16 pcie connections back here, along with display output and power for the entire server. this whole thing slides into the chassis, which holds a really cool modular backplane assembly that we'll take a look at in a minute, and then passes through, thank you, jake, to the back of the server, where you've got a management port, a single usb port for each server. nope. it's two and they're shared. what the? i was about to ask, 'cause we've also got a single vga. you see the button? for two servers there, no way. this button toggles? yeah. and, okay, before we talk about that a little bit more, look at these power supplies. each of these is 2200 watts, 80 plus titanium, which sounds like a lot, but when you're potentially handling four 400-watt epic genoa cpus along with a bunch of ram, up to 24 nvme drives and eight network cards, well, it seems downright reasonable, doesn't it? is it 24 drives? can't be. yeah. six times four, yes. six times four is 24. and of course, that's just one of them. we've got two of those. and that means that in the event that one of these dies, the system should be able to continue to operate uninterrupted, which is a big part of the high availability goal that we have for this deployment. speaking of high availability, let's move on to our network cards. each of those pcie gen5 by 16 slots i showed you guys before, terminates in one of these ocp 3.0 small form factor mezzanine slots. and what we're putting in them is these connectx 6 200 gigabit cards from mellanox. excuse me, from nvidia that, okay, these are the older gen 4 ones. so they're gonna be limited by the slot speed of around 250 gigabit per second. but if we had newer cards, that means that each of these nodes could do 200... plus another 200, 400, up to 800 gigabit, which would of course be a complete waste for us, a, because our workload can't take advantage of it, and b, because our switch is only 100 gigabit. sorry. of course, the two ports are still helpful. we do have redundant switches. except there's kind of a problem here. that's still a single point of failure. in a perfect world, we would have two single port nics. so if a nic were to die, it would still be okay. but because we have so many nodes, we're not really worried about an individual node. you know, they could have one boot drive and it die, or one nic and it die. we still have an extra backup. how many nines do you want? i mean, i don't know, like one would be good. nine percent? which jokes aside is a really good point. if we were architecting this properly, there are so many more considerations that we would need to make. like the power coming into the rack would have to come from two independent backed up sources. the connectivity to our clients would have to be redundant as well. the connectivity between all of the systems would have to be architected in such a way that no matter what fails, everything will stay up. and realistically for us, we're not gonna get that deep into it because our goal is better than we had before, which was a single machine with its own built-in redundancies, but other than that, nothing. now at least we should be able to lose a full machine out of these eight. we can restart one of our core switches, totally fine. two machines out of these eight, and we can still be limping along. i mean, limping is a bit of a stretch. it's going to be very fast. now, normally if you buy a supermicro machine, they're gonna pre-build it for you. they're gonna validate it for you. you can even have them pre-build an entire rack or racks of these things and then validate your application on it before it ships to you. in fact, we've got a whole video that we did about that that was sponsored by supermicro a little while back. of course, this is ltt, my friends. so we, will be assembling this one ourselves. do you like that spin of the screwdriver above the server? don't worry, i won't miss. i'll never miss. see, i could do this a hundred times and i would never miss. no, it's fine, it's good. it's okay, we have seven more. anywho, for our cpu, we've gone with an epic genoa 9534. this is a 64 core, 128 thread. monster of a cpu. it'll do 3.7 gigahertz max boost. it has a quarter gigabyte of level three cache, a 300 watt tdp, it supports ddr5 memory, up to 12 channels, and it supports a whopping 128 lanes of pcie gen 5. originally, we were intending to go with 32 core chips, but they were out of stock, so. free upgrade. lucky us. compared to previous generation amd epyc cpus, genoa is a big step up in terms of io performance, which makes it perfect for this application. and in the long term, i mean, if we've got all the extra cpu cores and a whole bunch of ram anyway, why run weka on the bare metal when we could install proxmox and then use the other cores for, i don't know, high availability, plex server. yeah, or linux isos. more realistically, it would be something like active directory. yeah, which we don't really wanna do right now because if you run active directory on one server and it goes down, you're gonna have a really, really bad time. but if you run it on a bunch of servers. yeah, it's great. so normally, server cpu coolers would come with their own thermal paste pre-applied, but since we're doing this ourselves and... if you look carefully, it's not the first time that it's been installed. we are gonna be using... okay, thank you for that. a piece of honeywell ptm 7950. this stuff is freaking awesome. it has great thermal transfer properties and it can handle varying temperatures. like seriously, i don't remember how many cycles it is. not even just varying, but like a lot of temperatures. huge cycles for a very, very long time. now available at lttstore.com. is that big enough? does that cover all of the ccds and ccxs and ccws? oh, there's a second piece of plastic. am i stupid? is there a second piece of plastic? no, there isn't. should i go put one in the fridge? no, no, no, it's totally fine. i've done this like a bunch of times now. oh, she's mint. look at that, see? easy. i would recommend putting it in the fridge before you use it. all right. to ensure we're making the absolute most of our cpu, especially in this high throughput storage workload, we're gonna be populating all 12 of our memory channels with 32 gig dimms of ddr5 ecc running at 4,800 megatransfers per second. that's a total of 384. about three terabytes of memory. what? across all eight. oh. each of the cables jake's removing right now is a pcie by eight cable that feeds two of the drive bays in the front. but the reason he's taking them out is so that we can install our boot drives. these are consumer grade. each system is getting two sabrent 512 gig gen 3 rocket drives. and it's not because they're particularly special in any meaningful way. they're not even that fast by modern standards. but what they are is, from our experience, reliable enough, and they're fast enough for what we're going to be doing, which is just booting our operating system off of them. movie magic. all of the other nodes are already built. so, what do you mean movie magic? supermicro built them. oh, i thought you built them. supermicro built them for you. i took it apart. okay, fine. i took that one apart. no secrets left anymore. yep. no intrigue, no mystery. you know what is still mysterious is inside of here. i've actually never opened this before. (speaker_02)oh, okay, let's have a look. woo! holy s*** oh, that's the power supplies. yeah, this is so cool. so the whole computer is cooled by four fans. no way. there's the two power supply fans, and then these fans in their, what do they call this? like io module, i think is what they call it. look at the blades on this thing, counter-rotating. you're serious? that's what you're looking at? not this? the most delicate of spaghet. oh my god. there's not even connectors. no. every one of these wires is soldered directly to the back of the ocp 3.0. what? yeah. for storage, we're installing two of kioxia's speedy cd6 gen4 nvme drives in each node. so we've got one that is seven terabytes and another one that is 15 terabytes. they're kind of placeholders for now. and in the long-term, we're gonna switch to something in the neighborhood of about four 15 terabyte drives per node. but the drives we wanna use are currently occupied by, oh, that project. by a top secret pastry related project. so that's gonna have to wait. the good news is that when those drives become available, weka supports live upgrading and downgrading so we can just pull these drives, swap in the new ones, pull, swap, pull, swap, pull, swap. as long as we don't do it all at once. are we ready to fire these things up? okay, there's a lot going on here. what is that? is that a switch? yeah. hey, look, you can see the button now. oh, that's cool. boop, boop, boop, boop, boop, boop. what you're hearing so far is just the nvidia sn3700 32 port, 200 gig switch. oh my god, it even says mellanox on the front. i know, maybe it's an old like review sample and demo unit or something. no, we got it with the $1 million pc and i'm pretty sure that that was already nvidia at that point. can you hear that? you hear it getting louder? yeah. whoa! that one's just excited to see you. this is the weka dashboard. maybe if i go over here, cluster servers, we can see all of our servers. we have two drives per and then chorus. this is a very interesting part of how weka works. it's not like truenas, let's say, where it just uses the whole cpu for whatever you're trying to do. they dedicate and like fence off specific cores for specific tasks. for instance, each drive gets a core. so we've got two drive containers. that means two cores. a full core per drive. yeah. damn. yeah. you also have compute cores, which do like the parody calculation and the inter-cluster communication. and then there's front end, which you don't necessarily always have. front end cores manage connecting to a file system. so if you just had drives and compute, you wouldn't be able to access the files on this machine. so you would have your backend servers, right? those would run drives and compute, which is the cluster. and then on your like gpu box, you would run just the front end. and that would allow the gpu box to connect to the backend cluster servers. oh, i see. but the backend cluster servers don't need to run a front end unless you wanna be able to access the files on that machine. or from that machine, which we want to. right. 'cause we're using smb. we're using it as a- a file server. stupid nas for our stupid windows machines. yeah. you can also have a dedicated front-end machine. yes. so if you had like a hundred back-end servers. but then that's adding a single point of failure, which is what we're trying to avoid. you could have multiple of them. okay. they thought of that. yeah. i set it up so every single machine in the cluster, all eight of them are part of our smb cluster, which means, it cannot go down. yeah. realistically, there are a ton of other file systems out there that you could use for something like this. truenas has their scale out set up for clustered zfs, which only requires three nodes and is something we'd be quite interested in trying out. or if you're looking for object storage, there's a million options, but the main open source one, minio, requires only four nodes. though, when we saw how nuts weka was when we set up the million dollar server cluster. i mean, we had to try it out for ourselves. and try it out, we did. so this is each node. holy f***ing s***. look, okay, the crazy thing is look at the read latency. (speaker_02)now guys, look, look, hold on, hold on, hold on. that's 70 gigabytes a second. we've seen numbers like this before, but we're talking with, in some cases, double the number of drives and- no file system. without a file system. like raw to each drive. this is- with a file system. with a file system over a network. and we're only using 100 gig ports. like usually with a weka setup like this, you'd probably use 200 gig. well, yeah, 'cause we were, oh my god, we didn't know. 'cause we didn't even have networking as a factor last time. all the drives were in one box. i know, i know. this is networking too. and the crazy part is we're not using rdma. this is like some fancy, what's it called? dpdk, i think is the library. this is wild. yeah, look at that. read latency, 131 microseconds. that's 4 million read iops with a latency of one millisecond average. are we able to keep using wekafs? this is a trial. okay. the software is quite expensive. this is unreal. 4 million iops. this is, it is unreal. it's way more than we could possibly ever need. but it's cool. it's so cool. don't they support tiering and everything? oh yeah, here, i'll show you actually what that looks like. this is on mother vault, which i think right now has 400 tebibytes left. so let's say max capacity is 400 terabytes. now, once we run out of the hundred terabytes of ssd capacity, which you can see here. it'll just- it'll tier. i mean, it automatically tiers anyways, and you do need to make sure that your object store is at least the same size as the flash or bigger, because they're gonna automatically tier everything to it. that makes sense. so in theory, we move, manually copy everything from vault. one time. to weka one time, because it stores in like 64 megabyte chunks. and then it just stays there forever. stays there forever. and then we just have one network share, and when something, needs to get vaulted, you just, you just move it from like, you just allow it to decay. yeah, you would probably move it from pending projects to like done or something like that. we make a folder for done. yeah, sure. and then it will just do it automatically. wow. or if it's a video that like somebody was working on and then, you know, it's been on hold for three months and we shot, you know. it'll decay. half a terabyte of footage, it will just go away. and then when we're ready to work on it, it'll promote it back up. holy s*** we could net boot off of this. follow up video. yeah, i mean, why not? it's so fast. so fast. you literally could not, we couldn't saturate this. now, a lot of you at this point must be thinking, gosh, mister, that's an awful lot of computers for high availability. couldn't you do this with two? and you're not that far off. the old school high availability netapp storage appliances, like that one we looked at recently, did have just two machines. but those were both connected to the same storage drives. if each system has its own drives, when things can get out of sync, like let's say if one machine has downtime, you can run into a situation where each system believes with all the conviction in its heart that it has the correct data. and then if all you have is two, how will they decide who's right? this is typically referred to as split brain. and that's why the majority of high availability systems have at bare minimum three servers. this allows the third system to be a tiebreaker of sorts in the
case of a disagreement. now in our case, weka, that stupid ultra-fast file system that we're using, which unlike anything that we've used before, has been built specifically for nvme drives, not hard drives. well, it requires a minimum of six nodes with a recommendation of eight, but running weka can still be an advantage. video editing with adobe premiere, like we use, is very latency sensitive, and even a small delay when going to access a clip can be enough to make the software crash. so any improvement there is huge, not to mention that a pair of these grand twins spec'd out to the max with 128-core epic bergamo cpus. would get you just four rack units with a thousand cpu cores, actually a little more, 24 terabytes of ddr5, and up to three petabytes of nvme storage. i mean, heh, that makes our setup seem downright reasonable. now, the average weka customers are gonna be a little more demanding than us. visual effects studios, ai developers, genomics labs, all the folks out there that need stupid fast, low latency storage. and weka showed us screenshots of clusters that were reading in excess of one terabyte per second consistently. obviously, that was a bigger cluster, but it shows you what can be achieved with this kind of hardware running on, i mean, what used to be the crappier option, software raid. man, i feel bad even calling it that these days. i had a interesting idea with the supermicro folks. so you know how we have like two petabytes of 13 years worth of footage? thousands and thousands of hours of footage, thousands. it's really cool that we have it, but it's really hard to use, unless you just happen to know what video the thing you were looking for is in. but what if you could just like search for something? linus sebastian, i want every clip with linus sebastian. wow, bam, look at that. shut up. and let's say, you know, there's this one. that's detected that it's you throughout the entire clip. yeah, you're in a chair. so you could search for clips of linus sitting down, with a keyboard. yeah. like we're gonna be able to actually find stuff. yeah, right now there is a finite amount of objects that are trained. i mean- chihuahua. let me scroll through this. it's a lot. eventually you'll be able to train it and tell it, "hey, this is what a computer fan looks like." or, "this is what an ssd looks like." oh my god, that is so cool. so wait, is this running on these extra cpu cores? okay, no, not right now. faces and logos are running on cpu. yeah. objects, ocr, and scenes run on gpu. got it. but they're not running on any of those machines. they're running on a gpu workstation that's supermicro sent that's sitting at my desk. it was heavy. anyways, what is happening on that new server is proxies. because if we were to analyze the original clips, a, formatting is a huge problem. when you go into an ai model, it might not necessarily support the codec that you're filming in. sure. but also, clips are like hundreds of megabytes a second, potentially. that would take forever. so instead, it generates proxies of everything first, which we're dumping. to that new server. and then we can take advantage of the lightning-fast storage, plus the massive compute, and we can basically create, like, a proxy map of what everything is in the main archive. right. that is so cool! so far, i've generated 2.6 terabytes of proxies, which might not sound like a lot, but they're only 5 megabit. so it's actually, like, a lot. this is gonna be a flippin' game-changer. news, sports... yeah! can you imagine your cnn? you want that person wearing a red tie? yeah! but right now, we've done 25,000, so 2.6 terabytes is 25,000 proxies. okay, well, let's try and find something. oh, hold on. once you've generated a proxy, you have to then analyze it, right? ah. so the analysis is not done. no, not even close. i've analyzed 22 clips. okay, everything with elijah. elijah. and this is the every clip that elijah's in. and you can even see this is the actual mam, as they call it. media asset manager. yeah. the actual ai guys built this before it was like ai as far as i'm aware. back when you would have had to make comments like this manually, now it's just ai. so all of the data is in here now. and we can see here's adam. and elijah. oh, that's so cool. here's all the different objects. chair, flower pot, microphone. oh, let me show you the scene understanding thing because that is so cool. this is like a brand new thing. they barely even worked it in. but it basically... no! it basically takes a snapshot every few seconds. oh my god. two men are working on a project in a room. there is a speaker, stereo equipment, there's a faucet, there's a tripod. there's the tripod. some of these are a little less accurate. two men are working on a robot in a room. it kind of looks like a robot, you know? i mean, yeah, sure. two men are in a workshop looking at a laptop computer, looking at a machine. there is person alex clark. so this is just running right now in real time. like, more stuff is getting processed as we sit here. hey, see right here? processing logos. there it is. processing logos and faces. it's gonna take a while. yeah, it's gonna take forever. they're still working on making it function on multiple gpus. so once we can get it running on like four gpus, say one gpu is doing face detection, one's doing scene analysis, one's doing object detection or something like that, we'll be able to go a lot faster, but right now it's just one gpu. got it. but this is so cool. all that's left is to deploy it. linus had to run away to do some other stuff, so i've hired some backup cavalry. shawn, our infrastructure administrator, except we've run into a bit of a problem. linus and me in our infinite wisdom while we were making this rack so much better, ran a bunch of cables right where we need to put the server. did we just start unplugging s***? no. yeah. how are we even gonna do this? we have to like part the seas. i know, exactly. i started to try to move some of the cables out of the way, but they're all twisted together. so hopefully the ltt cable management thing, which you can finally get at lttstore.com will save us. beautiful, cable managed. we can slide a server in there now, i hope. you're in? yeah, it's in. ow, ow, ow, ow, ow, ow, ow. okay, you're good. just go. that wasn't so bad. next. hey, we're in. now we just have to run a million cables. uh-oh, let's see. do you notice anything different? well, it's loud. most of that's actually just the vent is on. one of the air conditioners is broken again. but do you notice anything different? i mean, the sticker's here. that sticker's been there for years. seriously, you haven't noticed anything else? well, you guys screwed something onto the, oh, did you put sauna pan behind it? yeah. but i thought this is supposed to be a vented door. my original plan. was to get rid of the vent that you put in. but that vent was there as a backup in case the hvac ever failed.which is fine. it still works. so that fan is the exhaust and that's the intake. you see all the gaps? oh my god. there's gaps. but do you notice the sound difference? yeah, that's a big difference. it's huge. but that server is so loud. we basically ended up where we started. yeah, but that's okay. i was just trying to normalize. i just mean, i didn't make it worse. it's not that. okay. look at that. woo! cute, right? god, that's a lot of metal. if all goes to plan, we could get rid of this and this and just have these. so no more additional rack taken up, which is nice. wow. it should sustain two entire servers dropping out without anyone even noticing. do you really want to test it right now? i haven't tried that. all right, here we go. what could go wrong? yeah! i mean a lot. the fact that all the fans just like turned down a bit is a little scary. let's go see if anyone noticed. oh, hi mark. hi. i'm holding your file server. how's your edit going? uh, what, huh? is it working? it's working. is this on wifi? hey emily. hey. how's your edit going? i'm holding your server. that's cool. everything's working. is it working? yeah. are you sure? yeah. hoffmann. what's up? how's your edit going? this is your server right here. it's amazing. look, feel it. it's still warm. wow. yeah, it's still warm. well, how's it working? it's great. you know, i'm editing the video that we're shooting. you are? yeah. we're gonna pull another one. oh wait, no, linus, you forgot one. yeah, here. here you go. here's another one of your servers. is it working? it's great though. for reference, you're not supposed to do this. you should power off the system first, but we're just trying to simulate it failing. yeah, a terrible catastrophic failure. i can't believe how smoothly it handled that. see all the lights. they never stopped blinking. big thanks to supermicro for these awesome servers. thanks to weka for making this crazy software. thanks to axel.ai for the awesome ai detection. if you liked this video, maybe check out the video series of us building our nearly three petabytes of archival storage, which we call the mother vault. that thing is awesome. and we showed it to you and it's faster now. oh, and thanks to you for being an awesome viewer.