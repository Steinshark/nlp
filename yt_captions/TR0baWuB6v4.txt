practical engineering is brought to you in part by audible and by viewers like you through patreon we all know that magnets are pretty much voodoo invisible forces acting on the real world in unknown and unexpected ways but engineers have developed a number of methods to harness that magic to perform useful and beneficial tasks including answer that age-old question how do you measure the flow of liquid in a pipe hey I'm greedy today I'm practical engineering we're building a magnetic flow meter from metering the dose of a medicine and an IV to measuring the flow of irrigation water on a farm to tracking your fuel Philip flowmeters play a role in nearly every area of our lives in fact there's probably a metre outside your home counting your water usage for your monthly utility bill there are a whole host of ways we can measure flow but today I want to talk about a method I think is particularly fascinating the magnetic flow meter we'll walk through some of the electrical engineering behind this ingenious device and try to overcome the challenges that arise when the real world doesn't quite match the theory but the theory comes first so we'll start at the beginning a magnetic flow meter relies on Faraday's law of induction which basically says this moving a conductor through a magnetic field will generate an electro-motive force which is proportional to the velocity let's break that down just a bit with an example I've got a magnet and a conductor in this case a coil of wire the conductor is connected to a new toy in the shop an oscilloscope which is an instrument for measuring changing voltage and displaying it on a screen for example here's a typical AC sine wave similar to what you measure at a wall outlet if I keep the conductor still within the magnetic field nothing happens but as soon as I move the magnet we see a spike in voltage this is the electro-motive force or EMF in Faraday's law the faster the coil passes through the magnetic field the higher the voltage spikes demonstrating that the EMF is proportional to the velocity a magnetic flow meter works exactly the same way except instead of wire the conductor is a fluid in a pipe magnets outside the pipe create a magnetic field electrodes are located perpendicular to the magnets a conductive fluid moving through the pipe will generate a voltage between the electrodes due to Faraday's law the faster the fluid moves through the pipe the higher the voltage once you know the velocity of the fluid you can calculate flow using the cross-sectional area of the pipe it seems pretty straightforward but let's see if it really works here's the test setup I've got to link the PVC pipe with a pump on one side I can control the flow of water using this valve 2 stainless steel bolts serve as electrodes to measure the EMF and to create the magnetic field I'm starting with two permanent neodymium magnets I'm measuring the EMF using a differential amplifier to boost the signal into my oscilloscope watch what happens when I start to let the water flow through the pipe the voltage jumps we're definitely getting an electrical response to the flowing water but you can see that we have a fairly noisy signal it would be a major challenge to try and convert this signal into a flow reading the problem is electrical noise and there are a few potential sources of noise here first depending on the fluid chemistry and the type of metal used for the electrodes an electrolytic reaction between the liquid and the electrode can generate an electric potential second stray voltages can sometimes exist within the fluid from other equipment along the pipe like the pump finally the liquid in the meter can have some capacitance to a very limited extent it can actually charge up like a battery which can create noise in the voltage signal between the electrodes the problem is there's no way to know what part of the signal is due to the flow and what part is just noise and the noise can be significantly bigger than the part of the signal we actually care about in electrical engineering we would say that the signal-to-noise ratio is high in other words the theory behind the magnetic flow meter is sound but the real world is getting in the way of things this is where the physicists throw up their hands and the electrical engineer step in and the electrical engineers have found that one way to avoid the issues mentioned above is to change the magnetic field over time here's how it works this is a graph of a magnetic field which varies in strength as a series of biphasic DC pulses biphasic because it has negative and positive pulses and DC because unlike a typical AC sine wave which is constantly changing the waveform only has two values on or off above as an example of the resulting EMF from a magnetic flow meter remember we only care about the portion of the EMF generated by the magnetic field since this is the only part of the signal which is proportional to the velocity of the fluid everything else is just noise notice that even when there's no magnetic field there may still be a nonzero voltage between the electrodes but if we sample the signal at the peak of the magnetic field and subtract the voltage measured when the magnetic field is zero we're left with only the part of the signal we care about even if the noise is changing over time we're only measuring the part of the signal which is induced by the magnetic field obviously there's no easy way to generate this type of waveform with permanent magnets so we'll have to switch to electromagnets of course I'm using artisan electromagnet coils hand-wound in small batches with locally sourced magnet wire here's a diagram of the overall setup the electromagnets on the flow meter are powered using an H bridge this is a circuit that allows a small signal to control high current devices like electromagnets the control signal in this case is provided by an Arduino I've written some simple code so I can control the frequency and duty cycle of the biphasic DC pulses there's a github link in the description if you're interested in the code the blue line shown here is the voltage waveform going to the electromagnets unfortunately even with all the trouble this setup wasn't quite strong enough to give me a reliable signal from some literature I read a well-set-up meter typically only generates about a hundred micro volts for every foot per second of velocity or about 300 micro volts for a meter per second for my garage workshop and the pump I'm using that's a needle-in-a-haystack of RF noise and hum especially considering that my crude apparatus can hardly be considered well set up every once in a while if I was standing at just the right spot in the room I could get a clean response from the electrodes but it just wasn't ever able to catch it with a camera but this video is all about the devil in the details so I guess I should have expected this to be a bigger challenge for now let me just use some example data to demonstrate how a real meter would calculate flow let's say I was able to measure the induced voltage in the electrodes for a number of different flow rates in the pipe I could plot those points on a graph since the EMF is linearly proportional to velocity and velocity is linearly proportional to the volumetric flow rate these points should fall in roughly a straight line the slope of this line can be used as a proportionality constant in the signal processing of the flow meter and the math becomes dead simple step one measure the induced voltage step two multiply the voltage by the calibration constant voila you just measured the flow it really is that simple assuming you get a good signal from your electrodes from generators at a power plant to the pick ups on an electric guitar Faraday's law of induction is working behind the scenes in some of the most unlikely places including an ingenious method of measuring the flow of liquid through a pipe I am a bit disappointed I couldn't get the prototype working better but I think there were some good lessons that came out of it regardless namely that Electrical Engineering is hard I thought about not making a video at all but I think documenting your failure is just as important as documenting success and this is hardly the most shameful thing I put on the Internet after some feedback on the EEV blog forms and some additional reading I think fixing the demo would require a full redesign and I figured you guys would rather me move on to something new rather than keep spending my wheels on this one if you have any ideas or suggestions I'd love to hear them in the comments and if you're interested in more technical details that I didn't have time to include in the video I'll have those posted to my website in the next few weeks thank you for watching and let me know what you think I hope you enjoyed the episode which was sponsored in part by audible I've been using audible for a long time now so I'm very excited to have them supporting the channel you guys know I like to learn new things sometimes it's hard to make time to read but I've got a long commute to my day job so I choose to spend that time listening to books audibles got over 250,000 titles so I know I'm never going to have a hard time finding something new I usually switch off between fiction and non right now I'm listening to American Gods by Neil Gaiman it's an awesome story about modern mythology and this is a full cast audio book with different voice actors for each character if you want to try it out audible is offering a free 30-day trial membership through practical engineering you can pick any book of your choice for free and it's yours to keep whether you continue your membership or not to sign up go to audible.com slash engineer again thank you for watching you