hello this is part five of the iron man visual effects tutorial series and the topic of today's video is lighting and rendering this one's gonna be fairly straightforward compared to the other videos so that might be quite relieving for some people so let's get stuck straight in this is a shot i've just set up from later in the sequence this is just a demo so in the real one there'll be some more models and stuff under the floor but this will do for now the things we're going to cover in this video are going to be different render layers doing shadow passes and reflections rendering to a multi-layer exr for compositing and then also talk about things like cryptomats that you can use in compositing as well but the first thing is the lighting before you start doing any rendering and that's very important for making this video i shot a custom hdri which if you don't know is a 360 image that has lots of dynamic range and it captures all the information of how bright all the lights are around you there is another option which is downloading an hdri from a hdri library online it's obviously a little bit complicated to make your own so what you can do is find an online library that has something similar to what you're looking for so for example i would go into one of the indoor hdris and look for something that's kind of similar color tones like this to my room this one has a very similar colored floor and it also has a window that's kind of in the same place so this would work quite well so you can come down here and download it i would recommend not going for 16k or anything because you'll probably blow up your computer but something like 2 or 4k seems to be a good medium between performance and resolution once you've got that you can bring it into blender so you go to the world tab and then for the world color click this and then environment texture and then you can open your hdri bedroom hdr you can see we have a full 360 image in my bedroom and the lighting from this is directly influencing the way the model is lit so let's say i want this to be a lot darker pay attention to how blown out the window is at the moment if i drop this down to about 0.1 which is 10 to the exposure all of that exposure detail in the highlights outside the window is retained so instead of just darkening the whole image down this acts like actually changing the exposure on the camera i'm gonna go for something a little bit brighter than it was originally something like this and with this setup you can see the lighting on the model is matching really nicely with the lighting of the background now what we want to do is start setting up a floor for the reflections and the shadows which you can see here for the floor in this shot it's a wooden floor and you can see it's quite reflective we can see some other highlights from the windows here so when we're making the reflection material we want to kind of match it to that sort of level of glossiness essentially so i'm going to unhide the floor go to the materials add a new material and just call this reflection and then what i do is make it really black and then also turn the roughness right down so it's quite glossy not that much probably about there if we go into rendered view now you can see all the reflections are coming through nicely on here obviously you have the reflections of the hdri in here as well which you don't really want so in compositing i would just mask out this section so that we only have the reflections of the suit and the arm then what i'm going to do is put this in its own collection called reflections so we can turn this on for a specific render layer then for now i'm going to hide it then i'm going to select the floor press shift d to duplicate it and then press escape so it snaps back to the same place i'm going to hit f2 and rename this to shadowcatcher and i'm going to put this in a new collection called shadowcatcher as well then under the object settings we can set this to be a shadow catcher which means in rendered view it will be transparent but it will catch the shadows like this after that's all set up you can start doing the actual render layers so for example the first one will be the suit and in this one i'm going to turn off everything except for the suit the only one you might want to leave on is the arm so you can see some reflections of it in the suit but i don't want it in this render layer so what i can do is right click on the arm collection under view layer set indirect only and that means you'll be able to see it interacting with other things in the shot so for example in the reflections of the suit but it won't show up in the render so it will be transparent here so i go into rendered view you can see what i mean the suit here is all that will be rendered but the arm will actually pick up in the reflection still then i'm going to create a new render layer this is going to be for the arm so i'm going to call this one arm again i'm going to turn off all of the shadow catches and everything and in this one i'm going to do the opposite so i'll leave the suit and the arm on again but in this one the suit will be set in direct only which means we'll see some reflections of the suit in the arm we're going to render viewed now the arm will be the only thing that's visible then we're going to create another render layer this one's going to be called reflections so turn off the shadow catcher and then for the arm and the suit we want to set both of these to be set indirect only so now the reflections they cast will be visible in the floor but we won't be able to see them so we'll just render this black plane and then we can screen this over the flooring compositing to get these nice reflections and then finally i'm going to make one more layer called shadows turn off the reflections and then set the arm and the suit to be indirect only and in rendered view now we should only see the shadows without any of the actual models so now what we want to do is go over to the compositor actually before we do that you have to make sure you have the correct passes enabled so if you go into the render layers tab these are the ones that i use if i just make a new render layer we can see what it looks like by default so you have combined and zed none of the other ones are in use i like to turn off both of these because i don't use them and they're just extra useless channels turn on mist which is the zeb depth pass which we'll use to do some zed defocusing and stuff later turn on denoising data and then tick all of the boxes for diffuse and glossy because we're going to need them for the suit and also turn on a mission because that's going to be the path we use to add some glow for the arc reactor in the chest and also the repulsors on the hands and then we can jump into the compositor and this is where we'll define what all of the different render layers do and where they go i've already got this set up but if you go into the compositor by default it won't look like this so let's start from scratch there'll be a couple of nodes in here by default just delete them the first thing you want to do is add a render layers node and we're going to select the suit first because that's going to be our main render layer then what you want to do is add a file output node and this is going to be where all the renders go for this layer the reason for using a file output node instead of just setting the output down here is we can set up all four render layers in the compositor and then just hit render and it will do them all at once instead of having to manually render one and then change it to something else and change the destinations down here this is basically a more automated way of doing it which is much better the other nice thing about using the file output node is you can rename the files to whatever you want and i've touched on this in a couple of videos before but if you're compositing in nuke you have to rename the main channel which is the image channel to rgba for it to show up by default in nuke otherwise it will just be black so with the file output node selected if you press n come down to the properties menu you can change the name of the different channels so the main one is going to be called rgba and you plug the image channel into there and then we basically just create new channels for all of the names so add input and then the next one is going to be called mist don't worry about the alpha because that gets sent in the rgba channel connect the mist and then just rinse and repeat so we've got diffuse direct diffuse indirect and diffuse color glossy direct glossy indirect and glossy color and then we're also going to turn on the emission pass because we're going to use that for the chest and the um repulsors in the hands so we turn on a mission that will show up here then we can create a new input for that as well and then plug the emission into here and then we're going to connect all of these up then after that you can define where the render goes so click the folder icon and then just choose the location of the render so shot 6 blender renders and then i'm going to call this suit version 1. it's important to make a folder for each of the different render layers so this is going to be the suit and i also like to use the optics denoiser for all of my stuff now because i think it's really good so what you can do is add a denoise node then plug the image into image and then that follows through to the rgba channel and then you just plug the normal and albedo denoising data into there if you don't see the denoising normal on albedo it probably means you don't have the denoising data turned on in the render layers tab so just make sure you have this box ticked and then this will automatically denoise the render and make it look a lot better then you want to define the type of file format it's going to be for this one to render all of the channels into a single image sequence it has to be an open exr multi layer so select that from the drop down then for color rgba so it contains the alpha as well color depth you can do float full or float half float full is a little bit more accurate but it's also much bigger file sizes so i tend to do float half for the beauty images and then codec i set to zip lossless then we can take this setup select all of them press shift d duplicate it and drag it down and then change the suit to the next render layer which is arm and then we have to re-enable all of the passes again so go into the arm render layer turn on the diffuse and the glossy and then emission as well for this one and then also the denoising data and then make sure you change where this is going so this obviously is a new render layer so this is going to be arm version one and then we're going to call this on version one as well then we can select this duplicate it again this is going to be the reflections for this one you don't need to do all the different channels we only really need rgba so just make sure you turn on the denoising data for this as well those will connect up automatically then we can set where this goes so go back up reflections version one and then finally we have to do the shadows so again we only need one channel so let's just set this to be shadows and then in the shadows layer we can turn on denoising data and just set where this is going so now all of those are set up if i hit f12 theoretically it should render all of them if you undistorted your footage before bringing it into blender then you'll want to render the camera at the overscan resolution there's an overscan add-on for blender which i'll put a link to in the description so first of all you want to actually look at what resolution the over scan is so in this case it's 1954 by 1099. so in blender i'm going to turn on useover scan and then 1954 by 1099 and that's going to set the resolution of the camera to be the over scan resolution and there we go all of those are finished i'm not going to do the compositing in this video obviously but just as a quick demonstration i can jump into nuke and then bring in the renders and here they are we've got the suit we've got the arm we've got the reflections and the shadow pass which is in the alpha there's also one other part that i use but you can't do it with the file output node and it's kind of a bit of a weird bug in blender but that is setting up cryptomats so we can change all the materials and stuff in compositing as well so for this i'll make one more render layer and i'm just going to call this cryptomats and for this one you have to use the default output otherwise the cryptomats don't work for some reason so we go on the folder and just set up the location for this render as well blender renders cryptomats make sure this is set to multi exr rgba float half zip lossless and that should do it also for this one go into the render layers tab and then turn on render single layer the reason for that is you have to render this one separately because you can't use the file output node and if you don't turn this on it will try and re-render all of the five render layers again we don't really need the reflections or the shadow catcher in this so i'm going to turn both of those off for this one before you hit render you have to actually turn on the kryptomat passes so under the render layers tab come down to cryptomat and turn on object material and asset another step you have to do before hitting render is you have to select all of the file output nodes in the compositor and hit m which will disable them if you don't do this even though you selected only render one layer for the cryptos it'll write over these as just black frames which is really annoying catches me out probably one in three times i render anything in blender so remember to do this otherwise it will overwrite your renders and then when it's all set up hit render and the cryptomats will render out as well and to show you what the cryptomats actually do i can read these into nuke then i can add the cryptomat node you can see it creates different colours for all of the different uh elements of the model essentially so for example in crypto material it has a different color for all of the red sections of the suit the steel the gold and then obviously the bits of the arm and the reason this is useful is you can go in and color pick one of these areas so for example the red and then it gives you an alpha which you can use to actually grade the suit so i can go in and use this to change things like the saturation of the red in the suit without having to do any roto or anything so just to give a really quick demonstration of how this works before the compositing video next week i'm to grab the cg and then just add the lens distortion back on so it goes down to the correct size so that's the shadow pass then we can grab the reflections and do the same then the arm render and then the suit this is obviously terribly composited and ignore the fact that there's still the monopod underneath the suit and then the idea with the cryptomats is i can take this and let's say i want to make the gold a bit brighter on the suit i can select crypto material and then color pick the gold area this will give me an alpha for the gold and then i can use this alpha as a mask and use that to grade the suit so like this and i can just crank the gain up i use this a lot on the last iron man video for just getting the hues of the suit to be correct a lot like tweaking the saturation and stuff of the red and just balancing it all and making it look nice the beauty of this is it means you don't have to go back and re-render it with less saturation on the red or something because you can get a perfect mask for just the red sections of the suit or whatever you'd like as well as material it also has an object selection mode so i can go to crypto object and then i can select maybe just this whole chunk of the arm then i could use this alpha on the arm and i can do whatever i want with it make it purple so there we go that's a fairly comprehensive look at lighting and rendering for visual effects in blender i hope you guys have enjoyed this video and learned lots the next video is going to be compositing which is going to be the last video in this series that video is going to be in a week's time which obviously will be after christmas so obviously despite everything that's going on in the world i hope everyone has a very lovely christmas and i hope you can spend some time with your family and everything this year enjoy the festive season and i'll see you very soon [Music] you