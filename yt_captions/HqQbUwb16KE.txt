this video is going to be going over how to do some cleanup in nuke using 2d and 3d techniques if you watch the 3d camera tracking tutorial you will already recognize this setup this is the shot that i did the camera track on for that example and in this video what we're going to be doing is removing these tracking markers from the back wall i'm going to cover a few different ways of doing this both in 2d and 3d because it's always really good to know a few different techniques that way if you have a specific situation where one doesn't work you can just pull something else out the back so let's start with the 2d one basically what we want to do is track all of these points and then what we can do is either paint them out and apply the tracking to the paintwork or we can do something like apply the tracking onto a transform and move some of these pixels on top of this tracking marker so let's take a look the first thing to do is to add a tracker node obviously plug this into the footage and then i'm going to hold ctrl and alt and click on one of the trackers to add a tracking marker a good tracking tip that lots of beginners don't know about is you can just track one channel and it can sometimes make it easier to find contrast so for example if i start pressing rg and b and cycle through the red green and blue channels you can see the blue channel has significantly more contrast between the pieces of tape that i put on the wall and the actual white of the wall and so in the tracker node in the settings if i turn off red and green we can just track the blue channel which will make the tracking more accurate so i'm going to go back to the tracker tab i'm going to make the tracker a bit smaller just because the tracking markers are pretty small in the shot and then you can either press the track forward button up here or press v on the keyboard which is the shortcut and it will start tracking i don't expect to have to do much manual tracking on this because i'm not moving the camera too much so i'm just going to watch it as it goes through and pray that i don't have to intervene at any point when it gets to the end we then go back to the start of the track i'm gonna press zed which is the shortcut for track backwards or you can press this button up here okay so that's finished now i can use this to apply it to some of the cleanup the first thing i could do is paint out the tracking marker so if i press p which is the shortcut for the roto-paint node plug this into my footage i can come over here to the clone tool and you hold down shift and click and drag to change the radius of the tool and then if you hold ctrl and drag it will show you the area you're cloning the pixels from so the gray one i can't actually i can't move my mouse over it because it moves with the mouse but the grey one here is where the pixels are being cloned from and the white one is where you're actually drawing so for example if i make this a bit bigger i often turn the opacity up here down to something like point one so it's a bit softer and then you can literally just paint over it like this and that gets rid of the tracking marker nicely if you turn the gamma down a bit in the viewport it helps with painting to see if it's actually as smooth as it looks so you can see there i actually cloned a bit that was probably a bit too light so if i undo that i can grab a bit that's more of a similar color like this that's probably still too dark actually let's try this bit there we go that's a pretty good match and then i can reset the gamma and that looks pretty good now with a rotopaint node if you go to the next frame the paintwork disappears so what you have to do is add a frame hold node which is basically like a freeze frame then what i would want to do is cut it out so i've just got a little circle for where the tracking marker is so if i disable the rotor paint node by hitting d i can see where it is then i'm going to press o to add a roto node and i'm going to draw a little shape around it so that i can cut it out then i'm going to add a merge node plug the b input into the frame hold and the a into the roto and then i'm going to set the operation in the merge node to mask which is going to cut it out and if i select the rotor node hit b to add a blur node and turn it up a bit we can feather the edge of that slightly and if i re-enable the roto-paint node you can see i now have this small patch that can go over where the tracking marker is then the next step from here would be to take the tracker node unplug it and then we're going to plug it in underneath the patch that we've made and then in the transform tab i'm going to set transform to match move and once that's done the patch will actually start to move with the tracker as you can see it's important to make sure that your reference frame is set to the same frame you did the painting on so for me it's one so it's actually right but let's say i did my painting on frame 19 i would want to make sure that my reference frame in the tracker is also set to 19. that just means the starting point from the track is the same as where you made the cleanup so now what i can do is merge this over my original footage so if i add a merge node and plug this in here and look at this you can see it doesn't look exactly how we were expecting and actually the reason for this is because this footage doesn't have an alpha but look at the alpha channel it's black this caught me out so many times when i was first learning nuke i never really realized why it was i was thinking why does it look kind of dark here then when i merge over it's really light and semi-transparent it's just because neither of these actually have an alpha so nuke doesn't really know how to combine them so the easiest way to do that is just to go into the reads node and turn on auto alpha here this will add an alpha channel to the read node as you can see it's now white and it also means that the patch will now have its own little alpha from the roto that we drew and when you merge them together it will know to use that little section of the alpha to go over the top of the footage and now as you can see they merge together perfectly and because it's tracked it should theoretically hold up for pretty much the entire shot but here lies the problem with using a freeze frame if i go later in the shot like here you can see that we actually start to be able to see the patch that's because the lighting conditions have changed a bit and this is frame held on one frame so it's basically freezing the lighting conditions in this position so later on if the lighting changes it's gonna cause problems you could add a grade node and animate this to get brighter and darker but that's a bit of a faff there is a much easier way to do this and it's essentially to just take the pixels next to it and transform them over the top for every frame there's a node that does this all in one in nuke it's called the transform mask node i'm just going to delete all of this stuff because this isn't actually useful anymore i'm going to take the transform mask node plug it in here then what we want to do is add a roto node and just draw a shape for the tracking marker again then i'm going to take the triangle on the side of the transform mask which is the mask input and plug it into the roto and then in the settings inside the transform mask node if i start to turn this down you can see it's going to shift those pixels over in the x axis there's also a little transform widget thing that you can use here to do it with your mouse and again if i add a blur node under the roto and turn up the feathering a bit this disappears nicely but if i move around now you can see that this doesn't stick on it only applies in that frame at the moment on 189 so what we have to do is apply the tracking onto the roto it's really easy to do that just plug the tracker in under the blur and this is what i was saying about having the reference frame being the same at the moment this reference frame is still set to the first frame but i drew this roto on frame 189 so actually what i want to do is go into the tracker go to the transform tab and set my reference frame to the current frame which is 189 and again now if i scrub through you can see the tracking marker disappears throughout the entire shot but the difference between this and the first one is for every frame it's taking the pixels next to it and moving it over so even when the lighting conditions change it's still taking the pixels from next to it on that frame so it stays consistent throughout the entire shot this is usually my favorite method for getting rid of tracking markers in 2d it also means you don't have to worry about the grain because the grain is preserved by doing this as well after this it would just be rinse and repeat so i would track all of them and do the same thing the next method i'm going to show is using the 3d camera track which i did in the previous video the beauty of doing it in 3d is you only have to do one track so you track the camera once and then you can project that clean up onto some geometry and it will just stick in the shot which is really cool so how do we do this the first thing i'm going to do is take the card i created in the last video i'm going to duplicate it which you can do by pressing alt c that's a shortcut to duplicate nodes and i'm going to plug this into the checkerboard as well then what i'm going to do is add something called a scene node a c node basically works as like a folder so you can plug in lots of geometry to it and then look at the node and it will show you all of the geometry at once whereas at the moment i can't view these two together i just have to look at them individually so if i plug in both of these cards into the scene node and then look at it you can see they both show up and then basically what i want to do is rotate the second card 90 degrees so that it lines up with this back wall so to do that i'm going to hit tab while my mouse is over the viewer to go into the 3d viewport i'm going to click on the second card node and if i hold down control it will give you this rotation widget which i can then use to spin it around like this then i can just push it back in z space until it lines up with the back of the first card i should probably have mentioned that to move around in the 3d viewport you use the middle mouse button and then click and drag to move around you can hold ctrl and then just click and drag which will allow you to rotate around and then you just use the mouse wheel to zoom in and out so once that card is lined up i'm going to take the object input from the scan line render and plug it into the second card instead i'm going to get rid of the first one now i don't really need it and then i can just shift this card over until it's overlaying on the tracking markers then the next thing i'm going to do is add a row to paint node again the shortcut for that is p plug the rotor paint node into the footage then again i'm going to use the clone tool gonna drop the opacity down to about point one and just paint out all of these tracking markers when there's light gradients like this where it goes from light to dark painting is usually quite difficult to get the gradient exactly right what you can do is use the blur brush a little bit to just blur it because we're going to be reapplying grain onto this afterwards it doesn't really matter so much that we're smudging the texture because the grain will bring back some of that crispness and that looks pretty good then i'm going to frame hold this so that the painting doesn't disappear after one frame and now what i want to do is add a project 3d node the project 3d node basically takes the 2d input and projects it through the camera's view onto the geometry so if i take this input and plug it into the footage that i've just painted and then i take the input for the camera and plug this into the camera then i want to take the card that we made in 3d space and plug this underneath the project 3d node and then the object slash scene input for the scan line render goes back into the geometry so the cardigan and if i just make a bit more space for this it should look something like this the only problem now is the cleanup is done on frame 255 so we want it to always be projected on frame 255 so what we actually want to do is freeze the projection camera on that frame so it's basically like deleting all the other keyframes the camera will just hold still and always project it from that position and i can show that by looking at this in 3d if you imagine the camera is literally a projector as you can see when it's moving the picture is moving as well what we really want to do is have a version of the camera that doesn't move that stays projecting this in the same place for the entire time in 3d space and then a second camera will come along and film it while it's frozen in 3d space so to do that what we can do is disconnect the frame hold node by pressing ctrl shift x and just plug it in underneath the project 3d instead and if you follow the flow of the node graph basically what we can see is happening now is the cleanup is being frame held and also the projection camera is being frame held because the frame hold is underneath these two nodes but then the scan line render is actually going straight to the camera so it's bypassing the frame hold and this means when it gets round to rendering it from the camera's perspective it's actually using the moving camera so now if i look at the merge node we should see this is pretty much sticking to the wall you can see the edge of the projection kind of here obviously this isn't ideal but what we're really looking for is that the wall is sticking in the right place and the tracking markers are being covered throughout the entire shot which they are so now just like the 2d version we basically just want to draw some masks over the areas of the tracking markers so we can cut them out so i'm going to go back to frame 225 i'm going to turn off the rotor paint node for now by pressing d and then i'm going to add another roto node and just draw some shapes around the bits of the tracking markers then just like last time i'm going to add a merge node plug this in underneath the cleanup then the a input goes into the roto and we set the merge operation to mask add another blurred node which will soften the edges of the patches slightly and then if i turn the rotor paint node back on the tracking markers disappear and we're left just with the patches of the cleanup then this gets run through the whole setup so it goes through the project 3d and the frame hold that's get put on the geometry and then if we look at the eventual output from the scan line render you can see we have the patches of the tracking markers moving in 3d space and when they get merged on top of the footage you can see the tracking markers have magically disappeared throughout the entire shot and if i toggle that on and off you can see them disappearing now again like i mentioned in the 2d one because this is frozen on one frame the grain currently isn't moving on those patches so what you would want to do is go back in and add some grain onto these patches so they match better with the rest of the footage there's a node for matching grain in nuke that's really good called f underscore regrain you plug the source into the cleanup so this is going to go into the scanline render and then there's a second input for grain and this is for sampling the grain from the original footage you just want to do this on one frame so i'm going to add a frame hold node and plug this into the footage it doesn't matter what frame is on and then i'm going to take the grain input from the f3 grain plug it into the frame hold and then if i click on the regrain node it gives me this box which is for sampling the grain you want to move this over an area that's fairly flat in color and has some grain in it obviously usually areas of the frame that are quite dark are quite good because they tend to have more grain on them obviously i'm going to go for this corner down here because it's fairly dark and a uniform color and now we look at the regrain node you should be able to see that it's applying some grain onto the patches so then if i take the a input and move it from the scan line render to the regrain node this should now be working there's a few controls in the regrain node for the size and amount of the grain i usually turn the amount down to about 0.7 or 0.8 usually one is a little bit too much but obviously do it based on how it looks in the shot for you and there we go those are a few really common techniques for doing 2d and 3d cleanup in nuke hopefully this video has been helpful make sure you check out all the other videos in this playlist thanks for watching and i'll see you next time [Music] you