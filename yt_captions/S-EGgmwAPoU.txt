welcome back to part two of the basics of cg compositing in nuke in the last video we pulled in the render and got all the basics set up and in this video we're gonna dive a bit more in depth into some compositing tips and tricks this is where we left everything last time we have our shadow set up here and then we have our car with a couple of bits of grading and the zd focus on it in the last video we started doing a bit of color grading and stuff to the car paint here there's a couple of other bits of the render that i think could use a bit of love color wise firstly i think all of the carbon fiber looks a bit bright and lifted so i'm just going to crunch that down ever so slightly to do that i'm going to add another cryptomat node i'm going to change it back to crypto material and i'm going to select the carbon fiber by control click and dragging on the carbon fiber sections i'm going to make a bit more space for myself here so i have some room to work press g to add a grade node and plug it into the main stream and then use the mask input plug that into the cryptomat node we just created and then i think i'll just pull the gamma down ever so slightly and that should look a bit better i think yeah there we go so before after it was all just looking a bit lifted before the next thing i'm going to show is quite a good trick for cg you definitely don't want to do this on everything but one of the criticisms of a lot of cg cars and cg objects in general for that matter is they're always way too clean in blender i did actually hand paint some stuff with some stencils on the body to create some water run marks and some bits where the dirt builds up around the edges of the doors but even so all of this area and stuff looks a little bit too clean so if you're finding that with your cg renders there's a really cool thing you can do with a channel in the utility render that will allow you to add some grime and dirt and stuff onto your model the path we're going to use is called the uv pass and it looks like this this part basically tells nuke how all of the faces were unwrapped in the 3d program and allows you to apply uvs to them in 2d to use this we're going to have to shuffle it out first so add a shuffle node plug it into your utility render and we're gonna set the input layer to be the uv pass click and drag these six dots here and drag it across to connect them to the output layer and i usually just turn on the alpha as well by clicking this white dot here so now if we look at this you can see we have our uv shuffled out the next thing i'm going to do is create a texture to put on top in this example i'm just going to use a noise texture but what you can do is get textures like this from somewhere like textures.com that are streaks or mud textures or whatever you want to do and you can use them to apply to the whole model but like i said for this example let's just use a noise texture so i'm going to make this a bit smaller by turning down the size then the way we apply this onto the 3d model is to search for an st map node this node will use the uv data from this pass and it will tell nuke how to wrap the noise texture around our 3d model so take the st map input and plug it into the shuffle node with our uvs and then take the source input and plug it into the noise texture now we look at this currently it's going a bit nuts but we have to set the uv channels in the node to rgb which is what our uvs are currently shuffled into here if we look at this now you can see it's applying that noise texture across our entire 3d model of the car changing the scale will change how it's displayed on the car and you can also do things like adding a grade node and crunching it up and crunching it down to change how much the areas are black and white what i'm going to do is combine this with a mask from the body paint kryptomat and i'm going to apply this noise texture just onto the car paint to do that add a merge node by pressing m connect the b input to the st map node the a input to the body paint cryptomat and look at that and then i'm going to set the operation to mask and that's going to use this alpha from the kryptomat to just cut out that section of the body paint then what i'm going to do is multiply this on top of the car realistically i don't want to do this on top of the highlights i want to do it just on the color kind of like we did how when we were changing the color of the car in the last video so i'm going to do it after we've taken off the highlights and before we put them back on so to do that press m again to add another merge node plug it in just before you add the highlights back on top and then connect the a input over here to our noise texture i'm going to hold ctrl click and drag to make it a bit neater that's what it looks like currently and then i'm going to change the merge operation to multiply currently it's going over the headlights and everything as well so take the mask input on the merge node and just plug it into the crypto map for the body paint and that will only make it go on top of the car paint now if i turn this on and off you can see we're applying this really nice grunge texture over all of the car paint which really helps to break it up and make it look a bit less cg it's obviously way too strong at the moment so you can use the mix slider in the merge node to turn it right down and just sort of fine tweak it until you get it to a point where you like it that looks pretty good to me just adding a bit of variation into that red maybe a tiny bit more something like that and then the highlights and stuff go back on top after that and this is what it looks like now on top of our footage so before grunge texture after now is probably quite a good time to go back and tweak the shadow to get it looking a bit nicer one of the tricky things with cg shadows is getting a nice mix between the kind of general shadow and some really harsh contact shadows where things are actually touching the floor this shadow doesn't look too bad but under the tyres it should be much darker where when they're really close to the floor they're basically blocking all of the light so there shouldn't be so much bounce light around these areas to do that i'm just going to draw some masks myself to create some extra contact shadows to do that press o to add a roto node and then i'm going to come in here and just draw some very simple shapes with the rota node selected press b to add a bit of a blur onto it if i look at this and look at the alpha channel by pressing a i can turn up the blur a little bit and then i'm going to add a grade node by pressing g plug this in just before the shadow connect this to the blur and just turn the gain down a bit so that we get those contact shadows now have a look at that you can see that's pretty good just going to make it a bit less mental something like that then i just want to blend into the rest of the shadow a bit better as well so with the shape selected you can hold ctrl and click and drag individual points to kind of feather it more manually like this and this should just help to blend it into the rest of the shadow quite nicely so that's before that's after you can see that there's some nice occlusion going on by the wheels now i also think the very underneath of the car here should be darker so what i'm going to do is use the shadow part again but erode it down so it's much closer to the center and grade the very underneath of the car down more to do that i'm going to add an erode node that rhymes plug this in after the lens distortion setup and then look at the alpha i'm going to set the channels up here to be rgba i'm going to crank this up slightly and start to erode the shadow down inwards like this so now our alpha is much more closed down before and after i'm going to add another grade note by pressing g add it after all the other shadows connect it to the erode look at this and come out to the alpha mode and then just grade this down a bit it'll probably help if i looked at it with the car on top so i can gauge how much it needs to go something like that looks pretty good i think i'm going to erode it even more like that and then also blur it a bit so press b to add a blur and then i'm just going to crank this up a bit and then it's just a case of going back and forth and getting it looking nice if i turn that on and off you can see that looks a lot more realistic because under the car shouldn't have so much bounce light and i think now we've added all of those extra shadows the original shadow can probably get a bit lighter so it's a bit less aggressive and then darken this one down more i think the original one is also a bit too sharp for the lighting conditions so i'm going to put a bit of a blur on this one as well so hit b connect this in between the original shadow and the color correct and then just crank this up a bit then let's go a little bit darker and then make the underneath one much darker as well about there okay there we go that's the shadows we've done it in three different bits but that really helps from originally what it was like this the shadow now looks a lot more realistic that's pretty much all the comp stuff in terms of bedding it into the shot now we can add a couple of last minute bits just to make it look nicer the first one i'm going to do is put a bit of a glow on the headlights normally with a render like this you would have an emission pass for the headlights but because they're behind the glass there isn't actually anything in the emission channel i show you it looks like this so annoyingly we can't separate the headlights out that easily but because they're so bright we can just do a quick loom and it's key to isolate them so to do that i'm going to add a keyer node and just plug it into the bottom of the cg render and if i look at this and then look at the alpha channel i'm just going to crunch this down until we're just isolating the very brightest bits of the headlights about there then i want to do a garbage match just to get rid of all the other reflections to do that hit o to add a roto node and i'm just going to draw a couple of shapes around the headlights like this and then hit m to add a merge node and connect those two up and set the operation to mask and now you can see we have just the headlights isolated if i look back at the rgba channel i'm going to add a premolt node to cut these out and now we have them on their own there's a glow node in nuke that we can use i usually use a third-party node that's a bit better but because this is a beginner's tutorial we're not going to dive into that so i'm going to do two levels of glow i'm gonna turn the size right down on the first one make it nice and small very close to the source then i'm gonna add a second one and make it much much bigger and turn the mix down so probably something like that turn the mix down and then let's maybe even do one more so i'm gonna press ctrl c and then ctrl v to paste it underneath turn the size up even more turn the mix down and that looks pretty nice so now we have quite a nice falloff there i'm also going to add a grade node and just put some blue into the gamma to make them pop a bit more as the headlights then i'm going to put this back on top of the car so add a merge node connect it up to the car render and i'm going to set the merge operation to screen and as you can see that just gives the headlights a bit of a bloom effect and then finally we're going to create some streaky flares just going horizontally across the screen we're going to do that with a few different levels of blur so i'm going to add a blur node first of all connect it to the pre-mult and then just neaten this up a bit by holding ctrl clicking and dragging to make a dot we're going to make a few of these so we need a good point to plug it into in the blur node you can press this 2 next to the size slider and that will separate it into width and height individually we're only really going to blur horizontally so i'm going to set the width to something like 5 to start off with then i'm going to duplicate it by control c and control v in it look at the new one set it to something a bit higher like 10 maybe even higher let's go 20. you can kind of get the idea of this we're going to keep doing this and setting it to higher numbers each time so let's go 40 and then another one let's go for something much higher like 100 make a bit more space and then let's go for one more 250. so now we have all of these streaks what we can do is select them all press m that creates a merge node underneath with all of them connected i'm going to set this to plus i'm going to grab the grade note that i put on here and just put the same sort of blue onto these streaks so you can see if i just turn that on and off they go nice and blue and then the same thing again so i'm going to add another merge node connect the b into the background the a into the streaks if i look at this set it to screen obviously that's pretty mental but you can turn the mix slider right down even on a really low setting on the mix slider it's still way too bright so i'm going to turn the gain down in the actual grade node a bit just to compensate for it and then turn the mix slider up slightly i turn that on and off you can see that's adding some nice flarey streaks onto the headlights and there we go that's the composited shot there's lots more you can do to this to make it better better and it would also benefit from probably a slightly better model this is just one that i found online for free and i textured it quite quickly before i made this video so that's a look into the basics of cg compositing in nuke like i said if you want to get hold of these project files they're on my patreon for a dollar you can get the blender file with the car if you want to change it or put it in your own footage and you can also get my copy of the nuke script if you want to download it and have a play thanks very much for watching consider liking and subscribing if you enjoyed and i'll see you next time [Music]