happy new year this is the final video in the iron man visual effects tutorial series that i've been doing over the last few weeks i've got some new toys over christmas i've got a new webcam this is a logitech c920 so hopefully you'll be able to see me in much better detail i also got a massive softbox umbrella light which is over there just off camera i'll put a photo up now so you can see what it looks like it's huge and it's really really bright and it makes everything look really nice i hope you all had a lovely christmas let's hope that 2021 is better than 2020. having said that though 2020 was a really good year for my youtube channel so thank you very much for all of the support last year it's been fantastic so today we're going to composite some of the renders that we've done in the last five videos let's go okay so this is the shot that i've chosen to do the comp example on for this video for me this shot in the film is one of the ones that always stood out to me as being very memorable i've got a couple of really cool tricks that i'd like to show in this video one of them is a very advanced compositing technique and another one is an object tracking technique which i'll touch on very briefly so this is the scene in blender obviously if i turn off the background image you can see all of this stuff is the cg so we've got the suit which is object track to my body and then the two arms come in and place the two separate pieces of the arms onto my arm so the object tracking technique is something i discovered when i watched a video by a guy called sean kennedy in his video he was talking about object tracking and how you can just use one track to link it to an empty and parent stuff to that in 3d space so for example here i chose to track my tattoo just because it's basically the perfect tracking marker and you just do one single track so i tracked it for the length of the shot and then what you do is you go to the solve tab and under geometry you press link empty to track then you go back to the 3d viewport this makes an empty which is placed randomly in 3d space it's locked to the camera's perspective so if you press g and try and move your mouse it can only go further away or closer to the camera so if i get it lined up with where all of my other stuff is in 3d space and scale it down a bit this empty will now move with my arm so it basically works as like a single point object track so because the arms are rigged with an ik system i added an object constraint onto that bone which is a child of and this is basically parenting it and for the target i set it to be empty and what this does is attaches the main ik bone on the arm that does all the movement to the empty so now when the empty moves the ik system will move with it it's a really simple way of doing the tracking and it works really well so anyway let's get out of blender because this is a compositing video theoretically now you should have rendered everything if you followed the lighting and rendering video which was the last one so this is the new script in its entirety as you can see not too many nodes not massively overwhelming we've got the cg over here this is the setup for the holdout that uses some of the 3d geometry here and then we've got some lens flares and glows and stuff coming from the arc reactor finally down here so we've got the original footage here and then we have the render of the suit and the utilities pass which has all the different cryptomats and stuff in it the first step is obviously to put the cg over the background so i'm just going to add a merge and do that that's what it looks like by default as you can see the suit doesn't line up with my body and that's because we rendered the cg with some overscan so i need to apply the lens distortion to this to get it to line up correctly the way to do this is add a reformat node set the resize type to none and turn on preserve bounding box which will give you the over scan and the suit will appear in the correct place on my body and then you have to apply the lens distortion which i can grab from my lens distortion setup over here paste it under the reformat node and then just invert it so it's distorting sort of undistorting then the next step is to start doing some grading and if i turn the gamma right up you can see the black points are a little bit funky on the suit the cg has a few areas that are much much darker than the background so one of the important things to do is to get that to match first of all i'm going to add an on premolt and then a premolt node lower down then i'm going to add a copy node and copy the alpha from the actual original render back in later on then all of our grade nodes are going to go in between these two nodes and then basically once all the grading is done it's going to make sure that the edges are the same as how it started so first things first i'm going to add a grade node and i'm going to crank up the black point until the cg has a similar black level to the rest of the footage something like that looks pretty good i'm looking at the dark levels in my wardrobe over here and some of the stuff on my coat and the bag and then just trying to get those levels to be kind of in the same place then i can reset the gamma so it looks normal i could also see when i crank the gamma up that the suit goes very sort of pinky purple it's obviously meant to be more of a harsh red so i think we need to take some of the pink out of that and make it a bit warmer maybe so to do that i'm going to use the kryptomats i'm going to add a cryptomat node i'm going to set it to material so i can isolate the red material on the suit and then with the color picker i can grab all of the sections that are red and then what i can do is add a color correct node or a grade node and use the mask input plug that into the cryptomat node which gives us the alpha and using that alpha means that my changes in the color correct will only affect the red areas of the suit so like i said if i gamma up the suit looks very pink so i'm probably going to try and make that a little bit less crazy take some blue out maybe make it a little bit more green and there we go you can see the difference there immediately the next thing i did is add a glow onto the arc reactor a fun way of doing this is you can just shuffle out the emission pulse so this will isolate just the parts of the material that were emissive and then i can add a glow onto this so i'm going to add an exponential glow i'm going to make it a pretty soft and subtle glow this is obviously a daytime scene so there wouldn't be like a massive blooming glow like if it was nighttime i'm going to add a grayed node onto this and just add a bit of blue into the gamma which will make the kind of darker areas of the glow a bit more blue just give it a little bit of color like that and then i'm going to plus this over the top of the suit ah yes it needs the lens distortion applied to it otherwise it's in the wrong place so what i can actually do instead of doing all the lens distortion again is just shuffle it out after all the lens distortion is applied and that will then take it from the bottom of the stream of the cg and then apply the effects on top so now as you can see that lines up nicely might turn the mix down a little bit just so it's not quite so strong and that's the before and after nice and subtle i also couldn't resist doing a slight anamorphic flare going sideways across here i'm working on a car commercial at work at the moment and one of the guys at work had a setup for the flares that was perfect for this so i borrowed it it basically just isolates the highlights and then it adds a load of different increments of horizontal blurring so as you can see each one gets slightly wider and then they'll get plus together and you end up with this really cool kind of horizontal flare you don't really have to go that advanced with it you can just do a few different blurs then what you can do is select all of them hit m which will make a merge node change the operation to plus and as you can see this makes a really cool kind of amalgamation of all of them then what i can do is grab the grade node from the glow put it on here so it's the same sort of color and then i can plus this over the top of the scene as well set this to plus and then we have the flare and then obviously i want to turn this right down so it's not quite so mental the highlights are a little bit strong so i'm going to add a blur onto this just to make them a little bit less defined something like that looks pretty good so in a nutshell if you spend a little bit more time doing the color correction and stuff that's how you get the cg into a good place now we can talk about that really cool advanced compositing technique that i discovered earlier there's a problem with the suit how it is at the moment you can see my arm is supposed to be going into the suit which means it should kind of come in here and then be cut off by the foreground bit of the suit whereas currently because this is just a 2d layer that's slapped on top of the footage of me even the bits of the suit that are meant to be behind me are currently appearing on top you can't do this in 2d because it's not a 3d model anymore it's just like a flat photo however recently i was watching a hugo's desk video about using geometry for masks in nuke in his example he was using some geometry to put a smoke element in between two different bits of the cg and then in my head a little light bulb went off and i thought hang on a second what if i can take that and project some of the roto in 3d space and then if i place it literally inside it will appear that my arm is kind of in front of this bit and behind this bit and so that's exactly what i did so if i go into 3d space you can see that this is the geo of the armor and then i have some cards that i placed inside the armor basically where my body is supposed to be so then if you run that through a scanline render in nuke and then apply the lens distortion onto it it gives you an alpha for the suit or basically an inverted alpha that works as a holdout so then for example i have my rotor of my body here and then i can use this alpha as a mask to say the roto can go where the white bits are and then use the black foreground elements of the cg to cut it off which looks something like this so then when this gets put over the top of the footage you can see that my arm is correctly placed in 3d space inside the suit in the last video i just drew masks for this manually and it was a bit of a tedious process this is much better because it actually does it in 3d space which looks more realistic so how do you actually do this first things first jump back into blender what you want to do when you're in the scene is go to file export and alembic an alembic is a really good 3d file format that can go between kind of all software it's quite universal and the important thing about alembics is they have animation data so unlike an obj that's just still alembics will actually have all of the movement of the rig and the piece of the geo will be moving when i bring it into nuke so what you want to do is go into your scene file i just saved it in my geometry folder and then importantly you need to make sure you tick flat and hierarchy and this means that it will correctly transfer all of the parenting so for example in blender where i have the child of constraints that make the bits of the armor follow the arm when i didn't take this originally when i bought it into nuke the piece of the iron man suit weren't actually connected to the robotic arms and then you just press export alembic and then you can jump back into nuke and search for read geo and then you can locate the geometry in your shot folder so shot five and then it will give you a list of all of the different elements in your shot all you have to do is click create all in one node and this will give you a node for the geometry which looks like this and it will also give you your camera which is really important as well i'm just going to steal all of the rotate so i'd have to do it again for this tutorial so let's just imagine that you've done all your roto as well so with the geometry what you want to do is put a fill matte shader on it the film mat is basically just a complete black shade that works like a holdout so search for film matte and plug the image input into the film matte shader as you can see it's turned black then what you want to do is place some cards in 3d space inside of the suit and for simplicity's sake i'm just going to borrow the one that i've already done so i've got three cards that are kind of placed in the arm for where the head goes whoops and uh where the other arm goes and plug all of these into a scene and then you also want to plug the geometry node into that with your scene geo so grab the output here for the fourth output and plug that into the read geo and then if you add a scan line render node plug the 3d input into the scene and then plug your camera input into your camera obviously now if i look at this through the scan line render this is how you get the alpha for the hold out it's important to remember that the blender renders are currently over scanned and undistorted so to get the holdout to match this also has to be the overscan resolution so if i add a reformat node i can set the output format to be the resolution of my undistorted renders which is 2001 by 1126 and then you plug the background from the scan line render into that and this will basically change the resolution of the scan line render to be the undistorted res and then from here applying the lens distortion is the same process as it is to the cg because they're the same size so we can grab the lens distortion setup from here copy and paste it under the scanline render and a good way to check that this works is just merging it over the cg to make sure it looks the same and as you can see they line up perfectly so now the scan line render is outputting this holdout alpha what you want to do is use this as a mask over the roto so this is the roto that i've done in 2d then if i add a merge node and plug the a input into the 3d holdout and set the operation to be mask this will now act like a holdout and cut out the 3d geo from the 2d roto as you can see there's a couple of little problems where some of the pixels are just coming through from hold out that's probably a little gap in the geometry in 3d so what i did i think is just added slight erode and then just crank it up until you get rid of those pixels and that will sort that problem out so then what you do with this is you merge this on top of the mainstream after the cg so we start off with just the footage then the cg goes on here and then you merge this new rotor on top of all of that which looks like this as you can see you get some pretty gross black edges from the holdout that's because there's no anti-aliasing coming through the scanline rendering nuke so just add a blur node onto the holdout and just turn it up a little bit and that kind of fixes that problem and then finally what you want to do is add some contact shadows from the suit the best way to do this is to do it completely in cg and have kind of a 3d model of you under the suit that will be a shadow catcher but to get the model to kind of perfectly line up with your body is quite a lot of work and i just didn't really fancy doing that so i faked the shadows in 2d just by doing a kind of rotor shape so this is the shadow setup over here and i turn these on you can see i've just drawn some masks for the different sections where the shadow should be and i just went through and animated the masks to move with the different pieces of the suit so for example here where the contact shadow is supposed to be coming from the arm i just kind of moved the roto shape with the arm and it looks pretty good so the way to do this is make some rotor shapes for all the different areas you want to be in shadow and then what you could do is just use a grade node and use the alpha from the roto to grade down the footage or what i like to do for shadows is make a separate version of the plate that is essentially in shadow and that looks something like this and what i've done here is i've turned the contrast right down and also turned the cane down and then what i do is use a key mix node which basically is the same as a merge but it works with a separate input for the alpha so you plug the b input into the original plates or in this case the roto the a input goes into the new shadow version that you've made and then you use the mask input as the roto which looks like this and what it's saying is wherever the roto shapes are turn those areas into the areas that are in shadow and then i use the original alpha of the rotor with the hold out on it as a mask which cuts it out and basically applies the shadows onto those areas but still has to hold out it's important to use this mask because we're putting this on top of the cg so you don't want the shadows to appear on top of the cg suit so make sure you're cutting out the holdout from the alpha for the shadows so after all that's done that should look something like this you can go into as much detail as you like with the cryptomats and go to town on like getting all the colors and stuff balanced and eventually it should look something like this i'm still working on this shot it's not fully compt yet i just got it up to a level where i could show you for the tutorial so there we go that's how you do the compositing i hope you guys have really enjoyed this six part series it was quite a lot of work but it seems to have had a really good response from everyone so i'm glad it's going down well next week i'm releasing the actual finished iron man video which i'm working on at the moment i've done about 75 of it now and i've finished all of the most complex cg shots it's so much better than the original one there's a lot of really cool kind of 3d camera move stuff that i've done this time that it's quite exciting so thank you very much for watching these tutorials i hope you guys have found them useful a lot of people asked for them so i'm really glad i could get it out there keep your eyes peeled next monday for the finished iron man video and then yeah i guess let's see where 2021 goes after that thanks for watching see you soon