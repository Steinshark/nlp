we've already covered signal, whatsapp, facebook private messages, these kind of things. peer-to-peer, sort of two-person communication, which hopefully is end to end. and it means that no one can get in on that conversation, impersonate us, read any messages, put in any messages themselves. even the server, and this is a really good thing. this doesn't work as well in group messages. and maybe people don't actually know this. last time we talked about end-to-end encryption in apps like signal, whatsapp, facebook messenger. signal implemented this by default, facebook messenger has a private conversations thing you can enable and you definitely should enable so don't use the default because they'll be reading your messages, but these things kind of start to break down when we're looking at groups, right? what's true in terms of cryptographic security, what's true between you and me is not the same as when we bring steve in. there were a lot of reasons for that. so let's imagine that we've got three people in a conversation, right or maybe just a couple of people so i'm here, this is mike we're actually using not alice and bob this time, they'll be glad to be having a bit of a break i mean i thought about using it just to keep the trend going but let's not. so this is sean and steve over here normally when we're talking about one of these applications i will have some kind of shared key with you we've got this double ratchet going on where we're sending messages back and forth keys are being updated so i will have a kind of encrypted communication channel with you now, of course this is going through a server, but i'm not drawing a server in this image there's a few interesting properties that this particular conversation has. the first is obviously it's it's secret, right? this is encryption. also, it has something called perfect forward secrecy which means that if someone cracks one of our keys they can't use that to go back and crack all the other messages previously to this because the keys are constantly updating and you can't go backwards it also has this kind of self-healing or post compromised security, which means that if you let's say someone cracks one of my keys if they sort of look away even for a second, we can have some more communication and that problem goes away essentially, to continually eavesdrop on our conversation, not only do you have to break one of our keys but you also have to see every single message from then on. if you miss one, you're out so the question i guess is if we want to do implement group conversations which is where i'm sending messages to both you and steve at the same time can we still do these things? and the answer is a little bit but not totally so, okay. so let's imagine now we've got a three-way conversation. now remember i have already got channels, but i've been perhaps talking to you beforehand and you and steve have been talking as well separately right, if it's the case that you're introduced to a group where you haven't been talking to them you will form a two-way conversation with that person immediately right as a way as a sort of prerequisite that's the way it's normally done well, i suppose the sort of naive way of doing this would this be: whenever i want to send a message to the group i send a message to both of you using our pairwise channels and then we have the benefits of the security of each of these channels i send that same message once encrypted using our keypairs and once encrypted using mine and steve's keypairs and then kind of up to you and steve to make sure these messages are in sync and if you then send a message, you're gonna send it this way. this is how our message works all right. this is not stupid, right the benefit you get is that each of the messages has the guaranteed security that we had with this sort of pairwise messaging: self-healing, perfect forward secrecy, this kind of stuff. the problem is the more people you add to this group. so maybe you're a member of some kind of school thing, 50 people in the group, you're sending 50 messages and if you're not sending a text message maybe you're sending a video suddenly the bandwidth becomes actually a bit of a problem this may not be an issue depending on the application but whatsapp, signal and others have decided that this is a bit of a problem, and this is not how they're going to do it. the next thing we could do is we could say well, why can't we use the same protocol to establish keys to get a group key? so you and me and steve all team up we do our diffie-hellman in some way and that gets us one shared group key that we can then use, right? so then i encrypt a message to you both with the one group key now, of course in practice i would just send the one message to the server and it would spread out so this will be called server-side fan-out. so a single message for me to the server the server knows it has to go to the group and it sends it out now there are ways to turn diffie-hellman into a kind of three- or four- or n-way diffie-hellman they're usually using trees where two of us will do it, exchange, and then someone will do an exchange with that and and so on all the way up to the top where that's everyone's key the problem is that this takes time. it involves all the parties so implementing this in a way where steve doesn't have to be online at the same time as me and at the same time as you, that's a problem and that's another of the things that we get from our pairwise messaging, this asynchronicity the other problem is that how often do we do this, right? if i create a group key with you and steve and we chat for two years using that same key maybe someone broke it one month in and has been reading all our messages for nearly two years huge problem, right? so there's no self healing really unless we recompute these keys regularly so how does actually work, right? it's kind of a compromise what we do is we use our pairwise channels to establish a key and then we use group keys kind of the big problem with this group key idea is that the diffie-hellman key exchange is complex and if people haven't got their phone switched on that's a huge problem one of the nice things would be if you and me could add steve to a group when his phone's turned off and then a month later he remembers, turns his phone on it gets all the previous messages that would be really good. the way we do this is something called sender keys. so i'm going to write sender keys here a bit like our sending and receiving chains in a normal protocol, each person comes up with a sending key, right? this is iterated for every message. so we have this perfect forward secrecy so, how do i give this to you? well, i use the two-way communication we already have so i have a sender key for me. you have a sender key for sean. this is not going to work and this is - yeah, i've not thought this through - this is a sender key for steve i mean, this is a shambles and now i was only one letter, okay? uh, anyway so at the very beginning we'd established a group so i send you a message which says this is my sender key for this group i send steve a message. it says this is my sender key for this group you will do the same. it's a few initial messages, but it doesn't have to happen online i can send the messages and you can pick it up later. so that might sit on the server waiting for you just like a normal whatsapp message the server can't read it because it's protected using our end-to-end encryption from then on, when either i send a message i send it encrypted using my sender key and then i ratchet my sender key one tick if you are sending to someone you perhaps haven't had that before someone said hey add this person to the group because they've joined the school or something in your previous season then presumably that then starts to use the stubs that we had in the previous thing? no, so what will happen: yes, you mean the three keys? yes, so what will happen is let's imagine, that we add a fourth person to the group dave. does dave use whatsapp? he does now, so dave turns up. i've never spoken to dave before on a mobile phone, right? so i will then perform a quick triple diffie-hellman handshake with dave using the standard pairwise protocol we have and then i'll use that to distribute my sender key for this group and have a good thing is everyone can do this asynchronously there's an initial burst of messages you have to send which kind of increases linearly with the the amount of people you have 20 people means 20 sender keys i have to send out but the server will handle most of that workload for me everyone will know what key i'm going to be using because they just keep their receiving chains in sync with my sending chain but the disadvantage, and this is the key problem with group messaging like this is that we've lost our self-healing property because these sender keys don't change they just ratchet along. we can't go back and find out a previous one but if anyone gets my key they can then intercept any message i ever send into this group and they can impersonate me by encrypting a message with that same key and there's no way of detecting this now no one mentioned this in group conversation, but this is true of most group protocols at the moment it's not an absolute disaster because you know breaking these keys is not easy but essentially if we have a pairwise conversation and we invite steve, what we've done is we've decreased security on our communication without realizing it we've gone from a double ratchet to a single ratchet. is that right? pretty much? yeah, right so we've lost our diffie-hellman on the top that keeps things sort of self-healing, right, this post-compromise security there are papers out there now that have solutions to this that maybe will be implemented they'll be obviously have to be verified that they you know, they work and stuff that people will eventually solve this problem but at the moment it is not solved there's another problem: who's in this conversation, right? and do we trust everyone in this conversation? remember that we looked at our safety numbers this was essentially your identity combined with my identity in a sort of hash form and if we have both have the same, we know we're the only two in this conversation as an aside for people who get interested i've gone through two different phones since then and so therefore you've no idea who yeah we haven't verified our public numbers this since you changed your phone. i'm kind of taking it on trust and i'm a bit skeptical so this is all this is all very nice for two person conversation, but for a multiple person conversation there isn't really a mechanism for doing this, right? you have to you could kind of go and verify all of your individual safety numbers of each pair, right? that would help it's a lot of work, especially if someone you don't know gets added to the group maybe you're not in contact with that person sort of physically this is another drawback and actually there was an essay produced by someone from gchq recently that suggested have a quite a nice way for the government to get access to some of these conversations for crime purposes would be just to be added as - as a silent party to this conversation right? maybe the app could just whenever you create a group of three people it's actually a group of four people where one of them is the government i'll leave it to the comments to decide what they think of this other video: now i've got the token so i can load a value in, add the register into it and store it back and hand the token and now i've got the token again i can load something into it into my register add something onto it so it back and pass the token on and i've got it so i can load the value in add the value from a register story back