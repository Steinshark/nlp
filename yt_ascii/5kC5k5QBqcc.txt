if you imagine the scenario that you are in an office with lots of people who you quite like, but not enough to spend time and money on getting them an individual gift, a secret santa is the perfect way around that. because what you do, everybody puts their names into a hat, everyone picks a single name out of a hat, and you buy one crappy present for just one person in the office, then everyone gets to walk away with a crappy present. the important thing, though, about secret santa, is kind of clue's in the name. it is supposed to be secret. nobody is supposed to know who bought anybody else's present, apart from the one that you buy. everything is completely anonymous. that's sort of a fundamental rule of, of the secret santa agreement. i guess it's so you can get away with buying basically junk for other people. i mean they're always crummy, they're always crummy, aren't they? because people don't really know you. so it's always like, bath bubbles! hooray! or, like, i don't know, a book on numbers. brady: "what about?! you churn out books on numbers!" i know. i know that's true. but, yeah, like an encyclopedia of numbers, you know? brady: "right, because you're the math person." yeah, exactly, exactly. or like, you know, there's a, there's a guy who's a geographer here, and every single time he always gets something with a map on it. just a generic bland map. because obviously he must love maps. i think there are two fundamental things that you need for a perfect secret secret santa: 1) total anonymity, and 2) everyone should have an equal probability of being selected by anybody else, right? those are kind of two fundamental things. now the normal way that you do this, of everybody writing their name down putting in a big bowl and picking a name of a hat, fails on both of those fronts. okay, so imagine you've got everybody who's involved in your secret santa sitting around a table. everybody writes their own name onto a piece of paper and drops it into a bowl in the middle. and then that bowl is passed around the table and people pick out names of who they're gonna buy the gift for. if they pull out their own name, though, they read it and replace it back in the bowl, and then pick another name. by doing that, you have to sort of consider the situation where the last person around the table picks out their own name. now if they do that, what, how do you solve it without violating the rule of anonymity? because they can't swap it with anyone else, because by doing so, they would know exactly who is buying them a present. so, the only real fair thing to do in that situation is to scrap whole thing, start all over again. there's quite a good chance of that happening. so, if you have twenty people sitting around your table, there's a 4% chance that the last person will pull their own name, and you have to scrap it, and completely start all over again. if the second to last person pulls their name, if the third to last person pulls their name, you know, all sorts of anonymity issues can be violated. the chance of anybody pulling anybody else's name is not uniform. it depends on where you're sitting around that table. because what you're looking for in this scenario, you are looking for something called a derangement. so it's a type of permutation where nobody ends up with their own name, effectively. okay, so imagine you've just got three people playing. you've got a, b and c. now even though there are six ways that this can be reordered, there are only two extra permutations here that could work for secret santa. two derangements, they're called. so there are other permutations, of course. but the problem is, is that any of these three, in every case, somebody, if they're sitting around table in a, b and c, somebody will end up with their own name. so this column here is kind of who that person is pulling out. so if a is the first person on the table, they're going to pick their own name in this permutation, b will pick their own name in this permutation, and c will pick their own name in that permutation. so none of those are allowed. none of those are allowable secret santas. the question is, how likely is it that each of the people end up buying for a particular person? and it turns out that the order that you're sitting around the table makes a difference to that. a picks first, then b goes second, and c goes third. so, if we think about the bowl of names for a, we know that if a picks out their own name, he's going to replace it. or she. they replace it back in the bowl. so really there's only two things that, that a can, can pick out from that bowl, and then secret santa carry on. so that's either b or c. and there's a probability of a half in each case. brady: "because if they pick a it's a non-game." exactly. they read their own name, put it back in the bowl, and then pick again. okay, so if a ends up picking out b, now it's b's go. so b's already out of the pile. so there's only two names left, and either one that b can pick is totally fine. they're either going to pick a or c. and each of those has probability of a half. however, if a has picked b and b has picked a, there's only one name left for c to pick from, which is their own name. and that, my friend, is a fail. there's a failed secret santa. which means the only fair thing to do, if you want to preserve everyone's anonymity, is to start all over again from scratch, put your names back in the hat, and then start from the beginning. if, instead, b ends up picking c, then we're okay. there's only one name left in the hat, and that is a's name, and that's absolutely fine. and that's got a probability of happening of 1. so, that's if a ended up picking b in the first place. if a ends up picking c, you can still work this through, but there's less going on in this case. there's only two names left in the hat, it's b and a. b can't pick themselves. if they did, they'd read it, put it back, which means that b really only has one name that they can pick out, and the secret santa continue, which has to be a. and that's gonna happen probability of 1. which means now, once you get to c, there's only one name in the hat, and it's b's name. which also happens with probability of 1. okay, so, now you've got these, there's one failure, one absolutely fine derangement that works for secret santa, here, and another one here, but you can work out the probabilities of each of these happening, if you kind of travel down these arms of the tree. this permutation here of c-a-b which we have up here, this one here, this one is gonna happen with the probability of a half, because it's a half times 1 times 1. this one here, this, this other successful arm of b-c-a, is gonna happen with the probability of a half times a half, which is a quarter. and then the other branch of this, if you like, is a failure. so you're also gonna fail with the probability of a quarter. which means that a is much more likely to end up buying for c than they are for b. so even though they're, they're just as likely to pull out the second person's name as they are the third person's name, if they pull out the second person's name, half of the time, the whole thing will then fail, so they'll have to start over from scratch. so what you end up with in this situation is not only the chance of failure, and having to start it all over again, but you also end up with a situation which isn't perfectly random. you don't have an equal chance of buying for other people in the office. brady: "so if i'm sitting in a row of three, and i'm the last picker, i know it's most likely that the first picker is buying me a present." yeah, it's twice as likely that the first picker's buying you a present than the second picker. which might help you when you try and decide where to sit around the table, because, yeah, you don't want, like, some person who's rubbish at presents to be buying for you. so the exact probabilities change depending on how many people you have, but the, the overall idea is the same. that the probability of you buying for a person later on if you go first is different to the probability of you buying for somebody earlier on the tree. um, so overall, i mean, i think this version of secret santa is pretty rubbish, really. it's got two massive problems with it. so what you could do if you wanted, you wait until everyone's got a name, everyone's picked a name out of the hat, and that's when you look at it, and that's when you decide if, if somebody's got their own name. you call a failure, and you start all over again. unfortunately that one's got a 37 percent chance of failing, and a 5 percent chance of failing more than three times in a row, by which time i think people are gonna be less keen to buy each other presents, and maybe just want to call it a day. however, we've got a solution. we've got a secret santa system that does actually work. okay, what you do now if you want the perfect secret santa setup, you create a series of cards. the cards are kind of split in two. and at the top of the card, you write: you are number 4, and on the bottom of card, you write: you are buying for number 4. so whatever the number is on top, the same number is on bottom. so you do lots of cards, you do one for each person. so if you've got 20 people, you write 20 cards. if you've got, whatever, three people, you write three cards. you get all of these cards, you lay them on a table, shuffle them all around, so you have no idea what order they're in, and then, when you're happy that they're neatly shuffled, you go along with a pair of scissors and cut the cards in two. so now you have no idea what cards are next to each other, and you're kind of cutting along the line. and these scissors that everyone draws in school? how do they do them? like that? they go? that's my scissors. it's not great. you go along and you cut them all up. now at that point, you can create your derangement. and you can do that just by shifting the top half of all of the cards along by one. by doing that, you're guaranteeing that the number on the top of the card isn't gonna match the number on the bottom of the card. so you've definitely got a derangement, definitely got a secret santa system that works. but, also, because you shuffled them, you have no idea what numbers are matching with what numbers. so the next step, everybody who's playing secret santa comes along, picks up a new whole card, so top and bottom half that are now matched up together. say you pick one up and it says you are number 3 and you're buying for number 27. then the final thing that happens is that you write a list of all of the numbers, put it on the wall of the office or whatever, everyone then comes along, they know what number they are, because the card that they picked up would have told them, and then they come along and then they write their name. everyone now knows their own number, they know the person they're buying for, but they have no idea who else is buying for anyone else in the secret santa system, and everyone has an equal chance of buying for everybody else. i mean there is a final way that you could do this, it's a bit simpler, which is just to go online and use one of the free apps. but, this is much nicer. brady: "it's fun, you gotta, there gotta be hats and tickets and pulling cards and things." yeah, i agree. let's do the traditional way, non-computer way. brady: "let me ask you this, mathematician hannah. have you ever done this?" nope. i'm famously stingy when it comes to buying christmas presents. i won't get involved. if you're in the market for some gifts, and hannah hasn't put you off the idea of a mathematics book, these are books that she's written. you could try them out. i'll put links in the description along with links to some numberphile merchandise you could try, like t-shirts and posters. and if you want to see more of hannah besides here on numberphile, why not check out her recent guest appearance on objectivity? links for that as well.