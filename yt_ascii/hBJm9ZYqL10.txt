i'm going to talk about the the post office try or sometimes called the post office scandal this was about the post office in the uk they obviously deal with selling stamps but they're also part of everyday life in the uk so they deal with driving licenses taxes they're a bank for many people they pay out pensions and so there's actually a lot of money flowing through these branches and it turned out that there were many people who were running these branches who were accused of stealing money or at least losing money sometimes tens of thousands of pounds some were prosecuted and a few even went to jail and it turned out that horizon the computer system that post office use does have a lot of bugs and these bugs could have been responsible for some of these losses and so the people who are running these branches called subpostmasters largely won that case now we never got to the bottom of exactly what happened to these individuals the court case was settled before that stage of the trial progressed but we do know the sorts of problems that affected horizon and the sort of challenges that there are in building a system of this type this was a huge news story in the uk i listened to a great podcast which i'll probably link in the description from the bbc explaining a little bit about some of these people and what happened to them but they didn't really explain what sorts of things went wrong this money's gone missing you know you're going to jail because you've lost this money where was this money did the money exist yeah so what horizon is as an accounting system and if you could imagine how you might build something like this let's suppose you take a simple case where you have a shop and they just have a bucket which they use for keeping the money and then a bucket which they use for looking after their products we can call these stamps because it's a post office each time someone takes in some money they put the money in the bucket and then they give out some of these stamps or whatever they're trying to sell that works like this is how you might run a lemonade stall or something like that it's okay but it's got a number of problems so one is that you don't actually know how much money you've got and also you don't know how much stock you've got so you might want to do something better than that now let's build in some raker keeping so if you're running a more sophisticated limb needs stand you might do this here you have a table and then in this table you put in your sales and you might say oh one pound worth of stamps and then you might sell six pounds worth of stamps and at the end of the day you add this up and then you found out that you have earned seven pounds for that day so again that's good but what this doesn't tell you is the amount of stock you have so what you might then do is add another column to this and if you start the day with 100 stamps then you sell one pound worth of stamps and if each stamp is worth one pound now you've got 99 pounds and then you sell six pounds worth of stamps now you go from 99 down to 93 and then at the end of the day you've got 93 stamps and then once that starts getting close to zero then you can start saying okay maybe it's time to buy some more there's still some problems here one is the people who are running these desks in the post office are sometimes not employees of the the post office and maybe you want to see that they're not making mistakes so you can actually build two books so you've still got your sale and still your your stock but then you've got a separate book which is the the stock at the the central office this could start off with zero and then you give out 100 stamps so this is now down 100 and that is up 100 and then at the end of the day maybe the person who's running this decides that they don't want to keep all those stamps they're going to keep three of them so they're going to hand back 90 so then this goes down to 3 and this goes down to plus 90 and then the total of this is going to be minus 10. we now get this a nice property that if we add up all the totals seven pounds worth of stamps three left in the stock and we've got minus 10 over here that equals zero and the fact it should always equal zero if you do this thing called double injury accounting and that's the check that is used but what happened in these subpostmaster cases is it didn't add up to zero it added up to less than zero and the way the contract was set up between the post office headquarters and the individual post offices was that the people running the post offices were responsible for this amount of money so it looked like money disappeared and the post office accused them of putting this in their back pocket and then they had to pay this back in some cases sometimes they went to jail sometimes both you see how this could go wrong quite quickly in quite a huge way and be very difficult to work out where it went yeah it's millions of transactionality computers don't make mistakes though right isn't that the isn't that the thing yeah so that's roughly what the post office said that this is a simple problem it's easy for computers to to do the right thing it's just adding and subtracting and the numbers are not very hard really if you look at other videos in computer file there's far more sophisticated problems and computers seem to do reasonably well at that but there's a few challenges i mentioned that the numbers should always add up to zero and the reason they always add up to zero is for every positive number you add into the system there's a negative number that you're taking away and these two things have got to happen always but if for example the computer fails when it's doing half of that transaction then you get a shortfall and this is a known problem in computing and what you want is something called transactions and in a transaction either everything happens in a transaction so in addition and subtraction both happen or none of it happens and if it doesn't happen you you know about it and you can deal with it so sometimes the decrement acid comes up so this stands for atomicity so that means it can't be broken up so either all that happens or none of it happens and there's consistency and that is that the properties you want are always true so for example you want things to always add up to to zero you want everything to the same synchronization there's also isolation and this means that no matter what's happening in one part of the system it shouldn't cause failures in other parts of the system because these post offices are not just one computer sitting in a desk there's the computer there's the backup there might be several desks there's a post office headquarters computer and and all that and then durability is the the final part and that means that once something has happened you actually know what's happened has definitely happened so you don't need to then go back and check whether it has accidentally been undone by something else going on the system so this is what the post office system should have and it did have measures to try to do this but over the millions of transactions it's doing every day some of these things went wrong if we take an example of atomicity so what this means is that things happen exactly one time once and only once but sometimes things went wrong we had a case that was brought up in the trial where you had two desks and these have the computer system but they've also got a drawer full of money and for for whatever reason it's sometimes necessary to to move money between them because maybe one's paying out most of the time one's taking money in a lot of the time so that they get imbalanced and you want to move some money about so they move the money in between these two terminals but then the computer recorded one then something went wrong and then it duplicated so now the computer thinks there's twice as much money in this terminal than there should be and that triggers one of these imbalances so that's estimate the other one is consistency consistency means that everything matches so if something happens at one side something happens at the other side and again that went wrong horizon is one system but like most fake systems it's actually built out of lots of components so there's one component for actually running the disk that the subpostmasters and their staff interact with but there's other one for actually keeping track of the money it's a standard accounting package and horizon dealing with the counters should stay in sync with the accounting system but it turned out in one case it didn't so if a user was dealing with one system and then they press cancel at just the wrong time then that transaction would appear in horizon but would not appear in the accounting system so again you've got the case of you've got an inconsistency that can show up as a shortfall and then the subpostmaster can get blamed for that next one is is isolation that means that if something happens in one system it shouldn't interfere with something on the double system and again we saw the case of where that went wrong so here a subpostmaster was printing out a report showing how much money was taken in how much stock was used in one day and then if in the process of printing out this report another counter in this branch did a transaction that transaction would not appear in the report so again you'd have something happening to the stock something happening to the money but not showing up in the report and again you've got one of these fuel reserve consistency and then the final one is durability so that means that when something happens it's actually going to happen and there's no way of undoing it so again that's been seen to go wrong so here there was a customer who withdrew some money from their bank but you can do this in the post office and the transactions seem to go through fine a receipt was printed the customer got the cash but then the receipt printed out recovery failed so recovery is the thing that horizon does and many other systems do when something's gone wrong with one of these properties and they then want to correct the error but that didn't work for whatever reason maybe a hardware failure and then the transactions just disappeared so horizon showed that the money was never withdrawn from the bank but the customer walked away with the money and now you've got a shortfall in this case the subpostmaster was very tenacious the subpostmaster found out where this customer was maybe they knew each other and got them to check their bank statement and then it turned out that the money had left the customer's bank account it just never appeared in horizon and so the customer obviously didn't really want to give this money back from their perspective they'd taken out the money they'd receive the cash but there was a short fall at that branch and because of all the evidence the subpostmaster collected they were able to sort the situation out but maybe in different circumstances it wouldn't be as easy and they seem like such simple simple problems i mean what if if something is there must have been logs or something were there logs that horizon was keeping could the you know could they not check the logs as it were there are logs in the system and there's logs both in the subpostmasters domain so the their branch there's also logs in post office headquarters and actually makes things harder because now you've got a distributed system and distributed systems makes everything harder so imagine you've got your post office counter over here so this is inside the post office but actually there's going to be probably more than one terminal in these cases and these are connected up with a network and then you've got the post office headquarters over here and then they've got their computer system for most of horizon history this was before the internet was commonly used and so they were not permanently connected to each other over the internet they are now what happens is that each of these post office terminals is networked to each other and that's permanently connected but the connection to the headquarters only happens every so often and the way that they try to say synchronize is that they have logs each branch computer writes out a log entry and then what they try to do is then make sure that everything has exactly the same log so they'll copy them over so that entry will go there that entry will go over here and so by the end of this process they will all have the the same entries and that's a problem called consensus and that's actually quite hard to to solve even in a fairly theoretical way when you build this on real hardware with the connections that fail hardwares that fail then it becomes even more challenging and a pattern that seems to have come up in this court case is that problems tended to occur when there was some failure either communications failure or hardware failure so that might well have been a problem in the way that this consensus algorithm is working in making sure the logs on each of these terminals are synchronized so as well as doing the the customer facing things like printing receipts and helping the subpostmaster keep track of things the horizon system and associated infrastructure also keeps logs of modifications and some of those modifications are perfectly legitimate so you might be doing some transactions or you might be fixing problems but if there's the wrong sort of modification then you end up with a serious problem it could be this would be what someone does to to hide the fact that they're stealing some money so what the sort of thing you want from an audit log is you want to make sure that you know exactly when something has happened you want to know exactly what they did you want to know who they are you also want to make sure that not too many people have access to the system it should be server on a need to know basis and horizon does have that sort of thing and this is the evidence that actually was used to prosecute the subpostmasters who the post office was claiming and stolen some money what they said is that at this particular time someone using this terminal with this password made this transaction and that transaction was fraudulent and one of the things that the post office said in court and and also in parliament when they were questioned is that only the subpostmaster in the branch or only the branch computer can modify these logs and this was a very contentious point in the trial there were some fairly dramatic scenes about how this was discussed but it turned out there were actually quite a few problems with this log in terms of when sometimes the wrong time went into these load injuries so that could cause some confusion about when a person was actually in a branch if they are blamed for something there was also a question about what had happened because in some cases these logs were not actually correct and then there was who was actually doing it so another disclosure was that actually a lot of people working for the post office and their subcontractors had access to the system more than probably should have and so they in fact did have the ability to remotely modify the system and the the logs that they kept of when this would be happening and how this would be happening were not as good as you would hope and also it could make it appear that it was a subpostmaster who had done something when actually it was a either an automatic change or a manual change that was done by someone else so eventually the truth came out in this trial and this was yet another thing that made it dramatically more difficult for the post office to say that actually it was a subpostmaster's responsibility when there was a shortfall in a branch so this one goes all the way over to here this one goes over to here and so and so on remember this is going to be an iterative process and what we want to do is move these things around and there will be instructions about transferring this money back to the right person but actually that's all fake the money has not appeared in your account