this video is going to be focusing on 3d camera tracking in nuke let's go you probably recognize this piece of footage from the harry potter self-washing pots video that i uploaded recently and in this video i want to focus on lens distortion and then using the 3d camera tracker so whenever i'm about to start 3d camera tracking a shot i always try and remove the lens distortion if i can and the reason for that is that when you remove the lens distortion all of the straight edges in real life they actually have a bit of a curvature to them and that's because this was shot on a 24 millimeter lens so it's fairly wide angle and obviously the more wide angle the lens is the more lens distortion you'll have in your shot and you may or may not know this but in 3d when you have a camera there's no lens distortion at all everything is basically perfectly geometrical all the lines are completely straight because it's not simulating the light going through any glass or anything it's just rendering what it can see in the 3d software if you undistort the footage and remove all of the straight lines the footage essentially becomes the same as the cg environment where you have no lens distortion or curvature and generally this will help the tracker understand the geometry of the shot a little bit better so there's a few ways to do undistorting i've mentioned it a couple of times in my videos before if you haven't shot a lens grid which is probably quite unlikely for a lot of people watching this video what you can do is just draw some lines onto the shot where it should be straight nuke has recently added a new lens distortion node and i'm not quite as big of a fan of it so i actually prefer to use the old one so to call up one of the older nodes you can press x and then search for lens distortion like this you have to make sure it's case sensitive so the l and the d are capitals and then you press ok and it will add the old lens distortion node to start drawing the lines onto the footage go to the line analysis tab up here on the right and then turn on drawing on mode and now if you start to click on the footage you can see it's going to add these red x's and now what i want to do is go along some of the straight lines in the shot like the edge of the counter and the cupboards and click on them along the line and add all these points and this will tell the computer that this should be a straight line so if it has any lens distortion on it the image will warp slightly and it should make it a straight line when you finish drawing a line you then right click and that will turn all of those red crosses into a long yellow line then you can start drawing some more if while you're adding them you click in the wrong place and you need to move it slightly you can click and drag and it will move the x you can also just delete it if you click delete last point up here and that will get rid of the last one you added it also helps to do different frames in the footage so if i go near the beginning you can see these lines stay here and what i want to do is draw some new lines on a different section of the shot the best place to do this is around the edges obviously because that's where the lens distortion mostly occurs it doesn't have to go all the way through the frame either it can be any size so for example i could just do this a little bit on the cupboard it's good to get a mixture of horizontal and vertical lines as well so i do some of the ones going up then once you've got a fair few lines in the shot you can press analyze lines up here and as you might have noticed if i undo it and press it again it starts to warp the footage and now this footage is what's called undistorted because theoretically we've removed all the lens distortion so now we've done that it's time to do a camera track the good news is nuka's camera tracker is really really good really accurate and really easy to use it's got the perfect balance of not having to press too many buttons but you still get a really accurate result so it's my favorite camera tracker ever used so all you have to do is add a camera tracker node there's quite a lot of settings here the first three i don't really use very often the only one you might sometimes use is the mask function and that's if there's something moving in the frame so just to give you a very quick example let's say that these knives were actually a bush or a tree or a person or something in the shot that was moving and we don't want a camera tracking so it'll throw the track off if i hit o and add a roto node you can draw a very quick mask around this and you can tell the camera tracker to avoid this area and the way to do that is you grab the triangle on the side of the camera tracker node and plug this into the roto and this is the mask input for the camera tracker and then from the mast drop down you can select one of these which will tell it to either ignore or only work inside of the rotor that you've drawn but before we do that to actually see the points what i'm going to do is go to the settings tab and turn on preview features and as you can see now a load of crosses have appeared these are all the tracking points in the shot at the moment i tend to turn the number of features up to something like 500 that's just the number of tracking points so you can see that's made lots more now the more you add obviously the more accurate the track will be but obviously there's a trade-off between adding loads and it being really good and also taking ages to track because you've got 50 000 tracking points i usually find something about 500 to 1000 is pretty good so now like i was saying if i go back to the camera tracker tab and i set mask to be mask alpha you can see that the tracking points that were on the knives had just disappeared if i undo that and redo it so the camera tracker is now ignoring what's inside of this mask but obviously we're not going to use that for this because there's nothing moving so i'm just going to set this back to the default the next settings that really matter are these ones here so the first one is camera motion and the options are free camera which is by default you have linear motion rotation only and planar motion free camera basically means the camera is handheld and it's actually moving around in 3d space rotation only means it's on a tripod head and the camera's not actually moving around in 3d space but it's looking around linear motion i think is something like a slider and i'm not even sure what plane our motion is but 99 the time if you're doing a camera track then that probably means it's a free camera so just leave it on the default next up we have lens distortion the default is no lens distortion which is what we want because we've already used a lens distortion node to remove the distortion you can also set it to unknown lens which means you couldn't calculate the lens distortion and the camera tracker node will do its best to do it for you automatically the next setting is the focal length it defaults to unknown constant which means we don't really know what the lens is at the moment however i know that i shot this on a 24 millimeter lens so i can set this to known and change the focal length for 24. there's a few other settings here as well so there's known and unknown which is either you know what the focal length is or not there's also approximate which means you have a rough idea of what it is and you can give it like a ballpark figure to try and help the computer guess better and then you can see we also have varying and constant for each of these constant is the one you're probably going to be using most of the time but varying means if you shot on a zoom lens and you change the focal length in the shot it will track trying to account for the zoom then we have the film back preset this is the size of your sensor you can just google the size of your camera sensor and type in the numbers here nuke also has a load of presets for quite well known cameras so for example i shot this on a sony a7 iii and it has a preset for sony mirrorless once all those settings are good to go that's everything you need to do so i'm going to hit track and just leave it for a bit and it will do its thing okay we're back that took about 15 minutes off camera because this is quite a long shot you can see it's 324 frames it usually only takes a couple of minutes depending on how many trackers you have and how long the shot is and how good your computer is and stuff but as you can see now all of the tracks have trails on them which shows kind of how they move throughout the shot the next thing you want to do is press solve and the computer will now start to work out the distance between all the tracking points and do some clever maths and once that's done you can see the tracking points change color we've got a lot of green ones which means the tracks are working there's a few red ones which are ones that are basically rubbish and what we can do to filter those is if we go to the auto tracks tab up here we can see the solver is currently 1.34 that's actually pretty good a lot of people say that you want to aim for below 0.5 that's a good rule of thumb but it doesn't always apply so what i try and do is just try and get a reasonable amount of tracking points in the shot try and filter out some of the worst ones and just see if it works so there's a few sliders down here the first one is minimum length this is like a threshold for how many frames the tracker should be active for before it becomes relevant and if you turn this up you can see that some of them start to turn red so basically i can say if it's less than 10 frames for example delete it because it's not going to be very useful there's also max track error and max error overall again turning these down will basically filter out the ones that have large errors you don't want to go too crazy with this because you still want lots of tracking markers in the shot what i'm kind of looking at here is still having lots of green ones on all of the surfaces in the shot but also filtering out some of the ones that are going to be problematic this looks like a pretty good amount to me so what i'm going to do is hit delete unsolved and delete rejected and this will basically get rid of all the rubbish ones there's also a few boxes down here that you can use to basically refine the solve so if i turn all of these on this will refine for the focal length position and rotation and if you press refine solve you'll probably see when it does the computing the focal length will drop slightly or not the focal length the solve error and we're now below one which is a pretty good solve error you could push it further i'm probably going to leave it at that because i know this is quite a lot of movement in this shot so 0.98 is actually pretty reasonable the next thing you want to do now is basically define where the ground plane is in the center of your scene so if i go back a little bit i want kind of this area to be the center of my shot so i'm going to select some of the tracking markers around here you can just hold shift and drag over them to select multiple and then i'm going to right click and go to ground plane set to selected and if i press tab now and go into the 3d view you can see these purple dots here are the tracking markers we have selected and this whole thing is the point cloud in 3d of all the tracking markers and you can see if i look at it from side on this is the kitchen counter this is the wall these are the cupboards at the top and it gives you a pretty good idea of where all the geometry is you can also set the world origin for your scene so for example if i select one tracking point go to ground plane set origin this tracking point here will be at 0 0 0 in 3d space as you can see here it's this yellow one right in the center of the world and that's pretty much it as you can see we now have a nice point cloud for our scene and it seems to be nicely tracked we have a decent solve error after this what i usually do is check how well the track is actually working so again you can select some of the points on the surface and then right click go to create and card and what this is going to do is create a card or a plane if you're used to blender terminology and then what i usually do is add a checkerboard node which is kind of this chessboard pattern and you can plug the image input on the card into this which means it will just apply that texture to the card then what we want to do is create a camera to view this through and at the bottom there's an export tab what you want to do is turn off link output if you leave this on it will basically constantly be linked to the camera tracker press create which will make your camera and then much like a 3d software you basically have to render this to turn it into a 2d image that i can then overlay onto the shot and to do that in nuke you search for a node called the scan line render a good way to think of this is literally like the render engine in a 3d software as you can see it's very handily labeled so we have object scene and this is going to be the 3d object which is the card we have a camera input so obviously plug this into the camera and as you can see once i plug that in the card shows up so now we're viewing this through the camera in 3d space it's coming out as a 2d image and i can use a merge node to put this over the top of the footage i don't want to put it over the lens distortion or anything so i'm going to move this off to the side the b input goes into the footage and the a input goes into the scan line render now if i look at the merge node you can see it's in the footage i like to turn the mix down in the merge node which drops the opacity and then you can see the footage underneath it still and then if i go on the card node i can move it around a bit so that it lines up with the counter you can use the little widget to actually move it around in the viewport but i find it's a lot more accurate to just punch in the numbers here so first of all i want to spin it around slightly in the z axis so that it lines up with this back wall over here in the card node we have all the translation settings translate x y and z and then rotate x y z scale x y z blah blah so to rotate it in the z axis all i have to do is just change the rotation number for the z axis i'm just going to use the arrow keys so that i have lots of control over the increments and do something like that then i'm going to use the widget to push it back in the y axis slightly until it lines up nicely with the wall i'm also going to scoot it over in the x-axis a bit until the edge of the card lines up with the edge of the sink and then what i can do is just scrub through the timeline and make sure that it's lining up the whole way through the footage and as you can see this is a really solid track and the card is staying exactly on the edge of the sink for the whole shot and that's it that's the basics of 3d tracking and i can do whatever i want this so for example i can draw a smiley face very quickly and put this on the card and now it's on the worktop although it's very light so i make this darker you can see it's there and it tracks very nicely into the shot so that's how to do a 3d camera track in nuke make sure to check out all the other videos in this playlist thank you very much for watching and i'll see you next time [applause] [music] you