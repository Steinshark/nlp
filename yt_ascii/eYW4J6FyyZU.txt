i quite often use a third-party bluetooth bit of kit to listen to music on my phone, okay, and it occurred to me because i sometimes click on the on youtube video when i see them and i want to watch them that the audio and video is out of sync so i think i tweeted it actually and you you mentioned that you might be able to help me out with it so what's going on with bluetooth and why are my videos and things out of sync? so i think we probably need to dial it back a bit and actually think about what we mean to say that video is in sync, or if it is out of sync because actually it's not a straightforward answer if i'm watching something on my mobile phone and the video is in sync so these that say there's a dot appears on the screen and at the same time i hear a bleep by the time the picture has reached my eyes, and the sound has reached my ears there's going to be a delay between the two because the sound travels slower than the light does which is what we'd expect but if i watching the same thing on my computer screen or i'm sitting back in the cinema making my popcorn watching a movie the distance between the screen and me is bigger as therefore it's going to take longer therefore the sync difference is going to be greater so sync is not necessarily mean that they haven't exactly at the same time but they reach us in the way that we perceive them as happening at the same time which helps a bit because it means that we a small amount of difference will will not be noticed because we'll just assume the thing is further away or closer to closer to us, and so we get away of that what really? will cause you problems is if the sound as it's happening now comes before the picture that really confuses us the sound is late compared to the visual is happening now then that's fine. it's just to a point you will notice it's too far, but you'll just think the thing is slightly further away than it actually is well back to normal so i've got a pair of apple earpods, which i bought just well i need a new pair of headphones where the one the sennheiser's had broken and i thought i try them see what they were like i wasn't expecting too much and turns out that musically. they're okay. they're open back so they they're not quite noisy environment, but the sound okay, the music's fine. yes, it's compressed audio over bluetooth link, but generally i enjoy them i like them other bluetooth headsets are available so i can just pop them in they connect to my mac and i can start watching a video and everything since income i think we got it close enough to my microphone you probably hear what's happening so you can hear it in the video, it's audio and video pretty much in sync so there's obviously something that apple are doing, and i'm sure other manufacturers do which means that i shall take these out and the interesting thing is that since i took them out it flicked it to be running on the video as soon as i put them back in it pauses slightly i think sort of catches up and the video audio is back in sync with the video through my headphones let's stop that for a second so we can see something that's going there and that when it's coming out and speak with the computer it's got to adjust things compared to it's coming through the headphones. it's got to adjust things let's think about what we mean by video and audio being in sync then we can sort of see how the things got to go through the whole chain and how it all ends up working so if we go for the classic clapper board then the way that old films used to be synchronized is that someone was standing for the camera and the microphone clanking the clapper board and you get a snap would you be able to identify on the video frame and the audio frame fracture on just on this to synchronize these two cameras? with a pen and a piece of paper so what we'd expect if that's the video frame that the audio data for that thing would have the noise such that we get the crack over the thing if each other in that frame if it happened too early we would hear the audio before we saw the thing which would look odd if happen too late then it would sound out i think again all that the thing should be far far away so what we want to happen is that if when we see this frame appear? let's call it t equals 0 we also want this piece of audio to appear t zero, so we want them to start appearing and that's a start play for the whole generation which is going to be what twenty? milliseconds or so for the whole thing we want twenty milliseconds of audio to play from the same point so what we want to happen is the picture to arrive and the sound coming to my ear to arrive at the same time if they start off at the same time and the audio processing practice the sound takes it takes longer than the time it takes the light to get me relative to each other then they're going to sound out a sink so we somehow need to make sure that this and this happen at the same time. we've got an interesting problem we've got an interesting sink issue anyway in that i have to effectively two separate earpieces and to get the proper stereo fact the audio has got to be synchronized between the two of them head friends shaunie's going to kill me for all this sort of audio first thing i'm making and doing so we've got to ensure that i hear the 20 milliseconds of audio for a frame at the same time as my eye sees that frame so that's what we're trying to make sure that the eye and the ear get the same data at the same time if that slips or even worse comes before it, then it's going to look odd why would we get variations when we're using bluetooth headsets? well we need to think about what's going to happen when we sort of do this and that we're going to have the audio data here, and so this is going to be a series of zeros and ones and so on to represent that data it's gonna be about probably for a single frame about 8,000 or so bytes worth of data and then when we send that over bluetooth the bluetooth link is compressed if you look at the packets that are being sent on the air pods it's ending at 250 kilobits per second aac so the first thing that's going to need to happen you can have the audio data coming, and then you're going to run that through your compressor, so you're going to compress that into aac so you running through that you're a ac compressor and that's going to take an amount of time so there's going to be time here so that's cause x seconds to do that that's going to then we split up into a series of packets, and so we're gonna break them up into chunks and then we're going to send these over the bluetooth wireless stack now probably inside this easily then gonna be reassembled at the other end probably you're gonna have some sort of buffer here i mean i would and the probably the same again so just so that you if there's some sort of packet needs to be resend gets lost you can resend and you've got time to get on so it's going to be a buffer which is going to delay things by about eight d ii will say there and then we're going to run that through the dq compressor so we're going to decomp that and then we'll get the data back the ones and zeros which we can send to my ear so the signal path? coming over bluetooth is quite complicated not only who got delays because of transmitting it it's gonna have to break things that the packets are going to compress it decompress it all that's gonna. take time, so we're going to have this sort of processing chain which is going to delay the audio and this is probably going to be well enough that you would notice it which is what shawn's experiencing when he's watching youtube for his cheap thing reading. i didn't say was cheap. just third-party it is yeah so that's the first problem that shawn's getting with his bluetooth headset is that he's noticing like they're like so how can we compensate for it? well again if we think about it what we want to happen is that this? audio data happens in the same time section that it was at the same time frame that the video is being played at that frame with video is happening there and so if we know exactly how long this route is going to be then we can sort of delay the video by that amount of time so that even though the video is going one route and the audio is going a different route when they actually hit my eyeball on my eardrum they appear to have come at the same time so we delay the video doing so yeah, so possibly you need to do that delay the video you may find actually of course the the interesting thing is that it may not be as simple as that because the video and the audio is coming from probably a compressed video stream with a compressed audio stream it may be that actually you audio quicker to decompress so you may find that actually you've got more things coming here but the thing we want is that at the same point in time here we want to get the same frame a video in the same frame of audio so we need to sort of get the video to be decoded and transmitted to the eye as light at the right time and the audio to be decoded re-encoded transmitted over bluetooth into the ear buffered possibly didn't become sound and it happens at roughly the same time. i within less than probably 10 to 20 milliseconds you wouldn't notice it in that sort of timeframe so you need some way to sort of track how long each chain is for the two things to happen and then work out so that we then release them at the same time so how do we keep these two things that see how do we do that well? for the things that happens on our computer we can write we rent the software. we know how the faster computer. we've got is we've got some idea for how long that will take and again. we can sort of buffer things and realign them once we know how things because we've got audio which is probably labeled to a particular frame we've got video which is labeled to a particular frame we can decompress them and put them into a buffer and we can align them and then start playing them out so here were that bit out the bit that we don't know because the time it takes for the light to get there is going to be so small it's going to be negligible so we can assume that zero the bit we don't know is the processing time for the audio being sent through the bluetooth chain and getting to the ears now fortunately the specifications for bluetooth audio which is the which is used on the air pods is the advanced audio distribution profile which runs on top of the? audio-visual distribution transport profile and inside the a/v dtp the audio-visual distribution transport profile there is an ability for the air pods or any other bluetooth headset to send back details of the delay incurred by sending the data so that you can send data back saying okay, this took x milliseconds and if you know it's taking x milliseconds to process the data, you can then adjust the video and all the audio is necessary so they suddenly end up back in sync. this is basically a feedback loop isn't it? yeah, i guess you could call that in that the so the device is telling you what it is and then we can adjust it to do that and we can get things to be sinkers and actually, it's set up so if it changes for any reason for example i move further ways or more bluetooth traffickers in the area so it's having to resend him off and/or buffer it more to get all the data then it can adjust the delay and things can happen we can actually see it because if i start the video playing now we can hear and then put my earphones in you'll see it pause and then sort of catch everything back to speed and it's back in sync so it pauses briefly, and then suddenly it flicks and everything is back in sync because it's had to adjust the actual timings of the two signals, and as i take it out again it carries on playing things. it's actually a lot quicker to go that way than it is to come back in here if it is that i bought a cheap pair where where is the fault is it in the device? or is it in the phone, or is it? where is that because basically? i thought i've got an expensive nice pair of headphones, and i want to keep using them but i want to use them wirelessly. yeah, okay, where's the phone? sorry sorry yet, so it's an interesting question it's not necessary that you walk cheating. there's lots of places so for example it could be that the software hardware combination on your phone isn't bothering to synchronize this and apple have said when they've implemented this they have and other people have said they have that's one possibility it could be that the device you are using isn't returning the right delay and so it's still actually it is delaying it, but it's not accurate enough these various reasons work and we could just really they haven't bothered implementing it because they support an earlier version of the profile that didn't have theirs in so there's lots of places where it could be i mean you could sort of test you you could try the device on a different source and see whether that has the same problem you could try it with a different pair of headphones on your phone and see if that has the same problem, and so on say yeah, okay it's not necessarily that you bought cheap device machine search sites getting slowed down because well we don't like what they're doing and this is the argument that net neutrality advocates would have which is that? it can't be at the whim of a commercial provider a server provider decided to favor some website, and it does kind of make green kind of what i was expecting i mean, i thought this is a bit orange ii just