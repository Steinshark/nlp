hi everyone welcome to another episode of coding adventures the space is frustratingly big if this is the earth the moon is all the way over here and mars is several months travel further out it would be much more fun to explore if the moon were about here instead and other planets were a little more accessible too because of this among other grievances i've decided to make my own solar system first we need gravity so i'll start with this famous equation which says that the force with which two bodies attract one another is equal to big g the gravitational constant which in the real world is this tiny number but it can be whatever we like wryly that's then multiplied by the mass of each body and divided by the distance between their centers squared to translate this into code i made a little script which holds some information about each body like its mass radius and initial velocity i then have a function for updating the velocity where i just loop over all the other bodies and calculate the force using that equation from a moment ago acceleration is just force divided by mass so these masses actually cancel out but i'll keep it separate for clarity finally the velocity is increased by the acceleration i have one more tiny function in here and this one just moves the body using its velocity the reason i have these are separate functions is that i then have a simulation script which first updates all the velocities and then all the positions which i found was a lot more stable than updating each body's position immediately there are fancier ways of doing this for example i looked into something called leapfrog integration but it didn't seem to make any difference at all so i guess i was doing it wrong anyway let's mess about with this a bit so if we have a planet in a moon arranged like so the moon is of course just going to crash straight into the planet but if i raise its initial velocity on the y axis i can get it to sail further and further until eventually it misses the planet entirely and goes into orbit raising the initial velocity even more will make the orbit increasingly elliptical until finally it's going so fast that it escapes the gravitational pull of the planet i could also give the planet some initial velocity here so now both bodies are moving through this lastly i'll try raising the mass of the moon and we can slowly see the path of the planet begin to undulate a little [music] so with two bodies the orbits are fairly simple and predictable but if you add in just one more suddenly there's an explosion of complexity [music] [applause] [music] you i had a lot of fun playing around with different starting configurations but inevitably there would be a collision or one body would shoot off and i'd end up with just two bodies orbiting each other in the same repeating pattern and i began to wonder if there were any scenarios in which that wasn't the case so i did a little research reading the three-body program page on wikipedia which led me to this paper in which has listed the conditions for one possible stable orbit of three bodies so i'll move the bodies to their described positions and starting velocities and you can see how this simple figure eight orbit emerges i'd been playing around for ages and just getting crazy chaos so i was pretty blown away by the fact that such a simple orbit as us actually exists [music] okay yeah time to make a solar system so i'll start with the sun in the middle and i'll duplicate that out here and turn it into a blue planet i'll of course set its radius to be a lot smaller and then i need to set its mass but i have no idea what that number should be so i've rearranged the equation from earlier to calculate mass given the radius and the acceleration due to gravity on the surface i want this planet to have a gravity similar to earth's so i'll set the value to ten finally i'll increase its initial velocity until it's going in a nice orbit around the sun now this causes the sun to move as well so i've got an option in my displace worked to draw everything relative to a certain body which it just does by subtracting that body's movement each iteration and so if i set that to the sun we can see the blue planets orbit more clearly now i'm going to add another planet nearby and my goal is to make these two orbit one another as they go around the sun i am trying to do this by adjusting initial velocities but so far it's not being very cooperative i'll just keep patiently tweaking though until it behaves this is looking better but i want the orbit to be more circular so i'll raise each bodies velocity bit by bit until it looks right with some small tweaks we can get different patterns to emerge which i think is kind of cool it's not very clear though what the planets are actually doing here so i'll quickly go back onto my visualizer tool and just increase the number of iterations up from zero i guess i could also just let it play out and see what that looks like [music] this is better quite a lot but i think it's looking good so far so zooming out i'll add in a little green planet and adjust its velocity to bring it into a circular orbit i'd like this one to have a moon so i'll zoom in on it make a copy and make that a lot smaller then as before i'll mack about with the velocity to get it into orbit but it's pretty difficult to tell from here if i'm having any success so i'll set the orbit display to be centered on the green planet and i can then try talk it into going into a circle [music] okay yeah i want one last planet for now a large purple one with the relatively high surface gravity i see it's making the green planet and its moon wobble a fair bit so i'll move it a little further up to where it can't cause so much trouble i think i'd like this one to have two moons just for variety so i'll go ahead and create those zooming out in seeing the orbits like this you can imagine how perplexing it must be for the purple planet people looking up at the sky and seeing these peculiar loop-de-loop opens one day they'll figure out that the sun is actually at the center and it's gonna make so much more sense looking at the moons of the purple planet especially the inner one i have a hard time believing it's actually going around in a circle even though i know it's true i guess it's the way it appears to abruptly change direction that throws me off so i made a camera follow the powerful planner around just to be sure ah isn't it cool though how all of this arises essentially from this one kind of an impressive looking equation anyway i'd really like to be able to fly around and visit the planets so i opened a blender and created this rather ugly space exploration vehicle and if i zoom in over here you can see it as an equally ugly interior but there's a fire extinguisher so at least it's safe i then coded off a simple controller this is the input code here which just lets you thrust in all directions and also rotate the ship with the mouse then over here i make the ship be affected by the gravitational pull of all the planets and apply the thrust and rotation to the ship's rigid body so i can now hop into my ship and fly about [music] it can be quite tricky to gauge how you're moving relative to the planets so i want some sort of ui to help with that i've recently been playing a brilliant game called outer wilds and that's essentially what inspired me to mess about with this stuff in the first place but more to the point i'm going to shamelessly steal the way that they handled the ui for this which is that as you point your ship towards a planet you can see these little markers around it and if you actually press on it then you see some important information like your distance from the planet how fast you're heading towards it and with these two arrows how it's moving relative to your ship as you can see i also added in some distant stars and and where they look pretty terrible it's literally just 3000 spheres born really far away i'd like to experimental something better in the future with not just stars but maybe distant nebulae and so on but for now i'm just going to attempt to make a graceful landing on the screen planet [music] well that was anything but graceful but in any case i'll get out of my seat open up the hatch and step out onto the surface like the ship the player is of course also affected by the gravity of all bodies but one way it's different is that it finds which body currently has the strongest gravitational pull and aligns the players up direction without any way there's really not much to see on this planet it is just a sphere after all so i'll hop back over to my ship close the hatch buckle in and take off [music] so obviously the solar system is not terribly interesting to explore at the moment but i'd like to change that by replacing the bland spheres with some procedurally generated planets and maybe adding in some little creatures or i don't know how far i'll take it yet but it seems i can be fun to work on i'm going to leave all that stuff for future videos though because they deserve their own episodes well here we are in the moon it looks just like the planet except it's grave and you can jump really high of course [music] the last thing i'd like to talk about for now is precision issues it's a problem that plagues space games or any very large open world really the issue is that the launderer number gets the less precise the decimal part of it will be and this can lead to one key physics and ugly rendering when the player is very far away from the center of the world for example here i have the ship on my outermost planet 50,000 units from the origin and as you can see everything is jiggling like there's no tomorrow so my crude fix for this was just to make a little script that checks how far away the player camera is from the center of the world and if it exceeds some threshold just move everything in the scene back to put the player at the center the physics engine was not a big fan of that idea at first but with a little bit of tweaking i was able to get it to behave so in the editor i have that threshold value set to a thousand at the moment but just to demonstrate i'll sell it to something really small and now as i pilot the ship you can see that it's staying pretty much fixed at the center while the moon and everything else moves around me instead of course from the players point of view everything looks normal so that's all i have for now it's all very crude and patched together the planets don't even rotate yet because that made my player slide around weirdly but i've been having a lot of fun playing with this and i'm excited to take it a little further so i hope you've enjoyed watching and until next time cheers you