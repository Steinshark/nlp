dr. steve bagley:
- so on monday the 16th of october, 2017, two researchers of the belgian university released information of an exploit that they've found for the security mechanism used on all major wi-fi connections these days. so this is wpa, the encryption protocol that was brought in to replace the early one, wep, which was basically useless. so this one has been proven to be mathematically correct. it's been proven to be mathematically secure and so it was thought that you wouldn't be able to attack it. and for the last 15 years or so there's been a few fringe effects that you could exploit to get certain things, but in general, it's secure. until yesterday :) the way that wpa works is that when the client, your computer, connects to the base station initially starts off unencrypted and very quickly they exchange a series of messages between the two which get them so they've agreed on a key that they're going to use to encrypt the message. and so to understand how this attack works we need to understand how those messages are transmitted, and then how that's used to encrypt the data, which is why i brought mike along to sort of help talk about the encryption side of things hello, mike dr. make pound:
- hello! what am i doing here? - so what we've got open on the computer here is i set wireshark going when i turned on my wi-fi card it's captured a series of packets and what we can see here is there are four packets of information that are sent between the computer and the access point and these effectively agree the shared key that they're going to use. now this isn't the password you put into your wi-fi router. one of the interesting things that this attack works without ever necessarily getting hold of your password. so we end up with four messages that are being sent between the base station and your computer to establish those things. so if we have a look at them, we got our computer here, and we have the access point here, or the base station and we've associated with it, so the first thing to set up the encryption is that the access point sends a message across, and we'll call this message 1. this contains various information in there including a random number which is used, and a counter which is used for something else. but we won't go into too much detail and then we reply with our random number which is message 2 they send message 3 which contains a bit more information, and then we send message 4 which basically says, "yep. i got that. the communication is now established." now the way the krack attack works is by sitting in the middle you have another computer, which is your malicious actor which is going to sit there to try and break into this encryption, and he has to sit in such a way that he can know when message 3 is sent and stop message 4 being sent back - sean: what does he do? block it or something? - dr. bagley: i mean basically the way this works is that you need to cause message 3 to be received by the computer more than once in a way that you know about and you've got access to things and if you do that you can start capturing data and you can use some of the techniques that mike's going to talk about to decrypt the information. so one way you could do it is you could perhaps splat a bit of noise on to the wi-fi signal at that point. there are easy ways where you pretend to be a base station and quickly send a message saying, "switch to me on a different channel because i've got better communications here," which means you receive it and the other base station doesn't and then it sends it out and you could sort of forward it on. so there's various ways you could probably push this into into use, but basically once you've got in here, and you caused this to be resent it causes parts of the values that the computer uses to encrypt the messages to be reset as well and once you've done that you can get into a position where you can actually start to decrypt the messages. dr mike pound:
- when the client receives message 3, that's a moment it thinks right i've got my keys now. i can store them away ready for encryption the problem is that if the access point doesn't receive message 4, it thinks oh well something must have happened to it. so i'll send message 3 again to make sure the client got it . the bugs that these researchers have found is that if message 3 gets resent, it restores the key and in doing so also resets all of the other cryptographic variables it's been working with, which is a real problem in particular it's a problem when you reset something called the nonce, or a number used once. so the way we usually encrypt in wpa is through aes, advanced encryption standard and we do it in counter mode generally speaking because it's quite fast so if you think back to the video we did on xor and stream ciphers we basically use aes as a stream cipher so we have an ever-increasing counter let's say it starts at one, and we encrypt these numbers with our aes block cipher here's our key coming in here so this one when encrypted using this key will produce a block of aes encrypted data that's random. so basically we're generating here a set of random numbers that goes on like this from the first block and then the second, and then the third and so on all the way along but it's not a truly random thing because if i know the key and i can still get want to generate the same, yeah and so i mean, that's about unfortunate is the problem with cryptography is that we couldn't ever use truly random because we wouldn't be able to decrypt it again we have our message bits, which are you know naught, 1, 1, naught, something different and we xor these together one bit at a time and that's how we encrypt and the nice thing is to decrypt we basically regenerate this key stream and do the exact process again we xor our ciphertext and get our message back out. now counter mode is very very fast and it's perfectly secure if your block cipher produces nicely random bits unless you reuse the numbers in which case it's completely broken. in this attack, remember, we're resetting the nonce because we're sending message 3 the client sees this and goes, "oh i better restart  my encryption from start from scratch again." so this number goes back to one, or goes back to zero somewhere at the beginning, and so we're generating the exact same key stream multiple times we start by cryptic some data using the key starting at 1 2 3 4 and then it gets reset and we encrypt some different data with 1 2 3 4 q: so normally it doesn't go around like 1 2 3 4, 1 2 3 4. it literally keeps -- it will just keep counting up and obviously the theoretical limit will be the 128-bit number that you're trying to store. that's unlikely to happen in the time you're connected to the wi-fi but it's a theoretical possibility if they use one multiple times you can probably work out what? -- yeah, so if you imagine that we've used one multiple times the same keys been used, because the key didn't get changed, then the same key stream of zeros and ones have been xor our message and that's very very weak when we use the same key twice we can essentially nullify the key by xor in two messages together and then we do a very similar process become something called crib dragging so we will come up with hypothetical bits of plaintext we think let's say the word html or someone's login name or something like this, and we will slide it over the message until it gets a hit and at that point we know not only where it is but also what the keystream bits for that position were. so it's not a completely trivial process but on our computer it can be bruteforced incredibly quickly. if you reuse the same counter twice with the same key in something like counter mode it's such a huge problem because basically you can extract plaintext bits from multiple messages once you've started to do that then you've got some idea of what we've sent you might be able to predict what they're going to send and sort of get in and start doing replay attacks and things like this or injecting information in, but we've done all this without even knowing what the key was. so it's an interesting part of encryption where you aren't necessarily secure just because the key is secret right and in this case very much not the case the other issue is that some of these modes you can extract the authentication key as well so when we talked about hmac we had a secret key that we used to make sure the message hadn't been interfered with. well, if we can find that key which you can using this attack, then you can start to forge your own messages. start to, let's say, add in tcp packets of html that conveniently holds some javascript that runs some ransomware for example, and then you know you're in business and we've done that without knowing what the key is. one question what would happen if this key was zero? here when we're generating this counter what happen if the key was zero. if the key is zero then you're encrypting one with zeros it will still produce a random output, but it'll produce a random output that's always the same, and we will know what it is so we could we could guess the key stream. and if we knew were in the key stream then we could generate the right values generate the right packets. the way this plays out is on certain operating systems. it basically has no effect so windows. ios. it seems because of the way they follow or don't quite follow the standard it seems that this has limited effect. there are still ways you can attack things, but it has a limited effect so you'll say people on windows laptops and on ios devices should be alright? they are safer than other devices the problem comes with them the program that does it in linux and on certain android friends so the implementation used on linux and android that clears the key out of memory which is a good thing to do because if you're sitting in a coffee shop when you go after buy a coffee it's not impossible to plug the device quickly, a thunderbolt device to do it into the side of the machine and copy the bit of memory out of there, which is perhaps got the key in it and then we can decrypt your traffic so that makes sense the problem is that when you replay message 3 which you need to do to make the attack work that also resets the counter, the things that mike's talked about, and it now uses the key which is 0 to start encrypting these things so actually you end up with a known sequence of counters being generated which means that you can then as well as decrypt the messages you can sort of insert data into that message stream and start sending things to you that you perhaps weren't expecting to get. so on certain operating systems, it's relatively benign on others it's more dangerous but it's also worth remembering that we should still use wpa2 to encrypt things because the alternative is that you have no security and that even if someone does come and do this they could do exactly the same by unplugging your base station and plugging in a new device into the ethernet the other side of that and listen there anyway, so it's the risk, it needs to be patched it'll be patched, and then we can all go back to using wi-fi and browsing the web those leaks happen all the time and so passwords are being just dumped into the internet all the time, so there's this password list called rockyou which is a bit of a game changer in password cracking if that's a thing like-- 50 but this is the ibm pc/xt the model 51 60 which came out two years later in 1983 so this is really what the first pc was like--