lm's large language models are really powerful and can be used in lots of different ways in your projects you can self-host an ai model or you can work with ai as a service and the most commonly used one currently at least is open ai api when you use open ai api you get an access token and that allows you to interact with the api but it's not plug and play there's several things that you need to think about some cfats when you actually start using an ai api like this in your production environment so today i want to give you three practical tips for working with a tool like openi api before i start if you want to learn how to design a piece of software from scratch check out my free design guide at aron blood codesign guides it contains the seven steps that i take whenever i design a new piece of software new minds also find it helpful so iron. codesign guide link is also in description of this video now let's dive into the first tip which is that you need to work around token limits now you may say that this is actually a temporary thing because the token limit of these ai models goes up and up and up but at the same time we might also want to use ai apis with larger pieces of text at the same time so you still always have to be aware of what the limit is in terms of content that you can send to an api so what i have here is simple main file that i'm going to use as an example in this video it initializes the open ai client uses open ai gp24 model then it reads a query from a file called short story. text which is actually a short story that i can show you right here so this is a short story that for example we could ask the ai to translate this to another language and similarly i also have a much longer version of this story that's for sure going to hit all kinds of token limits if you want to send this directly to an ai and from my own experience dealing with token limits is one of the main issues that you need to think about when working with an ai api and it even depends on the model that you're using for example in the case of open ai's gpt model so gpt 3.5 turbo has a token limit of about 16k tokens whereas gpt 4 has 8k tokens and now it's going to be increased to 100k which is a lot more but still you might run into that limit at some point and what's sort of annoying is that you don't always get back an error from the api that you've exceeded the token limit that only happens if you send more input tokens because that token limit is input plus output so it's very well possible that you do get a result from your api call but it's just truncated and that's problematic because it means you only get a partial response now if the ai just responds with general text that might not be such a big issue but if for example you ask it to respond in json format you're going to get back half of a json structure and then you can't parse that and you can basically use any of it so that's really problematic and that means you need to think about how to deal with token limits but then you need to somehow estimate the number of tokens that you need you can't predict the number of tokens in the output because that's what the ai generates but you do have some control over what you send as input now you can kind of guess what the number of tokens is by simply counting the number of words and the text that you send but that's not really accurate the alternative is that you use a tokenizer to make an educated guest and my go-to library for doing this is tik token so here's one of the functions that i'm using in the script called handle request that gets a query that gets the open a model and the open a client and this computes the number of tokens from the query using this function and that's in the encoding file that uses tick token to get the encoding and you can specify various options here so you can pick the one that most closely matches the api that you're using but then when you encode it you can return the length of the tokens and you get a sort of educated guess of how many tokens this text actually is and now because we have the number of tokens we can decide whether we need to cut the request up in different pieces or not and sometimes you can't do that because the request is needs to be one thing in that case you can return with an error but in some case like for example text translation you can try to cut the text out in smaller pieces so that you then separately translate each of the pieces that's what we assume here so one thing that we've done is that we've defined token limits for each of open ai's model like gpt3 turbo or gpt for and then we can use these token limits to determine in how many pieces we need to chunk the content and that's basically what this function split query into parts is doing and in this case i created a pretty basic chunker that splits the text into sentences by using a regular expression to match sentence endings i won't dive into all the details here but you can find the code for this example in our example repost story i put the link in description of the video but basically what happens then is that we have all the different parts so we chunked the input text and then for for each part we send a request to open ai api which is what is happening here and because we're handling multiple requests that also leads to the second tip which is that we need to think about rate limits if you make too many calls to an api within a short time frame then you're likely going to hit some sort of rate limits and that means your request will simply return with an error and of course you need to be aware of what the rate limits are of the various apis that you using and then make sure when you're sending out requests that you're within the ranges that are allowed here you see an example of how a rate limiter could work so i've modified the code here to add a decorator that limits the rate at which you can send request and i've put a maximum number of calls here within a certain period so this is all in seconds and then when you call the function then it's going to respect these rate limits and this is just the basic decoror for rate limiting that we built ourselves of course this doesn't work if you have multiple surfaces calling the same api then you also need to coordinate that between your surfaces but for a very basic setup this kind of function actually works fine now i wouldn't really recommend that you build this from scratch yourself you can use rode or you can use an existing library i haven't really found a great rate limiting library yet in python if you have a suggestion please let me know in the comments the third and final tip is that you should use the appropriate model for your project depending on what you actually need you don't always need the highest performance or most expensive model at the moment the high highest end model that open ai offers is gpt 4 which is really good but it's also a lot slower than for example gpt 3.5 turbo and depending on what you need you don't actually need all the capabilities of gpt 4 for example if you just want an ai to review some text then perhaps using gpt 3.5 turbo is more than enough it's more than what you need and that save you money and time because gpt 3.5 is way faster than gpt 4 and it's also way cheaper here i have a main file where i try to translate this short story and then i'm doing that for each of the different open ai models so when i run this code and now it's actually calling the different apis to perform the job you'll see that the time that each of them needs is going to be very different so here you see for example that gpt turbo now succeeds in 16 seconds whereas gpt 4 is currently still working so it takes way longer so overall it's always a trade-off between speed accuracy and price so in short be aware and take into account token limits make sure you don't hit rate limits and the third tip is to make sure you use the appropriate model for what you actually need we've been applying these ideas to learn tail which is an ai quiz tool that we've been developing you can try this for free at learn.com if you want to learn more about how we set that up and how the architecture of such a system works check out this video next where dive into the details thanks for watching and see you soon