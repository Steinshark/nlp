um so it it's absolutely wonderful because we had like two horror shows and one very useful contribution here and i will get back to the horror stuff and it's super fun because i i i really couldn't fathom that we would have two horror shows about msvc tonight today which is it's wonderful tells a lot and so i'm i'm going to talk a bit about why we tried to run msvc online how we managed to pull it off and a few of the things of the roadblocks we faced on the way as tp so yeah it's it's it's a lot so the first question what why would you do that to yourself well it turns out we had a customer that had a very interesting requirement and we were just experimenting with build distribution and they were they had the requirement that they needed to build four window windows with msvc and so we couldn't really cross compile with any of the classic stuff and the built distribution technology we were using was linux only for the container side so we were like we can't really do it but we have a dumb idea so there was a lot of good reasons you want to do this because linux has great io performance there is no antivirus in your way and tfs is like there's many better f systems and ntfs in terms of speed at least and there's a lot less quick tweaking required etc so there's a lot of good reasons why you might want to use a compiler like msvc on another operating system and there's one special thing here forking on on posix or unixes is way faster way faster so there's also a good lot of reasons not to even try obviously no one kind of thought of giving this a try in design phase of msvc i won't go into all the details of the ideas we came up with why it's a really bad idea but we did it anyway so the first very interesting stuff is how to get an msvc installation on another system than linux turns out that it's probably lost cod cause to try to even run the official installer on wine like i i i looked at the crash dumps it's be like i i stopped at the third or fourth try and actually there was a genius thing is that they just published json manifest that contained kind of all the urls and paths of the things you have to download then you just have to figure out how to put them in the right place we managed to solve this kind of it's a 1,500 lines mess of python at this point but we managed to kind of replicate the installer behavior of the msvc installer and get a really nice and clean install on a linux f system the next step was really interesting who's familiar with msvc or building on windows year so you might know about vc varsol which is your good all friend that you need to make msvc happy it turns out that that batch script is so complicated and does so many things that the command line interpreter of wine can cope with it like it fails on the first few hundred lines by misinterpreting a simple if condition and everything blows up then again i i looked at crash dumps and tried to debug it and figured well sometimes you have to part ways this this again this was this was kind of useful to have done the installer thing first because this vc varsel basically just sets 27 environment variables for you to be happy and we knew about mostly all of them so we generated them during install and now we can source them in linux and and everyone's happy now for the really fun part so we were we were basically implementing build distribution so we had a linux computer driving the build in a emulated windows environment so you can imagine that like things like path don't look quite the same and so do for example common line parameters so on linux you typically see minus some flag name or double minus some flag name and a value for for some common line flags in windows you will see slash and then a name and this kind of collides with path letters on on on linux so cmake which we run on on linux in this setup is happily generating kind of useful things but for example here msvc c/u as a parameter which tells it to do something with a path it doesn't understand afterwards so we had to implement a small forward descent parser doing a lot of common line rewrite argu common line argument rewriting and use this as a comm compiler launcher in cmake so i knew i i now pretend that i know a a lot about common line arguments in the whole msbc tool chain there's a lot and a lot of undocumented ones thanks a lot microsoft and it's it's basically used as a kind of shimming application and and does some magic so you give it hey intercal launch cl xa with that bunch of parameters and internally does some magic and it will turn this into something which makes sense under wine and then executes the cl xa with with all of that in wine so was it was it worth it hell yes it's way faster and cheaper to get good compu in the cloud with linux on it we actually see 20 to 10 to 20% faster builds just because of the differences in process model and this in spite of having windows kernel level emulation going on we can cross compile very easy easily for all the win targets that msbc is happy with and we can distribute the builds and so i i know there's a couple guys from microsoft here we should talk it's awesome and it's wonderfully weird so we we we h the first time i saw make cake launching make launching msvc in wine i was like in all and and was like this feel so wrong but but it it's it's it's amazing and so here's a few benchmarks there's the one i'm i'm i'm showing is basically we we built all of boost on the these numbers is that machine and basically even h incurring the cost of docker and hyperv viralization because this was running in a docker on on a windows laptop we get like' we we we get like'% out of that and and if we gave it give it give the whole thing into an environment that is not thermally limited we get even a bit more out so it's it's really really interesting you can try it if you activate the trial and and and give us a call we we can make it happen and other than that thanks and come look have a talk with us at the booth [applause]