in this video as you can probably see behind me we're going to be talking all about keying before we get into it both the green screen footage that i shot for this and the nuke script will be available in the one dollar tier on my patreon for anybody that's interested in picking up the project files it really helps to support what i do and keep me making these videos i'm gonna aim to try and cover all the main topics that you need to know we're going to look at different types of keying as well as the different nodes you would use for them in nuke i'm also going to cover doing multiple keys so things like getting a base key and then doing some hair keys for fine detail i'm going to touch briefly on de-spilling your footage and then a little bit on edge and motion blur painting as well so let's get started i shot a couple of pieces of footage for the example for this tutorial so let's grab them this is the first one it's just me on a green screen and this is the second one which is also me on a green screen but just doing something else so first of all different types of keying generally when people think about the topic of keying they'll picture something like this which will be a green or a blue screen and you'll be doing what's called chrominance keying which is keying the color as well as chrominance keying or chroma keying for short there's also luminance keying which means the computer is detecting variations in contrast so for example if i press y on the viewport in nuke this will switch the channel view to be looking at luminance as you can see up here and what this means is that the brighter things in the shot are obviously displayed as white and then the darker things in the shot are displayed as black and anything in between becomes some sort of gray and as you can see there's lots of contrast between the dark of my jumper and the color of the green screen not just in terms of the green and blue but also just the luminance value nuke has a node called the kia node which is probably the one i end up using most often if i plug this into the footage you can use this to do a luminance key and i can adjust the controls here to get a better key on my jumper so something like that pulling some sort of key whether it's keying the luminance or a specific color channel is my go-to before trying to do any roto because that obviously takes a lot longer so it's worth noting there's much more to keying than just green and blue screens inside the care node as well as the luminance key you can also key individual channels so here next to operation as well as luminance key you can see there's lots of other types you can do as well there's settings for keying the red green and blue channels then there's actual green blue and red screen settings then we have the luminance key which we just looked at and there's also a saturation key which is quite interesting so if you have something in your shot that's particularly colorful you might be able to isolate it using the saturation keyer so that's the kia node again like i said i use this more often than any other keying in nuke i'll just add a new one and do a very quick green screen key so we can compare the differences between the nodes so set the operation to green screen then if i look at the alpha by pressing a over the viewport pulling in these handles will allow you to basically change the contrast of the key so i can pull the black point in until i start to get a pretty good edge on myself and that's not too bad for a single key this definitely wouldn't actually pass for a final product as you can see i've lost most of the detail in the glasses and the edge detail on the hair and everything is quite crunchy so we're losing quite a lot there when keying is pretty good practice to do the key off to the side and then copy the alpha back in and pre-mult it so that you can treat all of your footage separately so what i'm going to do here is add a copy node and plug the b input into my main stream the a input into the key and then pre-mult it down here it's also a good practice to do some sort of garbage mat around the subject so that you're not keying any unnecessary parts of the green screen for example there's no point worrying about getting a really good key here because my body never goes near it so what i can do is add a roto node and just draw a mask that's roughly the shape of my body but outside of anything where my movement will pass it so i do that and i just go through the shot and make sure that my hair and everything is never clipping through the mask so then what i'm going to do is add a merge node plug this in here when it's connected to the roto and set this to mask and there we go as you can see the edge is pretty horrible and there's also some really obvious green spill that's coming through so i'll talk about that in a bit let's just make a little backdrop so that we can see which one's which so that's the first example now let's go on to key light which is the main keyer that i use for green and blue screen i'm not sure it's necessarily better or worse than the other ones in nuke but i learned after effects before i learned nuke and after effects also has key lights so it was something i'm already familiar with so i just naturally gravitated towards using this but i do think key light generally gives the best results for keying hair so with key light node it's pretty simple just plug it into your footage as you can see up here then the first thing you want to do is sample the screen color so grab the color picker from the screen color settings and then what you can do is hold ctrl and click and drag over the green screen to sample the color of it now if i look at the alpha channel this is what i have and if i move my color picking selection over different points of the green screen you can see that we get different levels of keying the green screen's not perfectly flatly lit so you can see there's probably a bit of a hot spot up here which is why the key is good around this part and then as you can see as it gets to the edges and goes further down it becomes quite grainy so what you want to do is pick an area of the screen that's pretty much in the middle something probably like down here where it's sort of a middle between the highlights of the screen and the shadows is probably the best bet so let's grab something like that there we go that's looking pretty good we can always tweak it a bit afterwards as well so then again let's take this and put the key off to the side and then we're going to copy the alpha into the mainstream from the key light node and pre-mold this i'm also going to grab the mask setup from over here so i have to do it every time just going to add a little bit of a blur so we can soften the garbage mat on the edge if i gamma down the viewport you can see there's a couple of areas on my jumper and my glasses and my face that actually have holes in the mat there's a couple of ways you can fix this there are settings in the key light node if you go to screen matte you can change these settings so for example clip white will increase the contrast of the mat essentially and fill in any holes and clip black will start to erode in from the edges and eat into your mat what i prefer to do instead is use a grade node to actually grade the alpha so what i'm going to do is add a grade node here set the channels just to alpha so i'm not grading anything else and then i tend to use gain and gamma just to get a result that i'm happier with i can turn up the gain to fill the holes in the mat probably about there will do the trick it's not worth pushing it so far that i get every single hole from the glasses because what's happening here is that my metal glasses are reflecting the green screen so what i would have to do here is actually do a little bit of roto just on the edge just to fill that gap in so i can just do that and then merge this roto over the top of the alpha as well and now it's filling that hole and there we go if you use this technique you might notice that your alpha goes above one so you can see here my alpha is now 1.3 because i've increased the brightness using the gain in the grade node if your alpha goes above one it can cause defocusing problems later on so as a good habit it's a good idea to put a clamp node after your grades just before you copy the alpha back into the mainstream just to make sure that your alpha maintains a level of one so that's the key light setup again i'm going to go into detail of getting rid of the green edges and stuff a bit more in a moment the next one i'm going to show is called primat i don't really use this myself at all but i know some people at work that really like it so whatever works for you it's good to know all the tools so you can know the advantages and disadvantages of all of them primat is kind of like a process of elimination you select the main color of the screen when you add the node in it defaults to having the color picker selected so you can just go straight onto your footage and hold ctrl and start clicking and this allows you to color sample the screen then from here the idea is you can use other features in the node to add and take away from the key so i open this operation drop down the first setting is clean background noise and what you do with this is hold ctrl and click and drag over the areas of the green screen that are being picked up that you don't actually want so all of this noise here you can see as i drag over it it starts to disappear then you can improve the key on the subject by choosing clean foreground noise and again holding ctrl and clicking and dragging and start to add detail back into the key and as you can see there that's given a really nice result so that's looking pretty good it's given quite a similar result to key light although i think the hair key might be a bit worse just compare the two you can see that key light was a lot softer and i'll talk a bit later about doing a proper hair key anyway so again let's copy and paste the mask setup bring this over to the side and then just add the garbage mask in and then copy our alpha channel put this into the mainstream and pre-mold so there we go that's primat and the last keyer is called the ibk here i'll show you how it works now if i search for ibk you can see this king technique has two different nodes associated with it the first one we're going to use is the ibk color node so you plug this into your footage up here at the moment it's done something crazy because it's defaulting to blue screen so depending on the color of your screen in this case green you want to change it to be the correct one the way the ibk keyer works is it essentially creates a clean plate so it looks at the color of your screen in this case green and then it does some complicated eroding which spreads the pixels of the green screen into your subject and the idea of this is you can turn up the size and you can also take this node and stack it on top of itself a load of times and the idea is that then using the other node you can do a difference key between this and your original footage and it should be able to work out the outline of your subject so to put that into practice let's add the ibk gizmo let's put this over here you want to plug the foreground into your subject and the c input for the color into your color nodes in this again you want to change the screen type to be green and then if i look at the alpha channel it's doing a pretty good job of keying it already again if i gamma down the viewport you can see we've got a few holes in the screen so what i'm going to do is use a grade node again set the grade node to alpha and just punch up the gain a little bit until we fill the holes in the mat again let's do a clamp just so we're not pushing the alpha above one and then we want to copy the alpha back into the mainstream again add a pre-mult and let's just grab the mask again from over here and there we go that's the ibk node so if i compare these results obviously the settings aren't exactly the same between all of them this is the default keyer in nuke this is key light this is primat and this is the ibk here if i flick between them and zoom in you can see that they've all got quite different results especially on the edges so it's worth knowing all of them so you can use them for different approaches for different shots of all of them i'd say the ibk gizmo has the best result for this it's done a really nice job of maintaining hair detail and you can see it's even picked up some of the fine hairs from my beard it's got the worst in terms of the green spill around the edges but there's lots of comp tweaks i'm going to show in a second that will allow you to fix this very easily one of the main things that will immediately make this less noticeable is de-spilling the footage if you're not familiar with these billing it's basically the process of desaturating the green or blue in the shot to specifically reduce the amount of green spill that appears on the subject there's a few different ways of doing this one of the most simple ways that's not very sophisticated is you can use an expression node and just literally tell nuke to take out the green in the shot to do this i'm going to add an expression into the green channel within the expression node and what you want to type in is if green is greater than red question mark and then r colon g and as you can see what that's doing now is removing the green from the green screen it's basically saying if green is greater than red put some red into the green which is helping to neutralize the color if i add another expression node there's a slightly more sophisticated version of this expression which looks like this and if i compare the two you see they have slightly different results there's quite a lot of green fringing going on in the edge of my ear here i don't really use expressions to do dspilling i actually prefer to use gizmos because i find they give a bit of a better result the one that i use at home is a gizmo called d-spill madness from nucopedia it's free and you can download it if i plug this into the footage you can see this is doing a much nicer job of de-spilling the green there's no fringing around the edges of my ears it just generally looks a lot nicer so what you would do is plug this into your footage but obviously you don't want to plug it in at the top of your stream because otherwise there'll be no green to keep and then as a result your kia will basically be useless because there's no green left so what you want to do is plug it in in the mainstream which is why we did the key off to the side which means we're de-spilling the footage but then we're keeping the green version to do the key off to the side and then copying the alpha back in here and now as you can see the green spill is massively reduced we still have a bit of a problem on the edges but because it's de-spilled it's more of a neutral color which makes it easier to work with and in some circumstances like if you're putting something bright behind me you could even just get away with this on its own to show an example if i had a constant and just merge the pre-malted footage over this that's actually working pretty well if i toggle the d spell off you can see all of the green fringing comes back but the d spill is doing a nice job of removing it from my hair one of the most important things to know about keying is you don't have to do it all with one key it's very difficult for example to get a really nice solid key on the outline of my jumper while also maintaining a lot of the really soft detail in my hair so what we tend to do as compositors is do multiple keys and then combine them using masks later for example the ibk kia has done a really nice job on the outline of my body but i might want to use a different key to get some more detail in the hair so now just quickly i'm going to demonstrate how i would actually key this shot from these tests it looked like the ibk kia had the best overall result and i'd recommend whenever you're keying a shot to go through and try all of them and see which gives the best result because it really does vary from shot to shot so let's just make a little bit of space over here i'm going to add an ibk color let's put this off to the side set it to green i'm going to turn the size up a little bit and then just stack it a few times as well then i'm going to add the ibk gizmo foreground goes into your footage c goes into the key and then again set this to green screen and that's my result another good trick if you have holes in your mat is making a really really crunchy core mat to do this you can use a grade node again like i did before but make the change a lot stronger so again i've set the channels to alpha and i'm going to turn the gain up really really high so it really fills in all the holes then what you can do is add in a road set the channels to alpha and then erode this inward so it goes just inside the edges of the key so this is the original base key and then this is my eroded really strong key and what you can do is merge this over the top so now i've got a super strong map just for the core of the subject that's eroded inwards and that's filling in any really small holes in the mat again i'm going to add a clamp node just to make sure that my alpha stays at one and i'm also just going to grab the mask setup from over here again now what i want to do is do a much softer key just for my hair for this i'm going to try and use key light i think the key light generally gives the best result for hair keys so i'm going to a separate key light key off to the side here and just go out pretty much the same process but all i'm worried about for this part is getting a good key just for the sections around my hair so there's no point worrying about what the key looks like down here i'm only interested in this sort of area that looks pretty good if i compare this back and forth with the ibk gizmo you can see that it's picking up a lot more of the really fine hairs in the key especially around here so then what i can do is just make a mat around the edge of my hair probably just this sort of area and then use another merge node and set this to mask and blur it a little bit just to soften the edge and then what i'm going to do is put this hair key on top of the original ibk key like so and you can see that's making a really big difference to the amount of detail i'm picking up in the hair now what i can do is take this combined alpha copy it into my main stream and then pre-mult it i'm going to add a day spill madness in before my footage so that it's removing any of the green as you can see there's still a fair bit of green noise around the edge of my body especially if i gain up the viewport so what i'm going to do is grade the alpha slightly using the same technique as earlier i'm going to press g to add a grade node set the channels to alpha and i'm going to gamma down slightly to just to crunch out the contrast on the mat now if i look at the promote we should have a much cleaner result which we do the key light node seems to be creating some noise as well so i'm going to do the same thing over here until we see the noise disappear so now i've got a really solid key here that's combining a good punchy core mat for the edge of my body and then the softer key for the hair is bringing in some of the really fine wispy hairs just to add some extra detail again if i merge this over a constant we can see what it looks like on a background and i'd say that's looking pretty solid it works fine on this white or gray background because this bill madness is essentially de-spilling the green screen to a gray color so the color i'm merging this on top of is matching the color of this edge spill but as you'll see here if i change the color of the background constant to something else and then plug this in you can see we have some edge issues there's a few ways of dealing with this the first one is fairly destructive but you can just add in a road and actually eat into the mat and it will get rid of the edge problems this kind of works and on the body you can probably get away with it because it's a fairly constant outline but if i look at the hair and turn this on and off you can see it's doing some pretty nasty stuff to the hair key another thing you can do is an edge extension there's lots of different nodes for this i like to use one from nucopedia called color edge what you do with this is you make some room before your copy node and plug this into your footage and plug the mask input into your alpha which is the key all of these nodes do a similar thing nuke has a built-in one that's called edge extend so you plug your source in here and the mat over here but i'm going to use the color edge because i think it gives a slightly better result then essentially what this does is it eats into the edges of the alpha and smears the colors of the pixels outwards so if i look at the promote now and turn the color edge on and off it's getting rid of all that spill without actually eating into the edge of the mat so that's a lot more successful you do have to be a bit careful with the color edge if you go too strong you start to see this really block color appearing around the edge of your subject so it's good to try and do it as subtly as you can before you start seeing any block colors appearing on the outline of the subject that's all for the keying techniques in this video the last thing i'm going to talk about is edge painting it's something that i think a lot of people unless you work professionally in the visual effects industry won't be familiar with and it's because this level of finessing and detail really only goes into high-end visual effects to demonstrate it essentially if you're doing a key of a shot like this where the subject is just sitting still or very slowly moving and you're not having to deal with much motion blur it's a pretty easy shot to key but if i go to my second piece of footage which i shot earlier what happens when you have a subject moving incredibly quickly on the green screen and you're dealing with motion blur it can suddenly become a lot more complicated so if i do a quick key on this i'm just going to use a key light node not do multiple keys for this so let's say this is my key then i'm going to copy the alpha into the stream and pre-mult it and do a quick d spill now if i was to take this bit of footage and put it on top of a constant let's say it's going to be pink for this example you would see that there's some ugly color stuff happening in the motion blur especially if i turn off the d-spill this is where the green is kind of coming through what's happening here is that the motion blur becomes so transparent that it's pretty much just a green screen coming through but the motion blur is darkening the green screen so it's a different shade to everything else which is why it's not being keyed properly and you end up with results like this so to fix this you can do some frame by frame painting using the road to paint node and nuke to basically smear or clone the colors from your sleeve into the motion blur to make it look more natural to do this it's really important that you only paint the rgb layers you don't want to do any painting in the alpha otherwise you'll be extending the key outwards so to demonstrate this i'm going to add a paint node in between my copy and my print remote and first of all i'm not going to set it to rgb i'm going to paint on the alpha as well and if i use the clone brush and start doing a little bit of painting you can see that the key is actually extending outward so my alpha is getting bigger because i'm painting the alpha as well as the colors to change that what you can do is set the output just to rgb and that will then not affect the alpha but you can still paint the color layers so now essentially when i paint it will only paint in the areas of the key and now as you can see i can just paint the color of the blue into the motion blur of my sleeve so this is before and after as you can see that looks loads better especially if i turn on the d-spill and essentially for the final level of finesse to get this to look much more convincing when you put it over a background is you'll just go through and do the painting on every single frame this can be a pretty tedious process especially if there's lots of movement i tend to do this towards the end of when a project is delivering you don't want to do this too early in case anything changes because you'll have to do all of your paintwork again which can be an absolute nightmare so i tend to wait until i know that the shot is pretty much fully comped and that everything is locked and not going to change and then right at the end before delivery i will go in probably in the last couple of days at the job and do all my edge painting if i add a comparison with the wipe tool before and after it makes a huge difference to the spill in the motion blur so there we go that's the fundamentals of all the keying techniques in nuke hopefully that's a fairly comprehensive overview and give you a pretty good idea of how to approach keying shots to give a better end result again the test footage and the new script for this will be on my patreon for anybody that's interested in picking them up thank you very much for watching and i'll see you in the next video in this part do you believe me